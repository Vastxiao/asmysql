{"config":{"lang":["zh","en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"asmysql","text":"\u5f02\u6b65 MySQL \u5ba2\u6237\u7aef\u5e93 <p>     \u57fa\u4e8e aiomysql \u5c01\u88c5\uff0c\u4e3a Python \u5f02\u6b65\u7f16\u7a0b\u63d0\u4f9b\u7b80\u5355\u800c\u5f3a\u5927\u7684 MySQL \u64cd\u4f5c API   </p> \ud83d\ude80 \u7b80\u5355\u6613\u7528 <p>\u76f4\u89c2\u7684 API \u8bbe\u8ba1\uff0c\u5b66\u4e60\u6210\u672c\u4f4e\uff0c\u5feb\u901f\u4e0a\u624b</p> \u26a1 \u9ad8\u6027\u80fd <p>\u57fa\u4e8e\u8fde\u63a5\u6c60\u7684\u5f02\u6b65\u64cd\u4f5c\uff0c\u652f\u6301\u9ad8\u5e76\u53d1\u573a\u666f</p> \ud83d\udd27 \u7c7b\u578b\u5b89\u5168 <p>\u5b8c\u6574\u7684\u7c7b\u578b\u63d0\u793a\u652f\u6301\uff0c\u63d0\u5347\u5f00\u53d1\u4f53\u9a8c</p> \ud83d\udcbe \u5185\u5b58\u53cb\u597d <p>\u652f\u6301\u6d41\u5f0f\u67e5\u8be2\uff0c\u5904\u7406\u5927\u6570\u636e\u96c6\u4e0d\u5360\u7528\u5185\u5b58</p>"},{"location":"#_1","title":"\u5feb\u901f\u5b89\u88c5","text":"<pre><code>pip install asmysql\n</code></pre>"},{"location":"#_2","title":"\u5feb\u901f\u793a\u4f8b","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    # \u521b\u5efa\u5f15\u64ce\n    engine = Engine(\n        host='localhost',\n        port=3306,\n        user='root',\n        password='password',\n        db='test'\n    )\n\n    # \u8fde\u63a5\u6570\u636e\u5e93\n    await engine.connect()\n\n    # \u6267\u884c\u67e5\u8be2\n    result = await engine.query(\"SELECT * FROM users WHERE id = %s\", (1,))\n    user = await result.fetch_one(as_dict=True)\n    print(user)\n\n    # \u5173\u95ed\u8fde\u63a5\n    await engine.close()\n\nasyncio.run(main())\n</code></pre>"},{"location":"#_3","title":"\u6587\u6863\u7248\u672c","text":"V2 \u4e2d\u6587\u6587\u6863 \u6700\u65b0\u7248\u672c (\u63a8\u8350) V2 English Docs Latest (Recommended) V1 \u4e2d\u6587\u6587\u6863 \u65e7\u7248\u672c V1 English Docs Legacy"},{"location":"#_4","title":"\u94fe\u63a5","text":"<ul> <li>PyPI: pypi.org/project/asmysql</li> <li>GitHub: github.com/vastxiao/asmysql</li> <li>Gitee: gitee.com/vastxiao/asmysql</li> </ul>"},{"location":"en/v1/","title":"asmysql","text":"<ul> <li>PyPI: https://pypi.org/project/asmysql/</li> <li>GitHub: https://github.com/vastxiao/asmysql</li> <li>Gitee: https://gitee.com/vastxiao/asmysql</li> </ul>"},{"location":"en/v1/#introduction","title":"Introduction","text":"<p>asmysql is a library for using the MySQL asynchronous client, which is a wrapper for aiomysql.</p>"},{"location":"en/v1/#features","title":"Features","text":"<ul> <li>Code supports type annotations.</li> <li>Very easy to use, simply inherit the AsMysql class for logical development.</li> <li>Supports automatic management of the MySQL connection pool and reconnection mechanism.</li> <li>Automatically captures and handles MysqlError errors globally.</li> <li>Separates statement execution from data retrieval.</li> </ul>"},{"location":"en/v1/#install","title":"Install","text":"<pre><code># Install from PyPI\npip install asmysql\n</code></pre>"},{"location":"en/v1/#documentation","title":"Documentation","text":""},{"location":"en/v1/#quick-start","title":"Quick Start","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\n\n# Directly inherit the AsMysql class for development:\nclass TestAsMysql(AsMysql):\n    # You can define some default parameters for the Mysql instance initialization here\n    # The attributes are consistent with the __init__ parameters\n    host = '127.0.0.1'\n    port = 3306\n    user = 'root'\n    password = 'pass'\n\n    async def get_users(self):\n        # The self.client attribute is specifically used to execute SQL statements, providing aiomysql's execute and execute_many methods.\n        result = await self.client.execute('select user,authentication_string,host from mysql.user')\n        # result is specifically used to obtain execution results, providing fetch_one, fetch_many, fetch_all, and iterate methods.\n        # result.err is the exception object (Exception) for all MySQL execution errors.\n        if result.err:\n            print(result.err_msg)\n        else:\n            # result.iterate() is an asynchronous iterator that can fetch each row of the execution result.\n            async for item in result.iterate():\n                print(item)\n\n\nasync def main():\n    # This will create an instance and connect to MySQL:\n    mysql = await TestAsMysql()\n\n    await mysql.get_users()\n\n    # Remember to disconnect the MySQL connection before exiting the program:\n    await mysql.disconnect()\n\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v1/#support-for-asynchronous-context-managers","title":"Support for asynchronous context managers.","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\nclass TestAsMysql(AsMysql):\n    async def get_users(self):\n        result = await self.client.execute('select user,authentication_string,host from mysql.user')\n        if result.err:\n            print(result.err)\n        else:\n            async for item in result.iterate():\n                print(item)\n\nasync def main():\n    # Using async with will automatically close the MySQL connection when the code exits.\n    async with TestAsMysql() as mysql:\n        await mysql.get_users()\n\nif __name__ == '__main__':\n    asyncio.run(main())\n</code></pre>"},{"location":"en/v1/#more-usage","title":"More Usage","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\nclass TestAsMysql(AsMysql):\n    async def get_users(self):\n        result = await self.client.execute('select user,authentication_string,host from mysql.user')\n        if result.err:\n            print(result.err)\n        else:\n            return await result.fetch_all()\n\n# When creating a MySQL instance, parameters such as MySQL address and user password can be passed in.\nmysql = TestAsMysql(host='192.168.1.192', port=3306)\n\nasync def main():\n    # This will connect to MySQL:\n    await mysql.connect()  # or: await mysql\n\n    print(await mysql.get_users())\n\n    # Disconnect MySQL connection:\n    await mysql.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v1/CHANGELOG/","title":"Change Log","text":""},{"location":"en/v1/CHANGELOG/#131-20250624","title":"[1.3.1] - 2025.06.24","text":"<ul> <li>Fix: Handle auto_commit using aiomysql's native attribute, support configuration passing.</li> </ul>"},{"location":"en/v1/CHANGELOG/#130-20250621","title":"[1.3.0] - 2025.06.21","text":""},{"location":"en/v1/CHANGELOG/#breaking-changes","title":"Breaking Changes","text":"<ul> <li>Changed Result.rowcount attribute to row_count</li> <li>Changed Result.lastrowid attribute to last_rowid</li> <li>Changed Result.rownumber attribute to row_number</li> </ul>"},{"location":"en/v1/CHANGELOG/#120-20250620","title":"[1.2.0] - 2025.06.20","text":""},{"location":"en/v1/CHANGELOG/#features","title":"Features","text":"<ul> <li>Expose <code>cursor</code> attribute in <code>Result</code>.</li> <li>Add new attributes <code>rowcount</code>, <code>lastrowid</code>, and <code>rownumber</code> to <code>Result</code>.</li> </ul>"},{"location":"en/v1/CHANGELOG/#113-20250527","title":"[1.1.3] - 2025.05.27","text":""},{"location":"en/v1/CHANGELOG/#features_1","title":"Features","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\nasync def main():\n    async with AsMysql() as mysql:\n        # execute method supports the commit parameter to control transaction submission, \n        # automatically determined by default.\n        await mysql.client.execute('insert into test(name) values(\"test\")', commit=False)\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v1/CHANGELOG/#110-20250212","title":"[1.1.0] - 2025.02.12","text":""},{"location":"en/v1/CHANGELOG/#features_2","title":"Features","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\nmysql = AsMysql()\n\nasync def main():\n    # AsMysql add function: async def __call__()\n    await mysql()\n\n    print(await mysql.client.execute('select user,host from mysql.user'))\n\n    # \u65ad\u5f00mysql\u8fde\u63a5\uff1a\n    await mysql.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v1/CHANGELOG/#100-20241019","title":"[1.0.0] - 2024.10.19","text":""},{"location":"en/v1/CHANGELOG/#features_3","title":"Features","text":"<ol> <li>Update the supported Python version range, with a minimum support of 3.9.</li> <li>Update the documentation content.</li> </ol>"},{"location":"en/v1/CHANGELOG/#020-20241014","title":"[0.2.0] - 2024.10.14","text":""},{"location":"en/v1/CHANGELOG/#features_4","title":"Features","text":"<ol> <li>Fixed the handling of the <code>echo</code> parameter in <code>aiomysql</code>.</li> <li>Added the <code>echo_sql_log</code> parameter to the <code>AsMysql</code> class, used to control whether <code>aiomysql</code> outputs the executed SQL statements (default is False).</li> </ol> <pre><code>from asmysql import AsMysql\n\nclass TestAsMysql(AsMysql):\n    # This allows controlling whether the executed SQL statements in aiomysql\n    # are output to Logging.logger.\n    echo_sql_log = True\n\n\n# Of course, the `echo_sql_log` parameter can also be passed when instantiating AsMysql.\nasync def main():\n    async with TestAsMysql(echo_sql_log=True) as mysql:\n        result = await mysql.client.execute('select user, authentication_string, host from mysql.user')\n        if result.err:\n            print(result.err)\n        else:\n            async for item in result.iterate():\n                print(item)\n</code></pre>"},{"location":"en/v1/CHANGELOG/#014-20240815","title":"[0.1.4] - 2024.08.15","text":""},{"location":"en/v1/CHANGELOG/#features_5","title":"Features","text":""},{"location":"en/v1/CHANGELOG/#1-asmysql-supports-asynchronous-context-manager","title":"1. <code>AsMysql</code> supports asynchronous context manager.","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\nclass TestAsMysql(AsMysql):\n    async def get_users(self):\n        result = await self.client.execute('select user, authentication_string, host from mysql.user')\n        if result.err:\n            print(result.err)\n        else:\n            async for item in result.iterate():\n                print(item)\n\nasync def main():\n    async with TestAsMysql() as mysql:\n        await mysql.get_users()\n\nif __name__ == '__main__':\n    asyncio.run(main())\n</code></pre>"},{"location":"en/v1/CHANGELOG/#2-replaced-exceptions-in-connection-with-connectionerror","title":"2. Replaced exceptions in <code>connection</code> with <code>ConnectionError</code>.","text":""},{"location":"en/v1/CHANGELOG/#011-20230725","title":"[0.1.1] - 2023.07.25","text":""},{"location":"en/v1/CHANGELOG/#features_6","title":"Features","text":"<p>Added <code>Result.err_msg</code> to return a detailed string of the exception error.</p>"},{"location":"en/v1/CHANGELOG/#010-20230716","title":"[0.1.0] - 2023.07.16","text":""},{"location":"en/v1/CHANGELOG/#breaking-changes_1","title":"Breaking Changes","text":""},{"location":"en/v1/CHANGELOG/#features_7","title":"Features","text":"<ol> <li><code>asmysql</code> is a simplified wrapper library around <code>aiomysql</code>.</li> <li>Supports automatic management of MySQL connection pools and reconnection mechanism.</li> <li>Automatically captures and handles <code>MysqlError</code> globally.</li> <li>Separates statement execution and data retrieval.</li> <li>Directly integrates the <code>AsMysql</code> class for logical development.</li> </ol>"},{"location":"en/v1/CHANGELOG/#internal","title":"Internal","text":"<p>Initialized the project, with the development environment managed using <code>poetry</code>.</p>"},{"location":"en/v2/","title":"asmysql v2 Technical Documentation","text":"<ul> <li>PyPI: https://pypi.org/project/asmysql/</li> <li>GitHub: https://github.com/vastxiao/asmysql</li> <li>Gitee: https://gitee.com/vastxiao/asmysql</li> <li>Docs: https://vastxiao.github.io/asmysql/</li> </ul>"},{"location":"en/v2/#introduction","title":"Introduction","text":"<p><code>asmysql</code> is an asynchronous MySQL client library based on <code>aiomysql</code>, designed for Python asynchronous programming. The v2 version has completely refactored the architecture, providing a clearer and more flexible API design, supporting type hints, connection pool management, error handling, and other enterprise-level features.</p>"},{"location":"en/v2/#main-advantages","title":"Main Advantages","text":"<ul> <li>Simple and Easy to Use: Intuitive API design with low learning curve</li> <li>Type Safe: Complete type hint support for better development experience</li> <li>High Performance: Asynchronous operations based on connection pool, supporting high concurrency</li> <li>Flexible Extension: Separated engine and business logic for better architecture design</li> <li>Memory Friendly: Supports streaming queries, handling large datasets without memory consumption</li> </ul>"},{"location":"en/v2/#features","title":"Features","text":""},{"location":"en/v2/#core-features-of-v2-version","title":"Core Features of v2 Version","text":"<ol> <li>Separated Architecture</li> <li><code>Engine</code> class: Independent MySQL connection engine, can be used standalone</li> <li><code>AsMysql</code> class: Business logic development base class, ready to use by inheritance</li> <li> <p><code>Result</code> class: Result processing class, supporting multiple data retrieval methods</p> </li> <li> <p>Connection Management</p> </li> <li>Automatic MySQL connection pool management</li> <li>Support for connection pool configuration (min/max connections)</li> <li>Automatic reconnection mechanism</li> <li> <p>Connection status monitoring</p> </li> <li> <p>Flexible Query Methods</p> </li> <li>Support for regular queries and streaming queries</li> <li>Support for single and batch execution</li> <li> <p>Support for transaction control</p> </li> <li> <p>Multiple Result Types</p> </li> <li><code>tuple</code>: Default tuple type</li> <li><code>dict</code>: Dictionary type</li> <li> <p>Custom models: Support for Pydantic and other model classes</p> </li> <li> <p>Data Retrieval Methods</p> </li> <li><code>fetch_one()</code>: Get a single record</li> <li><code>fetch_many()</code>: Get multiple records</li> <li><code>fetch_all()</code>: Get all records</li> <li><code>iterate()</code>: Async iterator, get records row by row</li> <li> <p>Direct iteration: <code>async for item in result</code></p> </li> <li> <p>Error Handling</p> </li> <li>Global automatic capture of <code>MysqlError</code></li> <li>Error code and error message access</li> <li> <p>Elegant error handling mechanism</p> </li> <li> <p>Context Management</p> </li> <li>Support for <code>async with</code> syntax</li> <li>Automatic resource cleanup</li> <li> <p>Support for async iterator protocol</p> </li> <li> <p>URL Connection String</p> </li> <li>Support for MySQL URL format connection</li> <li>Format: <code>mysql://user:password@host:port/?charset=utf8mb4</code></li> </ol>"},{"location":"en/v2/#core-concepts","title":"Core Concepts","text":""},{"location":"en/v2/#engine","title":"Engine","text":"<p><code>Engine</code> is the core class for MySQL connections, responsible for:</p> <ul> <li>Managing connection pool</li> <li>Executing SQL statements</li> <li>Handling connection lifecycle</li> </ul>"},{"location":"en/v2/#asmysql-business-logic-class","title":"AsMysql (Business Logic Class)","text":"<p><code>AsMysql</code> is the base class for business logic development, providing:</p> <ul> <li><code>client</code> attribute: Access to <code>Engine</code> instance</li> <li>Business method encapsulation</li> <li>Code organization capability</li> </ul>"},{"location":"en/v2/#result","title":"Result","text":"<p><code>Result</code> is the encapsulation class for SQL execution results, providing:</p> <ul> <li>Data retrieval methods</li> <li>Error information access</li> <li>Execution statistics</li> <li>Async iteration support</li> </ul>"},{"location":"en/v2/#quick-navigation","title":"Quick Navigation","text":"<ul> <li>Installation Guide - Installation and dependency requirements</li> <li>Quick Start - Quick start examples</li> <li>Connection Management - Connection configuration and management</li> <li>Query Operations - Execute SQL statements</li> <li>Result Processing - Retrieve and process query results</li> <li>Transaction Control - Transaction management</li> <li>Business Logic - Business logic development</li> <li>Best Practices - Recommended usage patterns</li> <li>FAQ - FAQ</li> <li>API Reference - Complete API documentation</li> <li>Usage Examples - Detailed usage examples</li> <li>Changelog - Version update records</li> </ul>"},{"location":"en/v2/api/","title":"asmysql v2 API Reference","text":"<p>This document details all APIs in asmysql v2 version.</p>"},{"location":"en/v2/api/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Engine Class</li> <li>AsMysql Class</li> <li>Result Class</li> <li>Type Definitions</li> </ul>"},{"location":"en/v2/api/#engine-class","title":"Engine Class","text":"<p><code>Engine</code> is the MySQL connection engine class, responsible for managing connection pool and executing SQL statements.</p>"},{"location":"en/v2/api/#class-definition","title":"Class Definition","text":"<pre><code>class Engine:\n    \"\"\"Asynchronous database aiomysql wrapper class\"\"\"\n</code></pre>"},{"location":"en/v2/api/#class-attributes-default-values","title":"Class Attributes (Default Values)","text":"Attribute Type Default Description <code>host</code> <code>str</code> <code>\"127.0.0.1\"</code> MySQL server address <code>port</code> <code>int</code> <code>3306</code> MySQL server port <code>user</code> <code>str</code> <code>\"\"</code> Username <code>password</code> <code>str</code> <code>\"\"</code> Password <code>charset</code> <code>str</code> <code>\"utf8mb4\"</code> Character set <code>min_pool_size</code> <code>int</code> <code>1</code> Minimum connection pool size <code>max_pool_size</code> <code>int</code> <code>10</code> Maximum connection pool size <code>pool_recycle</code> <code>float</code> <code>-1</code> Idle connection recycle time (seconds), -1 means no recycle <code>connect_timeout</code> <code>int</code> <code>5</code> Connection timeout (seconds) <code>auto_commit</code> <code>bool</code> <code>True</code> Whether to auto-commit transactions <code>echo_sql_log</code> <code>bool</code> <code>False</code> Whether to print SQL logs <code>stream</code> <code>bool</code> <code>False</code> Whether to use streaming result <code>result_class</code> <code>type</code> <code>tuple</code> Result type"},{"location":"en/v2/api/#constructor","title":"Constructor","text":"<pre><code>def __init__(\n    self,\n    url: str = None,\n    *,\n    host: str = None,\n    port: int = None,\n    user: str = None,\n    password: str = None,\n    charset: str = None,\n    min_pool_size: int = None,\n    max_pool_size: int = None,\n    pool_recycle: float = None,\n    connect_timeout: int = None,\n    auto_commit: bool = None,\n    echo_sql_log: bool = None,\n    stream: bool = None,\n    result_class: type = None,\n) -&gt; None\n</code></pre> <p>Parameter Description:</p> <ul> <li><code>url</code> (str, optional): MySQL connection URL, format: <code>mysql://user:password@host:port/?charset=utf8mb4</code></li> <li><code>host</code> (str, optional): MySQL server address</li> <li><code>port</code> (int, optional): MySQL server port</li> <li><code>user</code> (str, optional): Username</li> <li><code>password</code> (str, optional): Password</li> <li><code>charset</code> (str, optional): Character set</li> <li><code>min_pool_size</code> (int, optional): Minimum connection pool size</li> <li><code>max_pool_size</code> (int, optional): Maximum connection pool size</li> <li><code>pool_recycle</code> (float, optional): Idle connection recycle time (seconds)</li> <li><code>connect_timeout</code> (int, optional): Connection timeout (seconds)</li> <li><code>auto_commit</code> (bool, optional): Whether to auto-commit transactions</li> <li><code>echo_sql_log</code> (bool, optional): Whether to print SQL logs</li> <li><code>stream</code> (bool, optional): Whether to use streaming result</li> <li><code>result_class</code> (type, optional): Result type</li> </ul> <p>Examples:</p> <pre><code># Using URL\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/?charset=utf8mb4\")\n\n# Using keyword arguments\nengine = Engine(\n    host=\"127.0.0.1\",\n    port=3306,\n    user=\"root\",\n    password=\"pass\",\n    charset=\"utf8mb4\"\n)\n</code></pre>"},{"location":"en/v2/api/#methods","title":"Methods","text":""},{"location":"en/v2/api/#connect","title":"connect()","text":"<p>Connect to MySQL, establish TCP connection, initialize connection pool.</p> <pre><code>async def connect(self) -&gt; Engine\n</code></pre> <p>Return Value: Returns <code>self</code>, supports chaining</p> <p>Example:</p> <pre><code>await engine.connect()\n</code></pre>"},{"location":"en/v2/api/#disconnect","title":"disconnect()","text":"<p>Wait for all connections to be released and properly close MySQL connection.</p> <pre><code>async def disconnect(self) -&gt; None\n</code></pre> <p>Example:</p> <pre><code>await engine.disconnect()\n</code></pre>"},{"location":"en/v2/api/#release_connections","title":"release_connections()","text":"<p>Release all idle connections in the connection pool.</p> <pre><code>async def release_connections(self) -&gt; None\n</code></pre> <p>Example:</p> <pre><code>await engine.release_connections()\n</code></pre>"},{"location":"en/v2/api/#execute","title":"execute()","text":"<p>Execute SQL statement and return Result object.</p> <pre><code>def execute(\n    self,\n    query: str,\n    values: Union[Sequence, dict] = None,\n    *,\n    stream: bool = None,\n    result_class: type[T] = None,\n    commit: bool = None,\n) -&gt; Union[Awaitable[Result[T]], AsyncContextManager[Result[T]], AsyncGenerator[T, None]]\n</code></pre> <p>Parameter Description:</p> <ul> <li><code>query</code> (str): SQL statement</li> <li><code>values</code> (Union[Sequence, dict], optional): Parameters, can be tuple or dict</li> <li><code>stream</code> (bool, optional): Whether to stream results, defaults to <code>self.stream</code></li> <li><code>result_class</code> (type, optional): Result type, defaults to <code>self.result_class</code></li> <li><code>commit</code> (bool, optional): Whether to commit transaction, defaults to <code>self.auto_commit</code></li> </ul> <p>Return Value: Returns <code>Result</code> object, supports the following usages:</p> <ol> <li><code>result = await engine.execute(...)</code></li> <li><code>async with engine.execute(...) as result:</code></li> <li><code>async for item in engine.execute(...):</code></li> </ol> <p>Examples:</p> <pre><code># Method 1: await\nresult = await engine.execute(\"SELECT * FROM users WHERE id = %s\", (1,))\ndata = await result.fetch_one()\n\n# Method 2: context manager\nasync with engine.execute(\"SELECT * FROM users\") as result:\n    data = await result.fetch_all()\n\n# Method 3: direct iteration\nasync for row in engine.execute(\"SELECT * FROM users\"):\n    print(row)\n</code></pre>"},{"location":"en/v2/api/#execute_many","title":"execute_many()","text":"<p>Batch execute SQL statements and return Result object.</p> <pre><code>def execute_many(\n    self,\n    query: str,\n    values: Sequence[Union[Sequence, dict]],\n    *,\n    stream: bool = None,\n    result_class: type[T] = None,\n    commit: bool = None,\n) -&gt; Union[Awaitable[Result[T]], AsyncContextManager[Result[T]], AsyncGenerator[T, None]]\n</code></pre> <p>Parameter Description:</p> <ul> <li><code>query</code> (str): SQL statement</li> <li><code>values</code> (Sequence[Union[Sequence, dict]]): Parameter list, each element can be tuple or dict</li> <li><code>stream</code> (bool, optional): Whether to stream results</li> <li><code>result_class</code> (type, optional): Result type</li> <li><code>commit</code> (bool, optional): Whether to commit transaction</li> </ul> <p>Return Value: Returns <code>Result</code> object</p> <p>Example:</p> <pre><code>data = [\n    (\"\u5f20\u4e09\", \"zhangsan@example.com\"),\n    (\"\u674e\u56db\", \"lisi@example.com\")\n]\nresult = await engine.execute_many(\n    \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n    data\n)\n</code></pre>"},{"location":"en/v2/api/#attributes","title":"Attributes","text":""},{"location":"en/v2/api/#status","title":"status","text":"<p>Returns database connection pool status.</p> <pre><code>@property\ndef status(self) -&gt; EngineStatus\n</code></pre> <p>Return Value: <code>EngineStatus</code> dictionary, contains the following fields:</p> <ul> <li><code>address</code> (str): Connection address</li> <li><code>connected</code> (bool): Whether connected</li> <li><code>pool_minsize</code> (Optional[int]): Connection pool minimum size</li> <li><code>pool_maxsize</code> (Optional[int]): Connection pool maximum size</li> <li><code>pool_size</code> (Optional[int]): Connection pool current size</li> <li><code>pool_free</code> (Optional[int]): Number of idle connections</li> <li><code>pool_used</code> (Optional[int]): Number of connections in use</li> </ul> <p>Example:</p> <pre><code>status = engine.status\nprint(f\"Connection status: {status['connected']}\")\nprint(f\"Pool size: {status['pool_size']}\")\n</code></pre>"},{"location":"en/v2/api/#is_connected","title":"is_connected","text":"<p>Whether the database is connected.</p> <pre><code>@property\ndef is_connected(self) -&gt; bool\n</code></pre> <p>Return Value: <code>bool</code>, returns <code>True</code> if connected, otherwise <code>False</code></p> <p>Example:</p> <pre><code>if engine.is_connected:\n    print(\"Connected\")\n</code></pre>"},{"location":"en/v2/api/#pool","title":"pool","text":"<p>Get connection pool object (internal use).</p> <pre><code>@property\ndef pool(self) -&gt; Pool\n</code></pre> <p>Return Value: <code>aiomysql.Pool</code> object</p> <p>Note: This attribute is for internal use only, will raise <code>ConnectionError</code> if not connected</p>"},{"location":"en/v2/api/#url","title":"url","text":"<p>Connection URL (read-only).</p> <pre><code>url: Final[str]\n</code></pre> <p>Example:</p> <pre><code>print(engine.url)  # mysql://127.0.0.1:3306/\n</code></pre>"},{"location":"en/v2/api/#special-methods","title":"Special Methods","text":""},{"location":"en/v2/api/#aenter-aexit","title":"aenter() / aexit()","text":"<p>Support for <code>async with</code> syntax.</p> <pre><code>async def __aenter__(self) -&gt; Engine\nasync def __aexit__(self, exc_type, exc_value, exc_tb) -&gt; None\n</code></pre> <p>Example:</p> <pre><code>async with engine:\n    result = await engine.execute(\"SELECT * FROM users\")\n    data = await result.fetch_all()\n</code></pre>"},{"location":"en/v2/api/#await","title":"await()","text":"<p>Support for <code>await engine</code> syntax.</p> <pre><code>def __await__(self) -&gt; Generator[Any, None, Engine]\n</code></pre> <p>Example:</p> <pre><code>await engine  # Equivalent to await engine.connect()\n</code></pre>"},{"location":"en/v2/api/#call","title":"call()","text":"<p>Support for <code>await engine()</code> syntax.</p> <pre><code>async def __call__(self) -&gt; Engine\n</code></pre> <p>Example:</p> <pre><code>await engine()  # Equivalent to await engine.connect()\n</code></pre>"},{"location":"en/v2/api/#asmysql-class","title":"AsMysql Class","text":"<p><code>AsMysql</code> is the base class for business logic development, used to encapsulate business methods.</p>"},{"location":"en/v2/api/#class-definition_1","title":"Class Definition","text":"<pre><code>class AsMysql:\n    \"\"\"Class for writing MySQL business logic\"\"\"\n</code></pre>"},{"location":"en/v2/api/#constructor_1","title":"Constructor","text":"<pre><code>def __init__(self, engine: Engine) -&gt; None\n</code></pre> <p>Parameter Description:</p> <ul> <li><code>engine</code> (Engine): <code>Engine</code> instance</li> </ul> <p>Example:</p> <pre><code>engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nclass UserService(AsMysql):\n    pass\n\nservice = UserService(engine)\n</code></pre>"},{"location":"en/v2/api/#attributes_1","title":"Attributes","text":""},{"location":"en/v2/api/#client","title":"client","text":"<p>Access <code>Engine</code> instance.</p> <pre><code>@property\ndef client(self) -&gt; Engine\n</code></pre> <p>Return Value: <code>Engine</code> instance</p> <p>Example:</p> <pre><code>class UserService(AsMysql):\n    async def get_users(self):\n        result = await self.client.execute(\"SELECT * FROM users\")\n        return await result.fetch_all()\n</code></pre>"},{"location":"en/v2/api/#result-class","title":"Result Class","text":"<p><code>Result</code> is the encapsulation class for SQL execution results, providing data retrieval and error handling functionality.</p>"},{"location":"en/v2/api/#class-definition_2","title":"Class Definition","text":"<pre><code>class Result(Generic[T]):\n    \"\"\"SQL execution result class\"\"\"\n</code></pre>"},{"location":"en/v2/api/#constructor_2","title":"Constructor","text":"<pre><code>def __init__(\n    self,\n    *,\n    pool: Pool,\n    query: str,\n    values: Union[Sequence, dict] = None,\n    execute_many: bool = False,\n    stream: bool = False,\n    commit: bool = True,\n    result_class: T = tuple,\n) -&gt; None\n</code></pre> <p>Parameter Description (internal use, usually no need to construct directly):</p> <ul> <li><code>pool</code> (Pool): Connection pool object</li> <li><code>query</code> (str): SQL statement</li> <li><code>values</code> (Union[Sequence, dict], optional): Parameters</li> <li><code>execute_many</code> (bool): Whether batch execution</li> <li><code>stream</code> (bool): Whether streaming result</li> <li><code>commit</code> (bool): Whether to commit transaction</li> <li><code>result_class</code> (type): Result type</li> </ul>"},{"location":"en/v2/api/#methods_1","title":"Methods","text":""},{"location":"en/v2/api/#fetch_one","title":"fetch_one()","text":"<p>Get a single record.</p> <pre><code>async def fetch_one(self, close: bool = None) -&gt; Optional[T]\n</code></pre> <p>Parameter Description:</p> <ul> <li><code>close</code> (bool, optional): Whether to automatically close cursor connection. If set to <code>False</code>, must manually call <code>Result.close()</code> to release connection</li> </ul> <p>Return Value: Returns a single record, returns <code>None</code> if no data</p> <p>Example:</p> <pre><code>result = await engine.execute(\"SELECT * FROM users WHERE id = %s\", (1,))\nuser = await result.fetch_one()\nif user:\n    print(user)\n</code></pre>"},{"location":"en/v2/api/#fetch_many","title":"fetch_many()","text":"<p>Get multiple records.</p> <pre><code>async def fetch_many(self, size: int = None, close: bool = None) -&gt; list[T]\n</code></pre> <p>Parameter Description:</p> <ul> <li><code>size</code> (int, optional): Number of records to fetch, defaults to all available records</li> <li><code>close</code> (bool, optional): Whether to automatically close cursor connection</li> </ul> <p>Return Value: Returns list of records</p> <p>Example:</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\nusers = await result.fetch_many(10)  # Get 10 records\n</code></pre>"},{"location":"en/v2/api/#fetch_all","title":"fetch_all()","text":"<p>Get all records.</p> <pre><code>async def fetch_all(self) -&gt; list[T]\n</code></pre> <p>Return Value: Returns list of all records</p> <p>Note: This method will automatically close cursor connection</p> <p>Example:</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\nall_users = await result.fetch_all()\n</code></pre>"},{"location":"en/v2/api/#iterate","title":"iterate()","text":"<p>Async generator, iterate through all records.</p> <pre><code>async def iterate(self) -&gt; AsyncGenerator[T, None]\n</code></pre> <p>Return Value: Async generator, returns records row by row</p> <p>Note: This method will automatically close cursor connection</p> <p>Example:</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\nasync for user in result.iterate():\n    print(user)\n</code></pre>"},{"location":"en/v2/api/#close","title":"close()","text":"<p>Close cursor and release connection.</p> <pre><code>async def close(self) -&gt; None\n</code></pre> <p>Example:</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\ndata = await result.fetch_one(close=False)\n# ... other operations\nawait result.close()  # Manual close\n</code></pre>"},{"location":"en/v2/api/#attributes_2","title":"Attributes","text":""},{"location":"en/v2/api/#error","title":"error","text":"<p>Error exception object.</p> <pre><code>@property\ndef error(self) -&gt; Optional[MySQLError]\n</code></pre> <p>Return Value: <code>MySQLError</code> exception object, returns <code>None</code> if no error</p> <p>Example:</p> <pre><code>result = await engine.execute(\"SELECT * FROM invalid_table\")\nif result.error:\n    print(f\"Error: {result.error}\")\n</code></pre>"},{"location":"en/v2/api/#error_no","title":"error_no","text":"<p>Error code.</p> <pre><code>@property\ndef error_no(self) -&gt; int\n</code></pre> <p>Return Value: Error code (integer), returns <code>0</code> if no error</p> <p>Example:</p> <pre><code>if result.error:\n    print(f\"Error code: {result.error_no}\")\n</code></pre>"},{"location":"en/v2/api/#error_msg","title":"error_msg","text":"<p>Error message.</p> <pre><code>@property\ndef error_msg(self) -&gt; str\n</code></pre> <p>Return Value: Error message (string), returns empty string if no error</p> <p>Example:</p> <pre><code>if result.error:\n    print(f\"Error message: {result.error_msg}\")\n</code></pre>"},{"location":"en/v2/api/#row_count","title":"row_count","text":"<p>Number of affected rows.</p> <pre><code>@property\ndef row_count(self) -&gt; Optional[int]\n</code></pre> <p>Return Value: - Number of affected rows (integer) - Returns <code>None</code> if error occurs - Returns <code>None</code> if using streaming query (<code>stream=True</code>)</p> <p>Example:</p> <pre><code>result = await engine.execute(\"INSERT INTO users (name) VALUES (%s)\", (\"\u5f20\u4e09\",))\nprint(f\"Inserted {result.row_count} records\")\n</code></pre>"},{"location":"en/v2/api/#last_rowid","title":"last_rowid","text":"<p>ID of the most recently inserted record.</p> <pre><code>@property\ndef last_rowid(self) -&gt; Optional[int]\n</code></pre> <p>Return Value: - ID of the most recently inserted record (integer) - Returns <code>None</code> if no data inserted or error occurs</p> <p>Example:</p> <pre><code>result = await engine.execute(\"INSERT INTO users (name) VALUES (%s)\", (\"\u5f20\u4e09\",))\nprint(f\"Newly inserted ID: {result.last_rowid}\")\n</code></pre>"},{"location":"en/v2/api/#row_number","title":"row_number","text":"<p>Current cursor position.</p> <pre><code>@property\ndef row_number(self) -&gt; Optional[int]\n</code></pre> <p>Return Value: - Current cursor row index in result set (0-based) - Returns <code>None</code> if index cannot be determined or error occurs</p> <p>Example:</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\nwhile True:\n    row = await result.fetch_one(close=False)\n    if not row:\n        break\n    print(f\"Current position: {result.row_number}\")\n</code></pre>"},{"location":"en/v2/api/#special-methods_1","title":"Special Methods","text":""},{"location":"en/v2/api/#aenter-aexit_1","title":"aenter() / aexit()","text":"<p>Support for <code>async with</code> syntax.</p> <pre><code>async def __aenter__(self) -&gt; Result[T]\nasync def __aexit__(self, exc_type, exc_value, exc_tb) -&gt; None\n</code></pre> <p>Example:</p> <pre><code>async with engine.execute(\"SELECT * FROM users\") as result:\n    data = await result.fetch_all()\n</code></pre>"},{"location":"en/v2/api/#aiter-anext","title":"aiter() / anext()","text":"<p>Support for <code>async for</code> syntax.</p> <pre><code>def __aiter__(self) -&gt; Result[T]\nasync def __anext__(self) -&gt; T\n</code></pre> <p>Example:</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\nasync for user in result:\n    print(user)\n</code></pre>"},{"location":"en/v2/api/#await_1","title":"await()","text":"<p>Support for <code>await result</code> syntax.</p> <pre><code>def __await__(self) -&gt; Generator[Any, None, Result[T]]\n</code></pre> <p>Example:</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\n# Equivalent to executing SQL query\n</code></pre>"},{"location":"en/v2/api/#call_1","title":"call()","text":"<p>Support for <code>await result()</code> syntax.</p> <pre><code>async def __call__(self) -&gt; Result[T]\n</code></pre> <p>Example:</p> <pre><code>result = engine.execute(\"SELECT * FROM users\")\nawait result()  # Execute query\ndata = await result.fetch_all()\n</code></pre>"},{"location":"en/v2/api/#type-definitions","title":"Type Definitions","text":""},{"location":"en/v2/api/#enginestatus","title":"EngineStatus","text":"<p>Connection engine status type.</p> <pre><code>class EngineStatus(TypedDict):\n    address: str\n    connected: bool\n    pool_minsize: Optional[int]\n    pool_maxsize: Optional[int]\n    pool_size: Optional[int]\n    pool_free: Optional[int]\n    pool_used: Optional[int]\n</code></pre>"},{"location":"en/v2/api/#type-aliases","title":"Type Aliases","text":"<pre><code>AsyncEngine = Engine\nAsyncResult = Result\n</code></pre> <p>These type aliases are used for backward compatibility or type hints.</p>"},{"location":"en/v2/api/#import-methods","title":"Import Methods","text":"<pre><code># Method 1: Import from main module\nfrom asmysql import Engine, AsMysql, Result\n\n# Method 2: Import from v2 submodule\nfrom asmysql.v2 import Engine, AsMysql, Result\n\n# Method 3: Use type aliases\nfrom asmysql import AsyncEngine, AsyncResult\n</code></pre>"},{"location":"en/v2/best-practices/","title":"Best Practices","text":""},{"location":"en/v2/best-practices/#1-for-simple-mysql-connection-scenarios-use-context-management","title":"1. For Simple MySQL Connection Scenarios, Use Context Management","text":""},{"location":"en/v2/best-practices/#recommended-use-context-manager","title":"\u2705 Recommended: Use Context Manager","text":"<pre><code># Use context manager to automatically manage connections\nasync with engine:\n    # Execute SQL statement using context manager\n    async with engine.execute(\"select user,host from mysql.user\") as result:\n        async for item in result.iterate():\n            print(item)\n    # Automatically disconnect MySQL connection on exit\n</code></pre>"},{"location":"en/v2/best-practices/#not-recommended-forget-to-disconnect","title":"\u274c Not Recommended: Forget to Disconnect","text":"<pre><code>await engine.connect()\nresult = await engine.execute(\"SELECT * FROM users\")\n# Forgot await engine.disconnect()\n</code></pre>"},{"location":"en/v2/best-practices/#2-about-close-parameter","title":"2. About <code>close</code> Parameter","text":"<p>The <code>fetch_one()</code> and <code>fetch_many()</code> methods provide a <code>close</code> parameter to control whether to automatically close the cursor connection:</p>"},{"location":"en/v2/best-practices/#recommended-use-context-manager-automatic-connection-management","title":"\u2705 Recommended: Use Context Manager (Automatic Connection Management)","text":"<p>When using <code>async with</code>, the connection will be automatically closed when exiting the context, no manual management needed:</p> <pre><code>async with engine.execute(\"SELECT * FROM users\") as result:\n    data = await result.fetch_one()  # close parameter will be ignored, connection managed by context manager\n    # Automatically close connection on exit\n</code></pre>"},{"location":"en/v2/best-practices/#recommended-use-async-for-automatic-connection-management","title":"\u2705 Recommended: Use <code>async for</code> (Automatic Connection Management)","text":"<p>When using <code>async for</code>, the connection will be automatically closed after iteration completes:</p> <pre><code>async for item in engine.execute(\"SELECT * FROM users\"):\n    print(item)\n    # Automatically close connection after iteration completes\n</code></pre>"},{"location":"en/v2/best-practices/#note-manual-control-of-close-parameter","title":"\u26a0\ufe0f Note: Manual Control of <code>close</code> Parameter","text":"<p>If you need to manually control connection closing in <code>fetch_one()</code> or <code>fetch_many()</code>, note:</p> <pre><code># Default behavior: automatically close connection (recommended)\nresult = await engine.execute(\"SELECT * FROM users\")\ndata = await result.fetch_one()  # Default close=True, automatically close connection\n\n# Manual control: do not auto-close (need manual release)\nresult = await engine.execute(\"SELECT * FROM users\")\ndata1 = await result.fetch_one(close=False)  # Do not close connection\ndata2 = await result.fetch_one(close=False)  # Continue using same connection\nawait result.close()  # \u26a0\ufe0f Must manually close, otherwise connection pool may have issues\n</code></pre> <p>Important Notes: - If setting <code>close=False</code>, must call <code>result.close()</code> to release connection after completion - Otherwise the connection will not be returned to the pool, which may cause connection pool exhaustion - When using context manager or <code>async for</code>, the <code>close</code> parameter will be ignored, connection is automatically managed by the framework</p>"},{"location":"en/v2/best-practices/#3-error-handling","title":"3. Error Handling","text":""},{"location":"en/v2/best-practices/#recommended-check-errors","title":"\u2705 Recommended: Check Errors","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users\")\nif result.error:\n    logger.error(f\"Query failed: {result.error_msg}\")\n    return []\nreturn await result.fetch_all()\n</code></pre>"},{"location":"en/v2/best-practices/#not-recommended-ignore-errors","title":"\u274c Not Recommended: Ignore Errors","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users\")\ndata = await result.fetch_all()  # If error occurs, data may be empty list\n</code></pre>"},{"location":"en/v2/best-practices/#4-large-dataset-processing","title":"4. Large Dataset Processing","text":""},{"location":"en/v2/best-practices/#recommended-use-streaming-query","title":"\u2705 Recommended: Use Streaming Query","text":"<pre><code>async for row in engine.execute(\"SELECT * FROM large_table\", stream=True):\n    process(row)\n</code></pre>"},{"location":"en/v2/best-practices/#not-recommended-load-all-data-at-once","title":"\u274c Not Recommended: Load All Data at Once","text":"<pre><code>data = await engine.execute(\"SELECT * FROM large_table\")\nall_data = await data.fetch_all()  # May cause memory overflow\n</code></pre>"},{"location":"en/v2/best-practices/#5-parameterized-queries","title":"5. Parameterized Queries","text":""},{"location":"en/v2/best-practices/#recommended-use-parameterized-queries-to-prevent-sql-injection","title":"\u2705 Recommended: Use Parameterized Queries to Prevent SQL Injection","text":"<pre><code>result = await engine.execute(\n    \"SELECT * FROM users WHERE name = %s\",\n    (user_name,)\n)\n</code></pre>"},{"location":"en/v2/best-practices/#not-recommended-string-concatenation","title":"\u274c Not Recommended: String Concatenation","text":"<pre><code>result = await engine.execute(\n    f\"SELECT * FROM users WHERE name = '{user_name}'\"\n)\n</code></pre>"},{"location":"en/v2/best-practices/#6-connection-pool-configuration","title":"6. Connection Pool Configuration","text":""},{"location":"en/v2/best-practices/#recommended-configure-connection-pool-based-on-application-load","title":"\u2705 Recommended: Configure Connection Pool Based on Application Load","text":"<pre><code>engine = Engine(\n    url=\"mysql://root:pass@127.0.0.1:3306/\",\n    min_pool_size=5,   # Maintain minimum connections\n    max_pool_size=50,  # Set maximum based on concurrency\n    pool_recycle=3600  # Recycle idle connections after 1 hour\n)\n</code></pre>"},{"location":"en/v2/best-practices/#not-recommended-use-default-values-may-not-be-suitable-for-production","title":"\u274c Not Recommended: Use Default Values (May Not Be Suitable for Production)","text":"<pre><code>engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n</code></pre>"},{"location":"en/v2/best-practices/#related-documentation","title":"Related Documentation","text":"<ul> <li>Connection Management - Learn detailed connection configuration</li> <li>Query Operations - Learn query best practices</li> </ul>"},{"location":"en/v2/business-logic/","title":"Business Logic Development","text":""},{"location":"en/v2/business-logic/#inherit-asmysql-class","title":"Inherit AsMysql Class","text":"<p>The <code>AsMysql</code> class provides a base class for business logic development, making it convenient to organize code through inheritance:</p> <pre><code>from asmysql import Engine, AsMysql\n\nclass UserService(AsMysql):\n    async def get_user_by_id(self, user_id: int):\n        result = await self.client.execute(\n            \"SELECT * FROM users WHERE id = %s\",\n            (user_id,),\n            result_class=dict\n        )\n        if result.error:\n            return None\n        return await result.fetch_one()\n\n    async def create_user(self, name: str, email: str):\n        result = await self.client.execute(\n            \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n            (name, email)\n        )\n        if result.error:\n            raise Exception(f\"Failed to create user: {result.error_msg}\")\n        return result.last_rowid\n\n    async def list_users(self):\n        result = await self.client.execute(\n            \"SELECT * FROM users\",\n            result_class=dict\n        )\n        if result.error:\n            return []\n        return await result.fetch_all()\n</code></pre>"},{"location":"en/v2/business-logic/#using-business-logic-class","title":"Using Business Logic Class","text":"<pre><code># Create engine\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\n# Create business logic instance\nuser_service = UserService(engine)\n\n# Use business methods\nuser = await user_service.get_user_by_id(1)\nusers = await user_service.list_users()\nnew_user_id = await user_service.create_user(\"\u5f20\u4e09\", \"zhangsan@example.com\")\n</code></pre>"},{"location":"en/v2/business-logic/#advantages","title":"Advantages","text":"<ul> <li>Code Organization: Encapsulate database operations in business classes for easy maintenance</li> <li>Reusability: Business methods can be reused in multiple places</li> <li>Type Safety: Combined with type hints to improve code quality</li> <li>Test Friendly: Easy to perform unit testing</li> </ul>"},{"location":"en/v2/business-logic/#related-documentation","title":"Related Documentation","text":"<ul> <li>Quick Start - View basic usage examples</li> <li>Usage Examples - View more business logic examples</li> </ul>"},{"location":"en/v2/changelog/","title":"asmysql v2 Changelog","text":"<p>This document records all changes in asmysql v2 version.</p>"},{"location":"en/v2/changelog/#v200","title":"v2.0.0","text":""},{"location":"en/v2/changelog/#breaking-changes","title":"Breaking Changes","text":"<p>v2.0.0 is a completely refactored version that is incompatible with v1. Main changes include:</p> <ul> <li>Architecture Refactoring: Separated <code>Engine</code> and <code>AsMysql</code> classes, added independent <code>Engine</code> class to handle MySQL connections and execute statements</li> <li>Result Class Changes: <code>Result.err</code> attribute renamed to <code>Result.error</code></li> <li>API Changes: Connection method changed from auto-connect to explicitly creating <code>Engine</code> and calling <code>connect()</code></li> </ul>"},{"location":"en/v2/changelog/#new-features","title":"New Features","text":"<ul> <li>Engine Class: Brand new connection engine class with URL connection string support, connection status monitoring, and flexible connection management</li> <li>Result Class Enhancements: Support for error information access (<code>error_no</code>, <code>error_msg</code>), streaming queries, context managers, async iterators, and custom result types</li> <li>Execution Method Enhancements: <code>execute()</code> method supports <code>stream</code>, <code>result_class</code>, <code>commit</code> parameters and multiple calling methods</li> <li>Type Hints: Complete type hint support with generic types (<code>Result[T]</code>)</li> <li>Testing: New pytest test suite covering main functional scenarios</li> </ul>"},{"location":"en/v2/changelog/#updates","title":"Updates","text":"<ul> <li>Package Management Tool: Using <code>uv</code> as package management tool</li> <li>Code Quality: Improved code structure, error handling, and docstrings</li> </ul>"},{"location":"en/v2/changelog/#core-features","title":"Core Features","text":"<p>v2 version retains the core features of v1:</p> <ol> <li>Easy to Use: asmysql is an easy-to-use library that wraps aiomysql</li> <li>Connection Pool Management: Automatic MySQL connection pool management with reconnection mechanism</li> <li>Error Handling: Global automatic capture of <code>MysqlError</code> errors</li> <li>Separation of Execution and Retrieval: Separation of SQL statement execution and result retrieval</li> <li>Type Hints: Complete Python type hint support</li> <li>Business Logic Development: Directly inherit <code>AsMysql</code> class for logic development</li> </ol>"},{"location":"en/v2/changelog/#migration-guide","title":"Migration Guide","text":"<p>For detailed migration guide, please refer to Migration Guide.</p>"},{"location":"en/v2/connection/","title":"Connection Management","text":""},{"location":"en/v2/connection/#connection-configuration","title":"Connection Configuration","text":""},{"location":"en/v2/connection/#using-url-connection-string","title":"Using URL Connection String","text":"<pre><code>from asmysql import Engine\n\n# Basic URL\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/?charset=utf8mb4\")\n\n# Complete URL (with all parameters)\nengine = Engine(\n    url=\"mysql://root:pass@127.0.0.1:3306/\"\n    \"?charset=utf8mb4\"\n    \"&amp;min_pool_size=2\"\n    \"&amp;max_pool_size=20\"\n    \"&amp;pool_recycle=3600\"\n    \"&amp;connect_timeout=10\"\n    \"&amp;auto_commit=true\"\n    \"&amp;echo_sql_log=false\"\n)\n</code></pre>"},{"location":"en/v2/connection/#using-keyword-arguments","title":"Using Keyword Arguments","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(\n    host=\"127.0.0.1\",\n    port=3306,\n    user=\"root\",\n    password=\"pass\",\n    charset=\"utf8mb4\",\n    min_pool_size=1,\n    max_pool_size=10,\n    pool_recycle=-1,\n    connect_timeout=5,\n    auto_commit=True,\n    echo_sql_log=False,\n    stream=False,\n    result_class=tuple\n)\n</code></pre>"},{"location":"en/v2/connection/#connection-parameters","title":"Connection Parameters","text":"Parameter Type Default Description <code>host</code> str <code>\"127.0.0.1\"</code> MySQL server address <code>port</code> int <code>3306</code> MySQL server port <code>user</code> str <code>\"\"</code> Username <code>password</code> str <code>\"\"</code> Password <code>charset</code> str <code>\"utf8mb4\"</code> Character set <code>min_pool_size</code> int <code>1</code> Minimum connection pool size <code>max_pool_size</code> int <code>10</code> Maximum connection pool size <code>pool_recycle</code> float <code>-1</code> Idle connection recycle time (seconds), -1 means no recycle <code>connect_timeout</code> int <code>5</code> Connection timeout (seconds) <code>auto_commit</code> bool <code>True</code> Whether to auto-commit transactions <code>echo_sql_log</code> bool <code>False</code> Whether to print SQL logs <code>stream</code> bool <code>False</code> Whether to use streaming result <code>result_class</code> type <code>tuple</code> Result type"},{"location":"en/v2/connection/#connect-and-disconnect","title":"Connect and Disconnect","text":""},{"location":"en/v2/connection/#method-1-explicit-connection","title":"Method 1: Explicit Connection","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n\n# Connect\nawait engine.connect()\n# ... use engine\nawait engine.disconnect()\n</code></pre>"},{"location":"en/v2/connection/#method-2-using-context-manager","title":"Method 2: Using Context Manager","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n\nasync with engine:\n    # ... use engine\n    pass  # Automatically disconnect\n</code></pre>"},{"location":"en/v2/connection/#method-3-using-await","title":"Method 3: Using await","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n\nawait engine()  # Equivalent to await engine.connect()\n</code></pre>"},{"location":"en/v2/connection/#check-connection-status","title":"Check Connection Status","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n\n# Check if connected\nif engine.is_connected:\n    print(\"Connected\")\n\n# Get connection status information\nawait engine.connect()\nstatus = engine.status\nprint(f\"Address: {status['address']}\")\nprint(f\"Connected: {status['connected']}\")\nprint(f\"Pool size: {status['pool_size']}\")\nprint(f\"Free connections: {status['pool_free']}\")\nprint(f\"Used connections: {status['pool_used']}\")\n</code></pre>"},{"location":"en/v2/connection/#release-connections","title":"Release Connections","text":"<pre><code># Release all idle connections in the pool\nawait engine.release_connections()\n</code></pre>"},{"location":"en/v2/examples/","title":"asmysql v2 Usage Examples","text":"<p>This document provides detailed usage examples for asmysql v2 version.</p>"},{"location":"en/v2/examples/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Basic Examples</li> <li>Connection Management</li> <li>Query Operations</li> <li>Insert Operations</li> <li>Update Operations</li> <li>Delete Operations</li> <li>Transaction Processing</li> <li>Streaming Queries</li> <li>Batch Operations</li> <li>Custom Models</li> <li>Error Handling</li> <li>Business Logic Encapsulation</li> <li>Complete Application Examples</li> </ul>"},{"location":"en/v2/examples/#basic-examples","title":"Basic Examples","text":""},{"location":"en/v2/examples/#simplest-query","title":"Simplest Query","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    # Create engine\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n\n    # Connect\n    await engine.connect()\n\n    # Execute query\n    result = await engine.execute(\"SELECT 1 as value\")\n    data = await result.fetch_one()\n    print(data)  # (1,)\n\n    # Disconnect\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#using-context-manager","title":"Using Context Manager","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n\n    async with engine:\n        result = await engine.execute(\"SELECT 1 as value\")\n        data = await result.fetch_one()\n        print(data)\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#connection-management","title":"Connection Management","text":""},{"location":"en/v2/examples/#check-connection-status","title":"Check Connection Status","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n\n    print(f\"Before connection: {engine.is_connected}\")  # False\n\n    await engine.connect()\n    print(f\"After connection: {engine.is_connected}\")  # True\n\n    # View connection pool status\n    status = engine.status\n    print(f\"Connection address: {status['address']}\")\n    print(f\"Pool size: {status['pool_size']}\")\n    print(f\"Free connections: {status['pool_free']}\")\n    print(f\"Used connections: {status['pool_used']}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#connection-pool-configuration","title":"Connection Pool Configuration","text":"<pre><code>from asmysql import Engine\n\n# Configure connection pool\nengine = Engine(\n    url=\"mysql://root:pass@127.0.0.1:3306/test_db\",\n    min_pool_size=5,      # Minimum connections\n    max_pool_size=50,     # Maximum connections\n    pool_recycle=3600,    # Recycle idle connections after 1 hour\n    connect_timeout=10    # Connection timeout 10 seconds\n)\n</code></pre>"},{"location":"en/v2/examples/#query-operations","title":"Query Operations","text":""},{"location":"en/v2/examples/#single-record-query","title":"Single Record Query","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # Using tuple type (default)\n    result = await engine.execute(\n        \"SELECT id, name, email FROM users WHERE id = %s\",\n        (1,)\n    )\n    user = await result.fetch_one()\n    if user:\n        print(f\"ID: {user[0]}, Name: {user[1]}, Email: {user[2]}\")\n\n    # Using dict type\n    result = await engine.execute(\n        \"SELECT id, name, email FROM users WHERE id = %s\",\n        (1,),\n        result_class=dict\n    )\n    user = await result.fetch_one()\n    if user:\n        print(f\"ID: {user['id']}, Name: {user['name']}, Email: {user['email']}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#multiple-records-query","title":"Multiple Records Query","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # Get all records\n    result = await engine.execute(\"SELECT * FROM users\")\n    all_users = await result.fetch_all()\n    print(f\"Total {len(all_users)} records\")\n\n    # Get specified number of records\n    result = await engine.execute(\"SELECT * FROM users\")\n    users = await result.fetch_many(10)  # Get 10 records\n    print(f\"Retrieved {len(users)} records\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#using-dictionary-parameters","title":"Using Dictionary Parameters","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # Using dictionary parameters\n    result = await engine.execute(\n        \"SELECT * FROM users WHERE name = %(name)s AND age &gt; %(age)s\",\n        {\"name\": \"\u5f20\u4e09\", \"age\": 18}\n    )\n    users = await result.fetch_all()\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#using-iterator","title":"Using Iterator","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # Method 1: Using iterate() method\n    result = await engine.execute(\"SELECT * FROM users\")\n    async for user in result.iterate():\n        print(user)\n\n    # Method 2: Direct iteration of result\n    result = await engine.execute(\"SELECT * FROM users\")\n    async for user in result:\n        print(user)\n\n    # Method 3: Direct iteration of execute result\n    async for user in engine.execute(\"SELECT * FROM users\"):\n        print(user)\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#insert-operations","title":"Insert Operations","text":""},{"location":"en/v2/examples/#single-insert","title":"Single Insert","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # Insert data\n    result = await engine.execute(\n        \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n        (\"\u5f20\u4e09\", \"zhangsan@example.com\")\n    )\n\n    if result.error:\n        print(f\"Insert failed: {result.error_msg}\")\n    else:\n        print(f\"Insert successful, affected rows: {result.row_count}\")\n        print(f\"Newly inserted ID: {result.last_rowid}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#get-inserted-id","title":"Get Inserted ID","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    result = await engine.execute(\n        \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n        (\"\u674e\u56db\", \"lisi@example.com\")\n    )\n\n    if not result.error:\n        new_id = result.last_rowid\n        print(f\"New user ID: {new_id}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#update-operations","title":"Update Operations","text":""},{"location":"en/v2/examples/#update-single-record","title":"Update Single Record","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    result = await engine.execute(\n        \"UPDATE users SET email = %s WHERE id = %s\",\n        (\"newemail@example.com\", 1)\n    )\n\n    if result.error:\n        print(f\"Update failed: {result.error_msg}\")\n    else:\n        print(f\"Update successful, affected rows: {result.row_count}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#batch-update","title":"Batch Update","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # Use execute_many for batch update\n    updates = [\n        (\"email1@example.com\", 1),\n        (\"email2@example.com\", 2),\n        (\"email3@example.com\", 3)\n    ]\n\n    result = await engine.execute_many(\n        \"UPDATE users SET email = %s WHERE id = %s\",\n        updates\n    )\n\n    if not result.error:\n        print(f\"Batch update successful, affected rows: {result.row_count}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#delete-operations","title":"Delete Operations","text":""},{"location":"en/v2/examples/#delete-record","title":"Delete Record","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    result = await engine.execute(\n        \"DELETE FROM users WHERE id = %s\",\n        (1,)\n    )\n\n    if result.error:\n        print(f\"Delete failed: {result.error_msg}\")\n    else:\n        print(f\"Delete successful, affected rows: {result.row_count}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#transaction-processing","title":"Transaction Processing","text":""},{"location":"en/v2/examples/#basic-transaction","title":"Basic Transaction","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    # Disable auto commit\n    engine = Engine(\n        url=\"mysql://root:pass@127.0.0.1:3306/test_db\",\n        auto_commit=False\n    )\n    await engine.connect()\n\n    try:\n        # Insert user\n        result1 = await engine.execute(\n            \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n            (\"\u5f20\u4e09\", \"zhangsan@example.com\"),\n            commit=False\n        )\n        if result1.error:\n            raise Exception(result1.error_msg)\n\n        user_id = result1.last_rowid\n\n        # Insert user profile\n        result2 = await engine.execute(\n            \"INSERT INTO user_profiles (user_id, bio) VALUES (%s, %s)\",\n            (user_id, \"\u8fd9\u662f\u5f20\u4e09\u7684\u4e2a\u4eba\u7b80\u4ecb\"),\n            commit=False\n        )\n        if result2.error:\n            raise Exception(result2.error_msg)\n\n        # Manual commit (need to access connection object)\n        # Note: Transaction management in v2 requires manual control\n        # This is a simplified example, actual usage requires more fine-grained control\n\n    except Exception as e:\n        print(f\"Transaction failed: {e}\")\n        # Rollback operations need manual handling\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#streaming-queries","title":"Streaming Queries","text":""},{"location":"en/v2/examples/#processing-large-datasets","title":"Processing Large Datasets","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # Enable streaming query\n    result = await engine.execute(\n        \"SELECT * FROM large_table\",\n        stream=True\n    )\n\n    count = 0\n    async for row in result:\n        count += 1\n        # Process each row of data without memory consumption\n        process_row(row)\n\n        if count % 1000 == 0:\n            print(f\"Processed {count} records\")\n\n    print(f\"Total processed {count} records\")\n\n    await engine.disconnect()\n\ndef process_row(row):\n    \"\"\"Process single row of data\"\"\"\n    pass\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#streaming-query-vs-regular-query-comparison","title":"Streaming Query vs Regular Query Comparison","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # Regular query: All data loaded into memory\n    result1 = await engine.execute(\"SELECT * FROM large_table\", stream=False)\n    all_data = await result1.fetch_all()  # May cause memory overflow\n    print(f\"Regular query retrieved {len(all_data)} records\")\n\n    # Streaming query: Process row by row without memory consumption\n    result2 = await engine.execute(\"SELECT * FROM large_table\", stream=True)\n    count = 0\n    async for row in result2:\n        count += 1\n    print(f\"Streaming query processed {count} records\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#batch-operations","title":"Batch Operations","text":""},{"location":"en/v2/examples/#batch-insert","title":"Batch Insert","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # Prepare batch data\n    users = [\n        (\"\u5f20\u4e09\", \"zhangsan@example.com\"),\n        (\"\u674e\u56db\", \"lisi@example.com\"),\n        (\"\u738b\u4e94\", \"wangwu@example.com\"),\n        (\"\u8d75\u516d\", \"zhaoliu@example.com\")\n    ]\n\n    # Batch insert\n    result = await engine.execute_many(\n        \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n        users\n    )\n\n    if result.error:\n        print(f\"Batch insert failed: {result.error_msg}\")\n    else:\n        print(f\"Batch insert successful, inserted {result.row_count} records\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#batch-insert-using-dictionary","title":"Batch Insert Using Dictionary","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # Batch data in dictionary format\n    users = [\n        {\"name\": \"\u5f20\u4e09\", \"email\": \"zhangsan@example.com\"},\n        {\"name\": \"\u674e\u56db\", \"email\": \"lisi@example.com\"},\n        {\"name\": \"\u738b\u4e94\", \"email\": \"wangwu@example.com\"}\n    ]\n\n    result = await engine.execute_many(\n        \"INSERT INTO users (name, email) VALUES (%(name)s, %(email)s)\",\n        users\n    )\n\n    if not result.error:\n        print(f\"Batch insert successful, inserted {result.row_count} records\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#custom-models","title":"Custom Models","text":""},{"location":"en/v2/examples/#using-pydantic-models","title":"Using Pydantic Models","text":"<pre><code>import asyncio\nfrom pydantic import BaseModel\nfrom asmysql import Engine\n\n# Define user model\nclass User(BaseModel):\n    id: int\n    name: str\n    email: str\n    age: int = 0\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # Query and use custom model\n    result = await engine.execute(\n        \"SELECT id, name, email, age FROM users WHERE id = %s\",\n        (1,),\n        result_class=User\n    )\n\n    user = await result.fetch_one()\n    if user:\n        print(f\"User: {user.name}, Email: {user.email}, Age: {user.age}\")\n        # Can use all model features\n        print(user.model_dump())\n\n    # Batch query\n    result = await engine.execute(\n        \"SELECT id, name, email, age FROM users\",\n        result_class=User\n    )\n\n    users = []\n    async for user in result.iterate():\n        users.append(user)\n        print(f\"{user.name}: {user.email}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#using-plain-classes","title":"Using Plain Classes","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\n# Define plain class\nclass User:\n    def __init__(self, id: int, name: str, email: str):\n        self.id = id\n        self.name = name\n        self.email = email\n\n    def __repr__(self):\n        return f\"User(id={self.id}, name={self.name}, email={self.email})\"\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    result = await engine.execute(\n        \"SELECT id, name, email FROM users\",\n        result_class=User\n    )\n\n    async for user in result:\n        print(user)  # Automatically converted to User instance\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#error-handling","title":"Error Handling","text":""},{"location":"en/v2/examples/#basic-error-handling","title":"Basic Error Handling","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    result = await engine.execute(\"SELECT * FROM non_existent_table\")\n\n    if result.error:\n        print(f\"Error code: {result.error_no}\")\n        print(f\"Error message: {result.error_msg}\")\n        print(f\"Error object: {result.error}\")\n    else:\n        data = await result.fetch_all()\n        print(f\"Query successful, retrieved {len(data)} records\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#error-handling-decorator","title":"Error Handling Decorator","text":"<pre><code>import asyncio\nfrom functools import wraps\nfrom asmysql import Engine\n\ndef handle_db_errors(func):\n    \"\"\"Database error handling decorator\"\"\"\n    @wraps(func)\n    async def wrapper(*args, **kwargs):\n        try:\n            return await func(*args, **kwargs)\n        except Exception as e:\n            print(f\"Database operation failed: {e}\")\n            return None\n    return wrapper\n\n@handle_db_errors\nasync def get_user(engine: Engine, user_id: int):\n    result = await engine.execute(\n        \"SELECT * FROM users WHERE id = %s\",\n        (user_id,),\n        result_class=dict\n    )\n    if result.error:\n        raise Exception(f\"Query failed: {result.error_msg}\")\n    return await result.fetch_one()\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    user = await get_user(engine, 1)\n    if user:\n        print(f\"User: {user['name']}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#business-logic-encapsulation","title":"Business Logic Encapsulation","text":""},{"location":"en/v2/examples/#user-service-class","title":"User Service Class","text":"<pre><code>import asyncio\nfrom typing import Optional, List\nfrom pydantic import BaseModel\nfrom asmysql import Engine, AsMysql\n\nclass User(BaseModel):\n    id: int\n    name: str\n    email: str\n    age: int = 0\n\nclass UserService(AsMysql):\n    \"\"\"User service class\"\"\"\n\n    async def get_user_by_id(self, user_id: int) -&gt; Optional[User]:\n        \"\"\"Get user by ID\"\"\"\n        result = await self.client.execute(\n            \"SELECT id, name, email, age FROM users WHERE id = %s\",\n            (user_id,),\n            result_class=User\n        )\n        if result.error:\n            return None\n        return await result.fetch_one()\n\n    async def get_user_by_email(self, email: str) -&gt; Optional[User]:\n        \"\"\"Get user by email\"\"\"\n        result = await self.client.execute(\n            \"SELECT id, name, email, age FROM users WHERE email = %s\",\n            (email,),\n            result_class=User\n        )\n        if result.error:\n            return None\n        return await result.fetch_one()\n\n    async def list_users(self, limit: int = 100) -&gt; List[User]:\n        \"\"\"Get user list\"\"\"\n        result = await self.client.execute(\n            \"SELECT id, name, email, age FROM users LIMIT %s\",\n            (limit,),\n            result_class=User\n        )\n        if result.error:\n            return []\n        return await result.fetch_all()\n\n    async def create_user(self, name: str, email: str, age: int = 0) -&gt; Optional[int]:\n        \"\"\"Create user\"\"\"\n        result = await self.client.execute(\n            \"INSERT INTO users (name, email, age) VALUES (%s, %s, %s)\",\n            (name, email, age)\n        )\n        if result.error:\n            return None\n        return result.last_rowid\n\n    async def update_user(self, user_id: int, name: str = None, email: str = None, age: int = None) -&gt; bool:\n        \"\"\"Update user\"\"\"\n        updates = []\n        values = []\n\n        if name is not None:\n            updates.append(\"name = %s\")\n            values.append(name)\n        if email is not None:\n            updates.append(\"email = %s\")\n            values.append(email)\n        if age is not None:\n            updates.append(\"age = %s\")\n            values.append(age)\n\n        if not updates:\n            return False\n\n        values.append(user_id)\n        query = f\"UPDATE users SET {', '.join(updates)} WHERE id = %s\"\n\n        result = await self.client.execute(query, tuple(values))\n        return result.error is None\n\n    async def delete_user(self, user_id: int) -&gt; bool:\n        \"\"\"Delete user\"\"\"\n        result = await self.client.execute(\n            \"DELETE FROM users WHERE id = %s\",\n            (user_id,)\n        )\n        return result.error is None\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    user_service = UserService(engine)\n\n    # Create user\n    user_id = await user_service.create_user(\"\u5f20\u4e09\", \"zhangsan@example.com\", 25)\n    print(f\"Created user, ID: {user_id}\")\n\n    # Get user\n    user = await user_service.get_user_by_id(user_id)\n    if user:\n        print(f\"User: {user.name}, Email: {user.email}, Age: {user.age}\")\n\n    # Update user\n    success = await user_service.update_user(user_id, age=26)\n    print(f\"Update user: {success}\")\n\n    # Get user list\n    users = await user_service.list_users(10)\n    print(f\"User list, total {len(users)} records\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/examples/#complete-application-examples","title":"Complete Application Examples","text":""},{"location":"en/v2/examples/#web-application-example-fastapi","title":"Web Application Example (FastAPI)","text":"<pre><code>from fastapi import FastAPI, HTTPException\nfrom pydantic import BaseModel\nfrom asmysql import Engine, AsMysql\nfrom contextlib import asynccontextmanager\n\n# Global engine\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    # Connect on startup\n    await engine.connect()\n    yield\n    # Disconnect on shutdown\n    await engine.disconnect()\n\napp = FastAPI(lifespan=lifespan)\n\n# Data models\nclass UserCreate(BaseModel):\n    name: str\n    email: str\n    age: int = 0\n\nclass UserResponse(BaseModel):\n    id: int\n    name: str\n    email: str\n    age: int\n\n# Service class\nclass UserService(AsMysql):\n    async def create_user(self, user_data: UserCreate) -&gt; int:\n        result = await self.client.execute(\n            \"INSERT INTO users (name, email, age) VALUES (%s, %s, %s)\",\n            (user_data.name, user_data.email, user_data.age)\n        )\n        if result.error:\n            raise HTTPException(status_code=500, detail=result.error_msg)\n        return result.last_rowid\n\n    async def get_user(self, user_id: int) -&gt; UserResponse:\n        result = await self.client.execute(\n            \"SELECT id, name, email, age FROM users WHERE id = %s\",\n            (user_id,),\n            result_class=UserResponse\n        )\n        if result.error:\n            raise HTTPException(status_code=500, detail=result.error_msg)\n        user = await result.fetch_one()\n        if not user:\n            raise HTTPException(status_code=404, detail=\"\u7528\u6237\u4e0d\u5b58\u5728\")\n        return user\n\n# API routes\n@app.post(\"/users\", response_model=UserResponse)\nasync def create_user(user_data: UserCreate):\n    service = UserService(engine)\n    user_id = await service.create_user(user_data)\n    return await service.get_user(user_id)\n\n@app.get(\"/users/{user_id}\", response_model=UserResponse)\nasync def get_user(user_id: int):\n    service = UserService(engine)\n    return await service.get_user(user_id)\n</code></pre>"},{"location":"en/v2/examples/#command-line-tool-example","title":"Command Line Tool Example","text":"<pre><code>import asyncio\nimport argparse\nfrom asmysql import Engine, AsMysql\n\nclass UserCLI(AsMysql):\n    async def list_users(self):\n        \"\"\"List all users\"\"\"\n        result = await self.client.execute(\n            \"SELECT id, name, email FROM users\",\n            result_class=dict\n        )\n        if result.error:\n            print(f\"Error: {result.error_msg}\")\n            return\n\n        users = await result.fetch_all()\n        print(f\"Total {len(users)} users:\")\n        for user in users:\n            print(f\"  ID: {user['id']}, Name: {user['name']}, Email: {user['email']}\")\n\n    async def add_user(self, name: str, email: str):\n        \"\"\"Add user\"\"\"\n        result = await self.client.execute(\n            \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n            (name, email)\n        )\n        if result.error:\n            print(f\"Add failed: {result.error_msg}\")\n        else:\n            print(f\"Add successful, ID: {result.last_rowid}\")\n\nasync def main():\n    parser = argparse.ArgumentParser(description=\"\u7528\u6237\u7ba1\u7406\u5de5\u5177\")\n    parser.add_argument(\"--host\", default=\"127.0.0.1\", help=\"MySQL \u4e3b\u673a\")\n    parser.add_argument(\"--port\", type=int, default=3306, help=\"MySQL \u7aef\u53e3\")\n    parser.add_argument(\"--user\", default=\"root\", help=\"MySQL \u7528\u6237\")\n    parser.add_argument(\"--password\", default=\"\", help=\"MySQL \u5bc6\u7801\")\n    parser.add_argument(\"--database\", required=True, help=\"\u6570\u636e\u5e93\u540d\")\n\n    subparsers = parser.add_subparsers(dest=\"command\", help=\"\u547d\u4ee4\")\n    subparsers.add_parser(\"list\", help=\"\u5217\u51fa\u7528\u6237\")\n    add_parser = subparsers.add_parser(\"add\", help=\"\u6dfb\u52a0\u7528\u6237\")\n    add_parser.add_argument(\"name\", help=\"\u7528\u6237\u540d\")\n    add_parser.add_argument(\"email\", help=\"\u90ae\u7bb1\")\n\n    args = parser.parse_args()\n\n    # Create engine\n    engine = Engine(\n        host=args.host,\n        port=args.port,\n        user=args.user,\n        password=args.password\n    )\n\n    await engine.connect()\n\n    # Select database\n    await engine.execute(f\"USE {args.database}\")\n\n    # Create CLI instance\n    cli = UserCLI(engine)\n\n    # Execute command\n    if args.command == \"list\":\n        await cli.list_users()\n    elif args.command == \"add\":\n        await cli.add_user(args.name, args.email)\n\n    await engine.disconnect()\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n</code></pre> <p>These examples cover the main usage scenarios of asmysql v2 version and can be modified and extended according to actual needs.</p>"},{"location":"en/v2/faq/","title":"FAQ","text":""},{"location":"en/v2/faq/#q-how-to-check-connection-pool-status","title":"Q: How to check connection pool status?","text":"<p>A: Use the <code>engine.status</code> attribute:</p> <pre><code>status = engine.status\nprint(status)\n</code></pre>"},{"location":"en/v2/faq/#q-whats-the-difference-between-streaming-query-and-regular-query","title":"Q: What's the difference between streaming query and regular query?","text":"<p>A: - Regular Query: Loads all results into memory, suitable for small datasets - Streaming Query: Returns results row by row, does not consume memory, suitable for large datasets</p>"},{"location":"en/v2/faq/#q-how-to-customize-result-type","title":"Q: How to customize result type?","text":"<p>A: Use the <code>result_class</code> parameter, supports <code>tuple</code>, <code>dict</code>, or custom model classes:</p> <pre><code>result = await engine.execute(\n    \"SELECT * FROM users\",\n    result_class=dict  # or custom model class\n)\n</code></pre>"},{"location":"en/v2/faq/#q-how-to-handle-transactions","title":"Q: How to handle transactions?","text":"<p>A: Set <code>auto_commit=False</code> and manage manually:</p> <pre><code>engine = Engine(url=\"...\", auto_commit=False)\nawait engine.connect()\n\n# Note: Transaction management in v2 requires manual connection control\n</code></pre>"},{"location":"en/v2/faq/#q-how-to-get-error-information","title":"Q: How to get error information?","text":"<p>A: Through <code>result.error</code>, <code>result.error_no</code>, and <code>result.error_msg</code> attributes:</p> <pre><code>result = await engine.execute(\"SELECT * FROM invalid_table\")\nif result.error:\n    print(f\"Error code: {result.error_no}\")\n    print(f\"Error message: {result.error_msg}\")\n</code></pre>"},{"location":"en/v2/faq/#q-how-to-batch-insert-data","title":"Q: How to batch insert data?","text":"<p>A: Use the <code>execute_many()</code> method:</p> <pre><code>data = [(\"\u5f20\u4e09\", \"zhangsan@example.com\"), (\"\u674e\u56db\", \"lisi@example.com\")]\nresult = await engine.execute_many(\n    \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n    data\n)\n</code></pre>"},{"location":"en/v2/faq/#q-how-to-share-engine-instance-across-different-modules","title":"Q: How to share Engine instance across different modules?","text":"<p>A: You can create an Engine instance at application startup, then share it through dependency injection or global variables:</p> <pre><code># app.py\nengine = Engine(url=\"mysql://...\")\nawait engine.connect()\n\n# service.py\nfrom app import engine\n\nclass UserService(AsMysql):\n    def __init__(self):\n        super().__init__(engine)\n</code></pre>"},{"location":"en/v2/faq/#q-how-to-set-connection-pool-size","title":"Q: How to set connection pool size?","text":"<p>A: Set based on application concurrency and database server performance:</p> <ul> <li>Low concurrency applications: <code>min_pool_size=2, max_pool_size=10</code></li> <li>Medium concurrency: <code>min_pool_size=5, max_pool_size=50</code></li> <li>High concurrency applications: <code>min_pool_size=10, max_pool_size=100+</code></li> </ul>"},{"location":"en/v2/faq/#q-how-to-handle-connection-timeout","title":"Q: How to handle connection timeout?","text":"<p>A: You can set connection timeout through the <code>connect_timeout</code> parameter:</p> <pre><code>engine = Engine(\n    url=\"mysql://...\",\n    connect_timeout=10  # 10 seconds timeout\n)\n</code></pre>"},{"location":"en/v2/faq/#related-documentation","title":"Related Documentation","text":"<ul> <li>Connection Management - Learn more about connection configuration</li> <li>Best Practices - View recommended usage patterns</li> </ul>"},{"location":"en/v2/installation/","title":"Installation Guide","text":""},{"location":"en/v2/installation/#install-from-pypi","title":"Install from PyPI","text":"<pre><code>pip install asmysql\n</code></pre>"},{"location":"en/v2/installation/#install-from-source","title":"Install from Source","text":"<pre><code>git clone https://github.com/vastxiao/asmysql.git\ncd asmysql\npip install .\n</code></pre>"},{"location":"en/v2/installation/#requirements","title":"Requirements","text":"<ul> <li>Python &gt;= 3.9</li> <li>aiomysql[rsa] &gt;= 0.3.2</li> </ul>"},{"location":"en/v2/installation/#verify-installation","title":"Verify Installation","text":"<p>After installation, you can verify the installation by trying to import the main classes:</p> <pre><code>from asmysql import Engine, AsMysql\nprint(\"Installation successful!\")\n</code></pre>"},{"location":"en/v2/migration/","title":"Migration Guide","text":""},{"location":"en/v2/migration/#migrating-from-v1-to-v2","title":"Migrating from v1 to v2","text":"<ol> <li> <p>Update Imports <pre><code># v1\nfrom asmysql import AsMysql\n\n# v2\nfrom asmysql import Engine, AsMysql\n</code></pre></p> </li> <li> <p>Update Connection Method <pre><code># v1\nclass MyService(AsMysql):\n    host = '127.0.0.1'\n    port = 3306\n    user = 'root'\n    password = 'pass'\n\nmysql = await MyService()\n\n# v2\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nclass MyService(AsMysql):\n    pass\n\nservice = MyService(engine)\n</code></pre></p> </li> <li> <p>Update Error Attributes <pre><code># v1\nif result.err:\n    print(result.err_msg)\n\n# v2\nif result.error:\n    print(result.error_msg)\n</code></pre></p> </li> <li> <p>Use New Features <pre><code># v2 new: URL connection\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n\n# v2 new: Streaming query\nasync for row in engine.execute(\"SELECT * FROM large_table\", stream=True):\n    process(row)\n\n# v2 new: Custom result type\nresult = await engine.execute(\"SELECT * FROM users\", result_class=dict)\n</code></pre></p> </li> </ol>"},{"location":"en/v2/query/","title":"Query Operations","text":""},{"location":"en/v2/query/#basic-query","title":"Basic Query","text":""},{"location":"en/v2/query/#method-1-using-await","title":"Method 1: Using await","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nresult = await engine.execute(\"SELECT * FROM users WHERE id = %s\", (1,))\ndata = await result.fetch_one()\n</code></pre>"},{"location":"en/v2/query/#method-2-using-context-manager","title":"Method 2: Using Context Manager","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nasync with engine.execute(\"SELECT * FROM users\") as result:\n    data = await result.fetch_all()\n</code></pre>"},{"location":"en/v2/query/#method-3-direct-iteration","title":"Method 3: Direct Iteration","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nasync for row in engine.execute(\"SELECT * FROM users\"):\n    print(row)\n</code></pre>"},{"location":"en/v2/query/#parameterized-query","title":"Parameterized Query","text":""},{"location":"en/v2/query/#using-tuple-parameters","title":"Using Tuple Parameters","text":"<pre><code>result = await engine.execute(\n    \"SELECT * FROM users WHERE name = %s AND age &gt; %s\",\n    (\"\u5f20\u4e09\", 18)\n)\n</code></pre>"},{"location":"en/v2/query/#using-dictionary-parameters","title":"Using Dictionary Parameters","text":"<pre><code>result = await engine.execute(\n    \"SELECT * FROM users WHERE name = %(name)s AND age &gt; %(age)s\",\n    {\"name\": \"\u5f20\u4e09\", \"age\": 18}\n)\n</code></pre>"},{"location":"en/v2/query/#batch-execution","title":"Batch Execution","text":"<pre><code># Batch insert\nusers = [\n    (\"\u5f20\u4e09\", \"zhangsan@example.com\"),\n    (\"\u674e\u56db\", \"lisi@example.com\"),\n    (\"\u738b\u4e94\", \"wangwu@example.com\")\n]\nresult = await engine.execute_many(\n    \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n    users\n)\nprint(f\"Inserted {result.row_count} records\")\n</code></pre>"},{"location":"en/v2/query/#streaming-query","title":"Streaming Query","text":"<p>Streaming queries are suitable for large datasets and do not load all data into memory:</p> <pre><code># Enable streaming query\nresult = await engine.execute(\n    \"SELECT * FROM large_table\",\n    stream=True\n)\n\n# Stream iteration\nasync for row in result:\n    process(row)  # Process row by row without memory consumption\n</code></pre>"},{"location":"en/v2/query/#related-documentation","title":"Related Documentation","text":"<ul> <li>Result Processing - Learn how to retrieve and process query results</li> <li>Transaction Control - Learn about transaction management</li> </ul>"},{"location":"en/v2/quickstart/","title":"Quick Start","text":"<p>This guide will help you get started with asmysql v2 quickly.</p>"},{"location":"en/v2/quickstart/#method-1-using-engine-class","title":"Method 1: Using Engine Class","text":"<p>The <code>Engine</code> class is an independent MySQL connection engine that can be used directly:</p> <pre><code>import asyncio\nfrom asmysql import Engine\n\n# Create MySQL connection engine\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/?charset=utf8mb4\")\n\nasync def main():\n    # Connect to MySQL\n    await engine.connect()\n\n    # Execute SQL statement\n    async with engine.execute(\"SELECT user, host FROM mysql.user\") as result:\n        async for item in result.iterate():\n            print(item)\n\n    # Disconnect from MySQL\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/quickstart/#method-2-using-asmysql-class","title":"Method 2: Using AsMysql Class","text":"<p>The <code>AsMysql</code> class is used for business logic development, ready to use by inheritance:</p> <pre><code>import asyncio\nfrom asmysql import Engine, AsMysql\n\n# Create MySQL connection engine\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/?charset=utf8mb4\")\n\n# Write business logic class\nclass UserService(AsMysql):\n    async def get_all_users(self):\n        result = await self.client.execute(\"SELECT user, host FROM mysql.user\")\n        if result.error:\n            print(f\"Error code: {result.error_no}, Error message: {result.error_msg}\")\n        else:\n            async for item in result.iterate():\n                print(item)\n\nasync def main():\n    # Connect to MySQL\n    await engine.connect()\n\n    # Create business logic instance\n    user_service = UserService(engine)\n\n    # Execute business logic\n    await user_service.get_all_users()\n\n    # Disconnect from MySQL\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"en/v2/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Learn about Connection Management for detailed configuration</li> <li>Learn about Query Operations for various usage patterns</li> <li>Check out Usage Examples for more example code</li> </ul>"},{"location":"en/v2/result/","title":"Result Processing","text":""},{"location":"en/v2/result/#retrieve-result-data","title":"Retrieve Result Data","text":""},{"location":"en/v2/result/#fetch_one-get-single-record","title":"fetch_one() - Get Single Record","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users WHERE id = %s\", (1,))\nuser = await result.fetch_one()\nif user:\n    print(user)\n</code></pre>"},{"location":"en/v2/result/#fetch_many-get-multiple-records","title":"fetch_many() - Get Multiple Records","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users\")\nusers = await result.fetch_many(10)  # Get 10 records\nfor user in users:\n    print(user)\n</code></pre>"},{"location":"en/v2/result/#fetch_all-get-all-records","title":"fetch_all() - Get All Records","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users\")\nall_users = await result.fetch_all()\nprint(f\"Total {len(all_users)} records\")\n</code></pre>"},{"location":"en/v2/result/#iterate-async-iterator","title":"iterate() - Async Iterator","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users\")\nasync for user in result.iterate():\n    print(user)\n</code></pre>"},{"location":"en/v2/result/#direct-iteration-of-result","title":"Direct Iteration of Result","text":"<pre><code># Method 1: Direct iteration of execute result\nasync for user in engine.execute(\"SELECT * FROM users\"):\n    print(user)\n\n# Method 2: await then iterate\nresult = await engine.execute(\"SELECT * FROM users\")\nasync for user in result:\n    print(user)\n</code></pre>"},{"location":"en/v2/result/#result-types","title":"Result Types","text":""},{"location":"en/v2/result/#default-tuple-type","title":"Default tuple Type","text":"<pre><code>result = await engine.execute(\"SELECT id, name, email FROM users\")\nuser = await result.fetch_one()\n# user is tuple: (1, \"\u5f20\u4e09\", \"zhangsan@example.com\")\n</code></pre>"},{"location":"en/v2/result/#dict-type","title":"dict Type","text":"<pre><code>result = await engine.execute(\n    \"SELECT id, name, email FROM users\",\n    result_class=dict\n)\nuser = await result.fetch_one()\n# user is dict: {\"id\": 1, \"name\": \"\u5f20\u4e09\", \"email\": \"zhangsan@example.com\"}\n</code></pre>"},{"location":"en/v2/result/#custom-model-type","title":"Custom Model Type","text":"<pre><code>from pydantic import BaseModel\nfrom asmysql import Engine\n\nclass User(BaseModel):\n    id: int\n    name: str\n    email: str\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nresult = await engine.execute(\n    \"SELECT id, name, email FROM users\",\n    result_class=User\n)\nuser = await result.fetch_one()\n# user is User instance\nprint(user.name)  # Use attribute access\n</code></pre>"},{"location":"en/v2/result/#error-handling","title":"Error Handling","text":""},{"location":"en/v2/result/#check-error","title":"Check Error","text":"<pre><code>result = await engine.execute(\"SELECT * FROM non_existent_table\")\nif result.error:\n    print(f\"Error code: {result.error_no}\")\n    print(f\"Error message: {result.error_msg}\")\n    print(f\"Error object: {result.error}\")\nelse:\n    data = await result.fetch_all()\n</code></pre>"},{"location":"en/v2/result/#error-attributes","title":"Error Attributes","text":"<ul> <li><code>result.error</code>: Error exception object (<code>MySQLError</code> or <code>None</code>)</li> <li><code>result.error_no</code>: Error code (integer, 0 when no error)</li> <li><code>result.error_msg</code>: Error message (string, empty string when no error)</li> </ul>"},{"location":"en/v2/result/#execution-statistics","title":"Execution Statistics","text":"<pre><code>result = await engine.execute(\"INSERT INTO users (name) VALUES (%s)\", (\"\u5f20\u4e09\",))\n\n# Affected rows\nprint(f\"Affected rows: {result.row_count}\")\n\n# Last inserted ID (only for INSERT statements)\nprint(f\"Last inserted ID: {result.last_rowid}\")\n\n# Current cursor position\nprint(f\"Cursor position: {result.row_number}\")\n</code></pre> <p>Note: - <code>row_count</code> returns <code>None</code> when using streaming query (<code>stream=True</code>) - <code>row_count</code> returns <code>None</code> when an error occurs - <code>last_rowid</code> is only valid for INSERT statements</p>"},{"location":"en/v2/transaction/","title":"Transaction Control","text":""},{"location":"en/v2/transaction/#auto-commit-default","title":"Auto Commit (Default)","text":"<pre><code>engine = Engine(\n    url=\"mysql://root:pass@127.0.0.1:3306/\",\n    auto_commit=True  # Default value\n)\nawait engine.connect()\n\n# Auto commit\nresult = await engine.execute(\"INSERT INTO users (name) VALUES (%s)\", (\"\u5f20\u4e09\",))\n</code></pre>"},{"location":"en/v2/transaction/#manual-commit","title":"Manual Commit","text":"<pre><code>engine = Engine(\n    url=\"mysql://root:pass@127.0.0.1:3306/\",\n    auto_commit=False\n)\nawait engine.connect()\n\n# No auto commit\nresult = await engine.execute(\n    \"INSERT INTO users (name) VALUES (%s)\",\n    (\"\u5f20\u4e09\",),\n    commit=False\n)\n\n# Manual commit\nawait result.close()  # Need to manually manage connection\n</code></pre>"},{"location":"en/v2/transaction/#notes","title":"Notes","text":"<p>Transaction management in v2 requires manual connection control. It is recommended to choose an appropriate commit strategy based on actual requirements in production environments.</p>"},{"location":"en/v2/transaction/#related-documentation","title":"Related Documentation","text":"<ul> <li>Query Operations - Learn how to execute SQL statements</li> <li>Best Practices - Learn recommended usage patterns</li> </ul>"},{"location":"en/v2/changelog/v2-0-0/","title":"V2 0 0","text":""},{"location":"en/v2/changelog/v2-0-0/#breaking-changes","title":"Breaking Changes","text":"<p>v2.0.0 is a completely refactored version that is incompatible with v1. Main changes include:</p>"},{"location":"en/v2/changelog/v2-0-0/#1-architecture-refactoring","title":"1. Architecture Refactoring","text":"<ul> <li>Separated Engine and AsMysql Classes</li> <li>New <code>Engine</code> class: Independent MySQL connection engine, can be used standalone</li> <li><code>AsMysql</code> class: Business logic development base class, accesses <code>Engine</code> through <code>client</code> attribute</li> <li>This design completely separates connection management and business logic</li> </ul>"},{"location":"en/v2/changelog/v2-0-0/#2-result-class-changes","title":"2. Result Class Changes","text":"<ul> <li>Error Attribute Renaming</li> <li><code>Result.err</code> \u2192 <code>Result.error</code></li> <li>More compliant with Python naming conventions</li> </ul>"},{"location":"en/v2/changelog/v2-0-0/#3-api-changes","title":"3. API Changes","text":"<ul> <li>Connection Method Changes</li> <li>v1: Auto-connect after inheriting <code>AsMysql</code></li> <li> <p>v2: Need to explicitly create <code>Engine</code> and call <code>connect()</code></p> </li> <li> <p>Execution Method Changes</p> </li> <li>v1: AsMysql <code>self.client.execute(...)</code></li> <li>v2: AsMysql <code>self.client.execute(...)</code> (unchanged, but <code>client</code> is now an <code>Engine</code> instance)</li> </ul>"},{"location":"en/v2/changelog/v2-0-0/#new-features","title":"New Features","text":""},{"location":"en/v2/changelog/v2-0-0/#1-engine-class","title":"1. Engine Class","text":"<p>A brand new connection engine class providing the following features:</p> <ul> <li> <p>URL Connection String Support <pre><code>engine = Engine(url=\"mysql://user:password@host:port/?charset=utf8mb4\")\n</code></pre></p> </li> <li> <p>Connection Status Monitoring <pre><code>status = engine.status\n# Returns detailed connection pool status information\n</code></pre></p> </li> <li> <p>Flexible Connection Management</p> </li> <li>Support for <code>async with</code> context manager</li> <li>Support for <code>await engine()</code> syntax</li> <li> <p>Support for <code>await engine</code> syntax</p> </li> <li> <p>Connection Pool Configuration</p> </li> <li><code>min_pool_size</code>: Minimum connections</li> <li><code>max_pool_size</code>: Maximum connections</li> <li><code>pool_recycle</code>: Idle connection recycle time</li> <li><code>connect_timeout</code>: Connection timeout</li> </ul>"},{"location":"en/v2/changelog/v2-0-0/#2-result-class-enhancements","title":"2. Result Class Enhancements","text":"<ul> <li>Error Information Access</li> <li><code>error_no</code>: Get MySQL error code</li> <li><code>error_msg</code>: Get MySQL error message</li> <li> <p><code>error</code>: Get complete error exception object</p> </li> <li> <p>Streaming Query Support <pre><code>result = await engine.execute(\"SELECT * FROM large_table\", stream=True)\nasync for row in result:\n    process(row)  # Process row by row without memory consumption\n</code></pre></p> </li> <li> <p>Context Manager Support <pre><code>async with engine.execute(\"SELECT * FROM users\") as result:\n    data = await result.fetch_all()\n</code></pre></p> </li> <li> <p>Async Iterator Support <pre><code># Method 1: Direct iteration\nasync for row in engine.execute(\"SELECT * FROM users\"):\n    print(row)\n\n# Method 2: Iterate Result\nresult = await engine.execute(\"SELECT * FROM users\")\nasync for row in result:\n    print(row)\n</code></pre></p> </li> <li> <p>Custom Result Types <pre><code># Supports tuple (default), dict, or custom model classes\nresult = await engine.execute(\n    \"SELECT * FROM users\",\n    result_class=dict  # or custom Pydantic model\n)\n</code></pre></p> </li> </ul>"},{"location":"en/v2/changelog/v2-0-0/#3-execution-method-enhancements","title":"3. Execution Method Enhancements","text":"<ul> <li>execute() Method</li> <li>Support for <code>stream</code> parameter: Enable streaming query</li> <li>Support for <code>result_class</code> parameter: Specify return result type</li> <li>Support for <code>commit</code> parameter: Control transaction commit</li> <li> <p>Support for multiple calling methods:</p> <ul> <li><code>result = await engine.execute(...)</code></li> <li><code>async with engine.execute(...) as result:</code></li> <li><code>async for item in engine.execute(...):</code></li> </ul> </li> <li> <p>execute_many() Method</p> </li> <li>Batch execute SQL statements</li> <li>Support for same parameter options</li> </ul>"},{"location":"en/v2/changelog/v2-0-0/#4-type-hints","title":"4. Type Hints","text":"<ul> <li>Complete type hint support</li> <li>Support for generic types (<code>Result[T]</code>)</li> <li>IDE-friendly code completion</li> </ul>"},{"location":"en/v2/changelog/v2-0-0/#5-testing","title":"5. Testing","text":"<ul> <li>New pytest test suite</li> <li>Covers main functional scenarios</li> <li>Support for Mock testing</li> </ul>"},{"location":"en/v2/changelog/v2-0-0/#updates","title":"Updates","text":""},{"location":"en/v2/changelog/v2-0-0/#1-package-management-tool","title":"1. Package Management Tool","text":"<ul> <li>Use <code>uv</code> as package management tool</li> <li>Faster dependency installation speed</li> <li>Better dependency resolution</li> </ul>"},{"location":"en/v2/changelog/v2-0-0/#2-code-quality","title":"2. Code Quality","text":"<ul> <li>Improved code structure</li> <li>Better error handling</li> <li>Clearer docstrings</li> </ul>"},{"location":"en/v2/changelog/v2-0-0/#core-features","title":"Core Features","text":"<p>v2 version retains the core features of v1:</p> <ol> <li>Easy to Use</li> <li>asmysql is an easy-to-use library that wraps aiomysql</li> <li> <p>Provides more friendly API</p> </li> <li> <p>Connection Pool Management</p> </li> <li>Automatic MySQL connection pool management</li> <li>Support for reconnection mechanism</li> <li> <p>Connection pool status monitoring</p> </li> <li> <p>Error Handling</p> </li> <li>Global automatic capture of <code>MysqlError</code> errors</li> <li>Provides error code and error message access</li> <li> <p>Elegant error handling mechanism</p> </li> <li> <p>Separation of Execution and Retrieval</p> </li> <li>Separation of SQL statement execution and result retrieval</li> <li>Support for multiple data retrieval methods</li> <li> <p>Flexible result processing</p> </li> <li> <p>Type Hints</p> </li> <li>Complete Python type hints</li> <li>IDE-friendly code completion</li> <li> <p>Type safety</p> </li> <li> <p>Business Logic Development</p> </li> <li>Directly inherit <code>AsMysql</code> class for logic development</li> <li>Clear code organization</li> <li>Easy to test and maintain</li> </ol>"},{"location":"zh/v1/","title":"asmysql","text":"<ul> <li>PyPI: https://pypi.org/project/asmysql/</li> <li>GitHub: https://github.com/vastxiao/asmysql</li> <li>Gitee: https://gitee.com/vastxiao/asmysql</li> </ul>"},{"location":"zh/v1/#_1","title":"\u3010\u7b80\u4ecb\u3011","text":"<p>asmysql\u662f\u5c01\u88c5aiomysql\u7684mysql\u5f02\u6b65\u5ba2\u6237\u7aef\u4f7f\u7528\u5e93\u3002</p>"},{"location":"zh/v1/#_2","title":"\u3010\u7279\u6027\u3011","text":"<ul> <li>\u4ee3\u7801\u652f\u6301\u7c7b\u578b\u6ce8\u91ca\u3002</li> <li>\u4f7f\u7528\u6781\u4e3a\u7b80\u5355\uff0c\u76f4\u63a5\u7ee7\u627fAsMysql\u7c7b\u8fdb\u884c\u903b\u8f91\u5f00\u53d1\u3002</li> <li>\u652f\u6301\u81ea\u52a8\u7ba1\u7406mysql\u8fde\u63a5\u6c60\uff0c\u548c\u91cd\u8fde\u673a\u5236\u3002</li> <li>\u5168\u5c40\u81ea\u52a8\u6355\u83b7\u5904\u7406MysqlError\u9519\u8bef\u3002</li> <li>\u5206\u79bb\u6267\u884c\u8bed\u53e5\u548c\u6570\u636e\u83b7\u53d6\u3002</li> </ul>"},{"location":"zh/v1/#asmysql_1","title":"\u3010\u5b89\u88c5asmysql\u5305\u3011","text":"<pre><code># \u4ecePyPI\u5b89\u88c5\npip install asmysql\n</code></pre>"},{"location":"zh/v1/#_3","title":"\u3010\u4f7f\u7528\u6587\u6863\u3011","text":""},{"location":"zh/v1/#_4","title":"\u5feb\u901f\u5f00\u59cb","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\n\n# \u76f4\u63a5\u7ee7\u627fAsMysql\u7c7b\u8fdb\u884c\u5f00\u53d1:\nclass TestAsMysql(AsMysql):\n    # \u8fd9\u91cc\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e9bMysql\u5b9e\u4f8b\u521d\u59cb\u5316\u7684\u9ed8\u8ba4\u53c2\u6570\n    # \u5c5e\u6027\u8ddf __init__ \u53c2\u6570\u4e00\u81f4\n    host = '127.0.0.1'\n    port = 3306\n    user = 'root'\n    password = 'pass'\n\n    async def get_users(self):\n        # self.client\u5c5e\u6027\u662f\u4e13\u95e8\u7528\u6765\u6267\u884csql\u8bed\u53e5\u7684\uff0c\u63d0\u4f9baiomysql\u7684execute\u548cexecute_many\u65b9\u6cd5\n        result = await self.client.execute('select user,authentication_string,host from mysql.user')\n        # result\u662f\u4e13\u95e8\u7528\u6765\u83b7\u53d6\u6267\u884c\u7ed3\u679c\u7684\uff0c\u63d0\u4f9bfetch_one\u3001fetch_many\u3001fetch_all\u3001iterate\u65b9\u6cd5\n        # result.err\u662f\u6240\u6709\u5173\u4e8emysql\u6267\u884c\u7684\u5f02\u5e38\u5bf9\u8c61(Exception)\n        if result.err:\n            print(result.err_msg)\n        else:\n            # result.iterate()\u662f\u4e00\u4e2a\u5f02\u6b65\u8fed\u4ee3\u5668\uff0c\u53ef\u4ee5\u83b7\u53d6\u6267\u884c\u7ed3\u679c\u7684\u6bcf\u4e00\u884c\u6570\u636e\n            async for item in result.iterate():\n                print(item)\n\n\nasync def main():\n    # \u8fd9\u4e2a\u4f1a\u521b\u5efa\u5b9e\u4f8b\u5e76\u8fde\u63a5mysql\uff1a\n    mysql = await TestAsMysql()\n\n    await mysql.get_users()\n\n    # \u7a0b\u5e8f\u9000\u51fa\u524d\u8bb0\u5f97\u65ad\u5f00mysql\u8fde\u63a5\uff1a\n    await mysql.disconnect()\n\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v1/#_5","title":"\u652f\u6301\u5f02\u6b65\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u3002","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\nclass TestAsMysql(AsMysql):\n    async def get_users(self):\n        result = await self.client.execute('select user,authentication_string,host from mysql.user')\n        if result.err:\n            print(result.err)\n        else:\n            async for item in result.iterate():\n                print(item)\n\nasync def main():\n    # \u4f7f\u7528 async with \u7684\u8bdd\uff0c\u5728\u4ee3\u7801\u9000\u51fa\u65f6\u4f1a\u81ea\u52a8\u65ad\u5f00mysql\u8fde\u63a5\n    async with TestAsMysql() as mysql:\n        await mysql.get_users()\n\nif __name__ == '__main__':\n    asyncio.run(main())\n</code></pre>"},{"location":"zh/v1/#_6","title":"\u521b\u5efa\u5b9e\u4f8b\u7684\u66f4\u591a\u7528\u6cd5","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\nclass TestAsMysql(AsMysql):\n    async def get_users(self):\n        result = await self.client.execute('select user,authentication_string,host from mysql.user')\n        if result.err:\n            print(result.err)\n        else:\n            return await result.fetch_all()\n\n# \u521b\u5efamysql\u5b9e\u4f8b\u65f6\u53ef\u4ee5\u4f20\u5165mysql\u5730\u5740\uff0c\u7528\u6237\u5bc6\u7801\u7b49\u53c2\u6570\nmysql = TestAsMysql(host='192.168.1.192', port=3306)\n\nasync def main():\n    # \u6267\u884c\u4f1a\u8fde\u63a5\u5230mysql\uff1a\n    await mysql.connect()  # or: await mysql\n\n    print(await mysql.get_users())\n\n    # \u65ad\u5f00mysql\u8fde\u63a5\uff1a\n    await mysql.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v1/CHANGELOG/","title":"Change Log","text":""},{"location":"zh/v1/CHANGELOG/#131-20250624","title":"[1.3.1] - 2025.06.24","text":"<ul> <li>Fix: auto_commit\u4f7f\u7528aiomysql\u539f\u751f\u5c5e\u6027\u5904\u7406\uff0c\u652f\u6301\u914d\u7f6e\u4f20\u5165\u3002</li> </ul>"},{"location":"zh/v1/CHANGELOG/#130-20250621","title":"[1.3.0] - 2025.06.21","text":""},{"location":"zh/v1/CHANGELOG/#breaking-changes","title":"Breaking Changes","text":"<ul> <li>\u4fee\u6539Result\u7684rowcount\u5c5e\u6027\u4e3arow_count</li> <li>\u4fee\u6539Result\u7684lastrowid\u5c5e\u6027\u4e3alast_rowid</li> <li>\u4fee\u6539Result\u7684rownumber\u5c5e\u6027\u4e3arow_number</li> </ul>"},{"location":"zh/v1/CHANGELOG/#120-20250620","title":"[1.2.0] - 2025.06.20","text":""},{"location":"zh/v1/CHANGELOG/#features","title":"Features","text":"<ul> <li>Result\u66b4\u9732cursor\u5c5e\u6027</li> <li>Result\u65b0\u589erowcount\u3001lastrowid\u3001rownumber\u5c5e\u6027</li> </ul>"},{"location":"zh/v1/CHANGELOG/#113-20250527","title":"[1.1.3] - 2025.05.27","text":""},{"location":"zh/v1/CHANGELOG/#features_1","title":"Features","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\nasync def main():\n    async with AsMysql() as mysql:\n        # execute\u65b9\u6cd5\u652f\u6301commit\u53c2\u6570\uff0c\u7528\u4e8e\u63a7\u5236\u662f\u5426\u63d0\u4ea4\u4e8b\u52a1\uff0c\u9ed8\u8ba4\u81ea\u52a8\u5224\u65ad\u3002\n        await mysql.client.execute('insert into test(name) values(\"test\")', commit=False)\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v1/CHANGELOG/#110-20250212","title":"[1.1.0] - 2025.02.12","text":""},{"location":"zh/v1/CHANGELOG/#features_2","title":"Features","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\nmysql = AsMysql()\n\nasync def main():\n    # AsMysql\u65b0\u589e\u65b9\u6cd5: async def __call__()\n    await mysql()\n\n    print(await mysql.client.execute('select user,host from mysql.user'))\n\n    # \u65ad\u5f00mysql\u8fde\u63a5\uff1a\n    await mysql.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v1/CHANGELOG/#100-20241019","title":"[1.0.0] - 2024.10.19","text":""},{"location":"zh/v1/CHANGELOG/#features_3","title":"Features","text":"<ol> <li>\u66f4\u65b0Python\u7248\u672c\u652f\u6301\u8303\u56f4\uff0c\u6700\u4f4e\u652f\u63013.9\u3002</li> <li>\u66f4\u65b0\u6587\u6863\u5185\u5bb9\u3002</li> </ol>"},{"location":"zh/v1/CHANGELOG/#020-20241014","title":"[0.2.0] - 2024.10.14","text":""},{"location":"zh/v1/CHANGELOG/#features_4","title":"Features","text":"<ol> <li>\u4fee\u590daiomysql\u5bf9echo\u53c2\u6570\u7684\u5904\u7406\u3002</li> <li>\u5bf9AsMysql\u7c7b\u65b0\u589eecho_sql_log\u53c2\u6570\uff0c\u7528\u4e8e\u63a7\u5236aiomysql\u662f\u5426\u8f93\u51fa\u6267\u884c\u7684sql\u8bed\u53e5(\u9ed8\u8ba4False)\u3002</li> </ol> <pre><code>from asmysql import AsMysql\n\nclass TestAsMysql(AsMysql):\n    # \u8fd9\u6837\u5c31\u53ef\u4ee5\u63a7\u5236aiomysql\u5e93\u662f\u5426\u5728Logging.logger\u8f93\u51fa\u6267\u884c\u7684sql\u8bed\u53e5\u3002\n    echo_sql_log = True\n\n\n# \u5f53\u7136\uff0cecho_sql_log\u53c2\u6570\u4e5f\u53ef\u4ee5\u5728\u5b9e\u4f8b\u5316AsMysql\u65f6\u4f20\u5165\u3002\nasync def main():\n    async with TestAsMysql(echo_sql_log=True) as mysql:\n        result = await mysql.client.execute('select user,authentication_string,host from mysql.user')\n        if result.err:\n            print(result.err)\n        else:\n            async for item in result.iterate():\n                print(item)\n</code></pre>"},{"location":"zh/v1/CHANGELOG/#014-20240815","title":"[0.1.4] - 2024.08.15","text":""},{"location":"zh/v1/CHANGELOG/#features_5","title":"Features","text":""},{"location":"zh/v1/CHANGELOG/#1asmysql","title":"1.AsMysql\u652f\u6301\u5f02\u6b65\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u3002","text":"<pre><code>import asyncio\nfrom asmysql import AsMysql\n\nclass TestAsMysql(AsMysql):\n    async def get_users(self):\n        result = await self.client.execute('select user,authentication_string,host from mysql.user')\n        if result.err:\n            print(result.err)\n        else:\n            async for item in result.iterate():\n                print(item)\n\nasync def main():\n    async with TestAsMysql() as mysql:\n        await mysql.get_users()\n\nif __name__ == '__main__':\n    asyncio.run(main())\n</code></pre>"},{"location":"zh/v1/CHANGELOG/#2connectionconnectionerror","title":"2.\u5728connection\u4e2d\u7684\u5f02\u5e38\u629b\u51fa\u65f6\uff0c\u4f7f\u7528ConnectionError\u66ff\u4ee3\u3002","text":""},{"location":"zh/v1/CHANGELOG/#011-20230725","title":"[0.1.1] - 2023.07.25","text":""},{"location":"zh/v1/CHANGELOG/#features_6","title":"Features","text":"<p>\u65b0\u589e Result.err_msg \u8fd4\u56deexception\u9519\u8bef\u7684\u8be6\u60c5\u5b57\u7b26\u4e32\u3002</p>"},{"location":"zh/v1/CHANGELOG/#010-20230716","title":"[0.1.0] - 2023.07.16","text":""},{"location":"zh/v1/CHANGELOG/#breaking-changes_1","title":"Breaking Changes","text":""},{"location":"zh/v1/CHANGELOG/#features_7","title":"Features","text":"<ol> <li>asmysql\u662f\u5bf9aiomysql\u5c01\u88c5\u7684\u7b80\u6613\u4f7f\u7528\u5e93\u3002</li> <li>\u652f\u6301\u81ea\u52a8\u7ba1\u7406mysql\u8fde\u63a5\u6c60\uff0c\u548c\u91cd\u8fde\u673a\u5236\u3002</li> <li>\u5168\u5c40\u81ea\u52a8\u6355\u83b7\u5904\u7406MysqlError\u9519\u8bef\u3002</li> <li>\u5206\u79bb\u6267\u884c\u8bed\u53e5\u548c\u6570\u636e\u83b7\u53d6\u3002</li> <li>\u76f4\u63a5\u96c6\u6210AsMysql\u7c7b\u8fdb\u884c\u903b\u8f91\u5f00\u53d1\u3002</li> </ol>"},{"location":"zh/v1/CHANGELOG/#internal","title":"Internal","text":"<p>\u521d\u59cb\u5316\u9879\u76ee\uff0c\u5f00\u53d1\u73af\u5883\u4f7f\u7528poetry\u8fdb\u884c\u7ba1\u7406\u3002</p>"},{"location":"zh/v2/","title":"asmysql v2 \u6280\u672f\u6587\u6863","text":"<ul> <li>PyPI: https://pypi.org/project/asmysql/</li> <li>GitHub: https://github.com/vastxiao/asmysql</li> <li>Gitee: https://gitee.com/vastxiao/asmysql</li> <li>Docs: https://vastxiao.github.io/asmysql/</li> </ul>"},{"location":"zh/v2/#_1","title":"\u7b80\u4ecb","text":"<p><code>asmysql</code> \u662f\u4e00\u4e2a\u57fa\u4e8e <code>aiomysql</code> \u5c01\u88c5\u7684\u5f02\u6b65 MySQL \u5ba2\u6237\u7aef\u5e93\uff0c\u4e13\u4e3a Python \u5f02\u6b65\u7f16\u7a0b\u8bbe\u8ba1\u3002v2 \u7248\u672c\u5b8c\u5168\u91cd\u6784\u4e86\u67b6\u6784\uff0c\u63d0\u4f9b\u4e86\u66f4\u6e05\u6670\u3001\u66f4\u7075\u6d3b\u7684 API \u8bbe\u8ba1\uff0c\u652f\u6301\u7c7b\u578b\u63d0\u793a\u3001\u8fde\u63a5\u6c60\u7ba1\u7406\u3001\u9519\u8bef\u5904\u7406\u7b49\u4f01\u4e1a\u7ea7\u7279\u6027\u3002</p>"},{"location":"zh/v2/#_2","title":"\u4e3b\u8981\u4f18\u52bf","text":"<ul> <li>\u7b80\u5355\u6613\u7528\uff1a\u76f4\u89c2\u7684 API \u8bbe\u8ba1\uff0c\u5b66\u4e60\u6210\u672c\u4f4e</li> <li>\u7c7b\u578b\u5b89\u5168\uff1a\u5b8c\u6574\u7684\u7c7b\u578b\u63d0\u793a\u652f\u6301\uff0c\u63d0\u5347\u5f00\u53d1\u4f53\u9a8c</li> <li>\u9ad8\u6027\u80fd\uff1a\u57fa\u4e8e\u8fde\u63a5\u6c60\u7684\u5f02\u6b65\u64cd\u4f5c\uff0c\u652f\u6301\u9ad8\u5e76\u53d1</li> <li>\u7075\u6d3b\u6269\u5c55\uff1a\u5206\u79bb\u5f15\u64ce\u548c\u4e1a\u52a1\u903b\u8f91\uff0c\u4fbf\u4e8e\u67b6\u6784\u8bbe\u8ba1</li> <li>\u5185\u5b58\u53cb\u597d\uff1a\u652f\u6301\u6d41\u5f0f\u67e5\u8be2\uff0c\u5904\u7406\u5927\u6570\u636e\u96c6\u4e0d\u5360\u7528\u5185\u5b58</li> </ul>"},{"location":"zh/v2/#_3","title":"\u7279\u6027","text":""},{"location":"zh/v2/#v2","title":"v2 \u7248\u672c\u6838\u5fc3\u7279\u6027","text":"<ol> <li>\u5206\u79bb\u5f0f\u67b6\u6784</li> <li><code>Engine</code> \u7c7b\uff1a\u72ec\u7acb\u7684 MySQL \u8fde\u63a5\u5f15\u64ce\uff0c\u53ef\u5355\u72ec\u4f7f\u7528</li> <li><code>AsMysql</code> \u7c7b\uff1a\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1\u57fa\u7c7b\uff0c\u7ee7\u627f\u5373\u53ef\u4f7f\u7528</li> <li> <p><code>Result</code> \u7c7b\uff1a\u7ed3\u679c\u5904\u7406\u7c7b\uff0c\u652f\u6301\u591a\u79cd\u6570\u636e\u83b7\u53d6\u65b9\u5f0f</p> </li> <li> <p>\u8fde\u63a5\u7ba1\u7406</p> </li> <li>\u81ea\u52a8\u7ba1\u7406 MySQL \u8fde\u63a5\u6c60</li> <li>\u652f\u6301\u8fde\u63a5\u6c60\u914d\u7f6e\uff08\u6700\u5c0f/\u6700\u5927\u8fde\u63a5\u6570\uff09</li> <li>\u81ea\u52a8\u91cd\u8fde\u673a\u5236</li> <li> <p>\u8fde\u63a5\u72b6\u6001\u76d1\u63a7</p> </li> <li> <p>\u7075\u6d3b\u7684\u67e5\u8be2\u65b9\u5f0f</p> </li> <li>\u652f\u6301\u666e\u901a\u67e5\u8be2\u548c\u6d41\u5f0f\u67e5\u8be2</li> <li>\u652f\u6301\u5355\u6761\u548c\u6279\u91cf\u6267\u884c</li> <li> <p>\u652f\u6301\u4e8b\u52a1\u63a7\u5236</p> </li> <li> <p>\u591a\u79cd\u7ed3\u679c\u7c7b\u578b</p> </li> <li><code>tuple</code>\uff1a\u9ed8\u8ba4\u5143\u7ec4\u7c7b\u578b</li> <li><code>dict</code>\uff1a\u5b57\u5178\u7c7b\u578b</li> <li> <p>\u81ea\u5b9a\u4e49\u6a21\u578b\uff1a\u652f\u6301 Pydantic \u7b49\u6a21\u578b\u7c7b</p> </li> <li> <p>\u6570\u636e\u83b7\u53d6\u65b9\u5f0f</p> </li> <li><code>fetch_one()</code>\uff1a\u83b7\u53d6\u5355\u6761\u8bb0\u5f55</li> <li><code>fetch_many()</code>\uff1a\u83b7\u53d6\u591a\u6761\u8bb0\u5f55</li> <li><code>fetch_all()</code>\uff1a\u83b7\u53d6\u6240\u6709\u8bb0\u5f55</li> <li><code>iterate()</code>\uff1a\u5f02\u6b65\u8fed\u4ee3\u5668\uff0c\u9010\u884c\u83b7\u53d6</li> <li> <p>\u76f4\u63a5\u8fed\u4ee3\uff1a<code>async for item in result</code></p> </li> <li> <p>\u9519\u8bef\u5904\u7406</p> </li> <li>\u5168\u5c40\u81ea\u52a8\u6355\u83b7 <code>MysqlError</code></li> <li>\u9519\u8bef\u7801\u548c\u9519\u8bef\u4fe1\u606f\u8bbf\u95ee</li> <li> <p>\u4f18\u96c5\u7684\u9519\u8bef\u5904\u7406\u673a\u5236</p> </li> <li> <p>\u4e0a\u4e0b\u6587\u7ba1\u7406</p> </li> <li>\u652f\u6301 <code>async with</code> \u8bed\u6cd5</li> <li>\u81ea\u52a8\u8d44\u6e90\u6e05\u7406</li> <li> <p>\u652f\u6301\u5f02\u6b65\u8fed\u4ee3\u5668\u534f\u8bae</p> </li> <li> <p>URL \u8fde\u63a5\u5b57\u7b26\u4e32</p> </li> <li>\u652f\u6301 MySQL URL \u683c\u5f0f\u8fde\u63a5</li> <li>\u683c\u5f0f\uff1a<code>mysql://user:password@host:port/?charset=utf8mb4</code></li> </ol>"},{"location":"zh/v2/#_4","title":"\u6838\u5fc3\u6982\u5ff5","text":""},{"location":"zh/v2/#engine","title":"Engine\uff08\u5f15\u64ce\uff09","text":"<p><code>Engine</code> \u662f MySQL \u8fde\u63a5\u7684\u6838\u5fc3\u7c7b\uff0c\u8d1f\u8d23\uff1a</p> <ul> <li>\u7ba1\u7406\u8fde\u63a5\u6c60</li> <li>\u6267\u884c SQL \u8bed\u53e5</li> <li>\u5904\u7406\u8fde\u63a5\u751f\u547d\u5468\u671f</li> </ul>"},{"location":"zh/v2/#asmysql","title":"AsMysql\uff08\u4e1a\u52a1\u903b\u8f91\u7c7b\uff09","text":"<p><code>AsMysql</code> \u662f\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1\u7684\u57fa\u7c7b\uff0c\u63d0\u4f9b\uff1a</p> <ul> <li><code>client</code> \u5c5e\u6027\uff1a\u8bbf\u95ee <code>Engine</code> \u5b9e\u4f8b</li> <li>\u4e1a\u52a1\u65b9\u6cd5\u5c01\u88c5</li> <li>\u4ee3\u7801\u7ec4\u7ec7\u80fd\u529b</li> </ul>"},{"location":"zh/v2/#result","title":"Result\uff08\u7ed3\u679c\u7c7b\uff09","text":"<p><code>Result</code> \u662f SQL \u6267\u884c\u7ed3\u679c\u7684\u5c01\u88c5\u7c7b\uff0c\u63d0\u4f9b\uff1a</p> <ul> <li>\u6570\u636e\u83b7\u53d6\u65b9\u6cd5</li> <li>\u9519\u8bef\u4fe1\u606f\u8bbf\u95ee</li> <li>\u6267\u884c\u7edf\u8ba1\u4fe1\u606f</li> <li>\u5f02\u6b65\u8fed\u4ee3\u652f\u6301</li> </ul>"},{"location":"zh/v2/#_5","title":"\u5feb\u901f\u5bfc\u822a","text":"<ul> <li>\u5b89\u88c5\u6307\u5357 - \u5b89\u88c5\u548c\u4f9d\u8d56\u8981\u6c42</li> <li>\u5feb\u901f\u5f00\u59cb - \u5feb\u901f\u4e0a\u624b\u793a\u4f8b</li> <li>\u8fde\u63a5\u7ba1\u7406 - \u8fde\u63a5\u914d\u7f6e\u548c\u7ba1\u7406</li> <li>\u67e5\u8be2\u64cd\u4f5c - \u6267\u884c SQL \u8bed\u53e5</li> <li>\u7ed3\u679c\u5904\u7406 - \u83b7\u53d6\u548c\u5904\u7406\u67e5\u8be2\u7ed3\u679c</li> <li>\u4e8b\u52a1\u63a7\u5236 - \u4e8b\u52a1\u7ba1\u7406</li> <li>\u4e1a\u52a1\u903b\u8f91 - \u4e1a\u52a1\u903b\u8f91\u5f00\u53d1</li> <li>\u6700\u4f73\u5b9e\u8df5 - \u63a8\u8350\u7684\u4f7f\u7528\u65b9\u5f0f</li> <li>\u5e38\u89c1\u95ee\u9898 - FAQ</li> <li>API \u53c2\u8003 - \u5b8c\u6574\u7684 API \u6587\u6863</li> <li>\u4f7f\u7528\u793a\u4f8b - \u8be6\u7ec6\u7684\u4f7f\u7528\u793a\u4f8b</li> <li>\u53d8\u66f4\u65e5\u5fd7 - \u7248\u672c\u66f4\u65b0\u8bb0\u5f55</li> </ul>"},{"location":"zh/v2/api/","title":"asmysql v2 API \u53c2\u8003\u6587\u6863","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u8bf4\u660e asmysql v2 \u7248\u672c\u7684\u6240\u6709 API\u3002</p>"},{"location":"zh/v2/api/#_1","title":"\u76ee\u5f55","text":"<ul> <li>Engine \u7c7b</li> <li>AsMysql \u7c7b</li> <li>Result \u7c7b</li> <li>\u7c7b\u578b\u5b9a\u4e49</li> </ul>"},{"location":"zh/v2/api/#engine","title":"Engine \u7c7b","text":"<p><code>Engine</code> \u662f MySQL \u8fde\u63a5\u5f15\u64ce\u7c7b\uff0c\u8d1f\u8d23\u7ba1\u7406\u8fde\u63a5\u6c60\u548c\u6267\u884c SQL \u8bed\u53e5\u3002</p>"},{"location":"zh/v2/api/#_2","title":"\u7c7b\u5b9a\u4e49","text":"<pre><code>class Engine:\n    \"\"\"\u5f02\u6b65\u7684\u6570\u636e\u5e93 aiomysql \u5c01\u88c5\u7c7b\"\"\"\n</code></pre>"},{"location":"zh/v2/api/#_3","title":"\u7c7b\u5c5e\u6027\uff08\u9ed8\u8ba4\u503c\uff09","text":"\u5c5e\u6027 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>host</code> <code>str</code> <code>\"127.0.0.1\"</code> MySQL \u670d\u52a1\u5668\u5730\u5740 <code>port</code> <code>int</code> <code>3306</code> MySQL \u670d\u52a1\u5668\u7aef\u53e3 <code>user</code> <code>str</code> <code>\"\"</code> \u7528\u6237\u540d <code>password</code> <code>str</code> <code>\"\"</code> \u5bc6\u7801 <code>charset</code> <code>str</code> <code>\"utf8mb4\"</code> \u5b57\u7b26\u96c6 <code>min_pool_size</code> <code>int</code> <code>1</code> \u8fde\u63a5\u6c60\u6700\u5c0f\u8fde\u63a5\u6570 <code>max_pool_size</code> <code>int</code> <code>10</code> \u8fde\u63a5\u6c60\u6700\u5927\u8fde\u63a5\u6570 <code>pool_recycle</code> <code>float</code> <code>-1</code> \u7a7a\u95f2\u8fde\u63a5\u56de\u6536\u65f6\u95f4\uff08\u79d2\uff09\uff0c-1 \u8868\u793a\u4e0d\u56de\u6536 <code>connect_timeout</code> <code>int</code> <code>5</code> \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff08\u79d2\uff09 <code>auto_commit</code> <code>bool</code> <code>True</code> \u662f\u5426\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1 <code>echo_sql_log</code> <code>bool</code> <code>False</code> \u662f\u5426\u6253\u5370 SQL \u65e5\u5fd7 <code>stream</code> <code>bool</code> <code>False</code> \u662f\u5426\u4f7f\u7528\u6d41\u5f0f\u8fd4\u56de\u7ed3\u679c <code>result_class</code> <code>type</code> <code>tuple</code> \u8fd4\u56de\u7ed3\u679c\u7c7b\u578b"},{"location":"zh/v2/api/#_4","title":"\u6784\u9020\u51fd\u6570","text":"<pre><code>def __init__(\n    self,\n    url: str = None,\n    *,\n    host: str = None,\n    port: int = None,\n    user: str = None,\n    password: str = None,\n    charset: str = None,\n    min_pool_size: int = None,\n    max_pool_size: int = None,\n    pool_recycle: float = None,\n    connect_timeout: int = None,\n    auto_commit: bool = None,\n    echo_sql_log: bool = None,\n    stream: bool = None,\n    result_class: type = None,\n) -&gt; None\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li><code>url</code> (str, optional): MySQL \u8fde\u63a5 URL\uff0c\u683c\u5f0f\uff1a<code>mysql://user:password@host:port/?charset=utf8mb4</code></li> <li><code>host</code> (str, optional): MySQL \u670d\u52a1\u5668\u5730\u5740</li> <li><code>port</code> (int, optional): MySQL \u670d\u52a1\u5668\u7aef\u53e3</li> <li><code>user</code> (str, optional): \u7528\u6237\u540d</li> <li><code>password</code> (str, optional): \u5bc6\u7801</li> <li><code>charset</code> (str, optional): \u5b57\u7b26\u96c6</li> <li><code>min_pool_size</code> (int, optional): \u8fde\u63a5\u6c60\u6700\u5c0f\u8fde\u63a5\u6570</li> <li><code>max_pool_size</code> (int, optional): \u8fde\u63a5\u6c60\u6700\u5927\u8fde\u63a5\u6570</li> <li><code>pool_recycle</code> (float, optional): \u7a7a\u95f2\u8fde\u63a5\u56de\u6536\u65f6\u95f4\uff08\u79d2\uff09</li> <li><code>connect_timeout</code> (int, optional): \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff08\u79d2\uff09</li> <li><code>auto_commit</code> (bool, optional): \u662f\u5426\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1</li> <li><code>echo_sql_log</code> (bool, optional): \u662f\u5426\u6253\u5370 SQL \u65e5\u5fd7</li> <li><code>stream</code> (bool, optional): \u662f\u5426\u4f7f\u7528\u6d41\u5f0f\u8fd4\u56de\u7ed3\u679c</li> <li><code>result_class</code> (type, optional): \u8fd4\u56de\u7ed3\u679c\u7c7b\u578b</li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code># \u4f7f\u7528 URL\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/?charset=utf8mb4\")\n\n# \u4f7f\u7528\u5173\u952e\u5b57\u53c2\u6570\nengine = Engine(\n    host=\"127.0.0.1\",\n    port=3306,\n    user=\"root\",\n    password=\"pass\",\n    charset=\"utf8mb4\"\n)\n</code></pre>"},{"location":"zh/v2/api/#_5","title":"\u65b9\u6cd5","text":""},{"location":"zh/v2/api/#connect","title":"connect()","text":"<p>\u8fde\u63a5\u5230 MySQL\uff0c\u5efa\u7acb TCP \u8fde\u63a5\uff0c\u521d\u59cb\u5316\u8fde\u63a5\u6c60\u3002</p> <pre><code>async def connect(self) -&gt; Engine\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a\u8fd4\u56de <code>self</code>\uff0c\u652f\u6301\u94fe\u5f0f\u8c03\u7528</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>await engine.connect()\n</code></pre>"},{"location":"zh/v2/api/#disconnect","title":"disconnect()","text":"<p>\u7b49\u5f85\u6240\u6709\u8fde\u63a5\u91ca\u653e\uff0c\u5e76\u6b63\u5e38\u5173\u95ed MySQL \u8fde\u63a5\u3002</p> <pre><code>async def disconnect(self) -&gt; None\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>await engine.disconnect()\n</code></pre>"},{"location":"zh/v2/api/#release_connections","title":"release_connections()","text":"<p>\u91ca\u653e\u8fde\u63a5\u6c60\u4e2d\u6240\u6709\u7a7a\u95f2\u7684\u8fde\u63a5\u3002</p> <pre><code>async def release_connections(self) -&gt; None\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>await engine.release_connections()\n</code></pre>"},{"location":"zh/v2/api/#execute","title":"execute()","text":"<p>\u6267\u884c SQL \u8bed\u53e5\u5e76\u8fd4\u56de Result \u5bf9\u8c61\u3002</p> <pre><code>def execute(\n    self,\n    query: str,\n    values: Union[Sequence, dict] = None,\n    *,\n    stream: bool = None,\n    result_class: type[T] = None,\n    commit: bool = None,\n) -&gt; Union[Awaitable[Result[T]], AsyncContextManager[Result[T]], AsyncGenerator[T, None]]\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li><code>query</code> (str): SQL \u8bed\u53e5</li> <li><code>values</code> (Union[Sequence, dict], optional): \u53c2\u6570\uff0c\u53ef\u4ee5\u662f\u5143\u7ec4\u6216\u5b57\u5178</li> <li><code>stream</code> (bool, optional): \u662f\u5426\u6d41\u5f0f\u8fd4\u56de\u7ed3\u679c\uff0c\u9ed8\u8ba4\u4f7f\u7528 <code>self.stream</code></li> <li><code>result_class</code> (type, optional): \u7ed3\u679c\u7c7b\u578b\uff0c\u9ed8\u8ba4\u4f7f\u7528 <code>self.result_class</code></li> <li><code>commit</code> (bool, optional): \u662f\u5426\u63d0\u4ea4\u4e8b\u52a1\uff0c\u9ed8\u8ba4\u4f7f\u7528 <code>self.auto_commit</code></li> </ul> <p>\u8fd4\u56de\u503c\uff1a\u8fd4\u56de <code>Result</code> \u5bf9\u8c61\uff0c\u652f\u6301\u4ee5\u4e0b\u7528\u6cd5\uff1a</p> <ol> <li><code>result = await engine.execute(...)</code></li> <li><code>async with engine.execute(...) as result:</code></li> <li><code>async for item in engine.execute(...):</code></li> </ol> <p>\u793a\u4f8b\uff1a</p> <pre><code># \u65b9\u5f0f\u4e00\uff1aawait\nresult = await engine.execute(\"SELECT * FROM users WHERE id = %s\", (1,))\ndata = await result.fetch_one()\n\n# \u65b9\u5f0f\u4e8c\uff1a\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\nasync with engine.execute(\"SELECT * FROM users\") as result:\n    data = await result.fetch_all()\n\n# \u65b9\u5f0f\u4e09\uff1a\u76f4\u63a5\u8fed\u4ee3\nasync for row in engine.execute(\"SELECT * FROM users\"):\n    print(row)\n</code></pre>"},{"location":"zh/v2/api/#execute_many","title":"execute_many()","text":"<p>\u6279\u91cf\u6267\u884c SQL \u8bed\u53e5\u5e76\u8fd4\u56de Result \u5bf9\u8c61\u3002</p> <pre><code>def execute_many(\n    self,\n    query: str,\n    values: Sequence[Union[Sequence, dict]],\n    *,\n    stream: bool = None,\n    result_class: type[T] = None,\n    commit: bool = None,\n) -&gt; Union[Awaitable[Result[T]], AsyncContextManager[Result[T]], AsyncGenerator[T, None]]\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li><code>query</code> (str): SQL \u8bed\u53e5</li> <li><code>values</code> (Sequence[Union[Sequence, dict]]): \u53c2\u6570\u5217\u8868\uff0c\u6bcf\u4e2a\u5143\u7d20\u53ef\u4ee5\u662f\u5143\u7ec4\u6216\u5b57\u5178</li> <li><code>stream</code> (bool, optional): \u662f\u5426\u6d41\u5f0f\u8fd4\u56de\u7ed3\u679c</li> <li><code>result_class</code> (type, optional): \u7ed3\u679c\u7c7b\u578b</li> <li><code>commit</code> (bool, optional): \u662f\u5426\u63d0\u4ea4\u4e8b\u52a1</li> </ul> <p>\u8fd4\u56de\u503c\uff1a\u8fd4\u56de <code>Result</code> \u5bf9\u8c61</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>data = [\n    (\"\u5f20\u4e09\", \"zhangsan@example.com\"),\n    (\"\u674e\u56db\", \"lisi@example.com\")\n]\nresult = await engine.execute_many(\n    \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n    data\n)\n</code></pre>"},{"location":"zh/v2/api/#_6","title":"\u5c5e\u6027","text":""},{"location":"zh/v2/api/#status","title":"status","text":"<p>\u8fd4\u56de\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u72b6\u6001\u3002</p> <pre><code>@property\ndef status(self) -&gt; EngineStatus\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a<code>EngineStatus</code> \u5b57\u5178\uff0c\u5305\u542b\u4ee5\u4e0b\u5b57\u6bb5\uff1a</p> <ul> <li><code>address</code> (str): \u8fde\u63a5\u5730\u5740</li> <li><code>connected</code> (bool): \u662f\u5426\u5df2\u8fde\u63a5</li> <li><code>pool_minsize</code> (Optional[int]): \u8fde\u63a5\u6c60\u6700\u5c0f\u5927\u5c0f</li> <li><code>pool_maxsize</code> (Optional[int]): \u8fde\u63a5\u6c60\u6700\u5927\u5927\u5c0f</li> <li><code>pool_size</code> (Optional[int]): \u8fde\u63a5\u6c60\u5f53\u524d\u5927\u5c0f</li> <li><code>pool_free</code> (Optional[int]): \u7a7a\u95f2\u8fde\u63a5\u6570</li> <li><code>pool_used</code> (Optional[int]): \u4f7f\u7528\u4e2d\u8fde\u63a5\u6570</li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>status = engine.status\nprint(f\"\u8fde\u63a5\u72b6\u6001: {status['connected']}\")\nprint(f\"\u8fde\u63a5\u6c60\u5927\u5c0f: {status['pool_size']}\")\n</code></pre>"},{"location":"zh/v2/api/#is_connected","title":"is_connected","text":"<p>\u6570\u636e\u5e93\u662f\u5426\u5df2\u8fde\u63a5\u3002</p> <pre><code>@property\ndef is_connected(self) -&gt; bool\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a<code>bool</code>\uff0c\u5df2\u8fde\u63a5\u8fd4\u56de <code>True</code>\uff0c\u5426\u5219\u8fd4\u56de <code>False</code></p> <p>\u793a\u4f8b\uff1a</p> <pre><code>if engine.is_connected:\n    print(\"\u5df2\u8fde\u63a5\")\n</code></pre>"},{"location":"zh/v2/api/#pool","title":"pool","text":"<p>\u83b7\u53d6\u8fde\u63a5\u6c60\u5bf9\u8c61\uff08\u5185\u90e8\u4f7f\u7528\uff09\u3002</p> <pre><code>@property\ndef pool(self) -&gt; Pool\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a<code>aiomysql.Pool</code> \u5bf9\u8c61</p> <p>\u6ce8\u610f\uff1a\u6b64\u5c5e\u6027\u4ec5\u4f9b\u5185\u90e8\u4f7f\u7528\uff0c\u5982\u679c\u672a\u8fde\u63a5\u4f1a\u629b\u51fa <code>ConnectionError</code></p>"},{"location":"zh/v2/api/#url","title":"url","text":"<p>\u8fde\u63a5 URL\uff08\u53ea\u8bfb\uff09\u3002</p> <pre><code>url: Final[str]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>print(engine.url)  # mysql://127.0.0.1:3306/\n</code></pre>"},{"location":"zh/v2/api/#_7","title":"\u7279\u6b8a\u65b9\u6cd5","text":""},{"location":"zh/v2/api/#aenter-aexit","title":"aenter() / aexit()","text":"<p>\u652f\u6301 <code>async with</code> \u8bed\u6cd5\u3002</p> <pre><code>async def __aenter__(self) -&gt; Engine\nasync def __aexit__(self, exc_type, exc_value, exc_tb) -&gt; None\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>async with engine:\n    result = await engine.execute(\"SELECT * FROM users\")\n    data = await result.fetch_all()\n</code></pre>"},{"location":"zh/v2/api/#await","title":"await()","text":"<p>\u652f\u6301 <code>await engine</code> \u8bed\u6cd5\u3002</p> <pre><code>def __await__(self) -&gt; Generator[Any, None, Engine]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>await engine  # \u7b49\u540c\u4e8e await engine.connect()\n</code></pre>"},{"location":"zh/v2/api/#call","title":"call()","text":"<p>\u652f\u6301 <code>await engine()</code> \u8bed\u6cd5\u3002</p> <pre><code>async def __call__(self) -&gt; Engine\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>await engine()  # \u7b49\u540c\u4e8e await engine.connect()\n</code></pre>"},{"location":"zh/v2/api/#asmysql","title":"AsMysql \u7c7b","text":"<p><code>AsMysql</code> \u662f\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1\u7684\u57fa\u7c7b\uff0c\u7528\u4e8e\u5c01\u88c5\u4e1a\u52a1\u65b9\u6cd5\u3002</p>"},{"location":"zh/v2/api/#_8","title":"\u7c7b\u5b9a\u4e49","text":"<pre><code>class AsMysql:\n    \"\"\"Mysql \u7f16\u5199\u4e1a\u52a1\u903b\u8f91\u7684\u7c7b\"\"\"\n</code></pre>"},{"location":"zh/v2/api/#_9","title":"\u6784\u9020\u51fd\u6570","text":"<pre><code>def __init__(self, engine: Engine) -&gt; None\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li><code>engine</code> (Engine): <code>Engine</code> \u5b9e\u4f8b</li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nclass UserService(AsMysql):\n    pass\n\nservice = UserService(engine)\n</code></pre>"},{"location":"zh/v2/api/#_10","title":"\u5c5e\u6027","text":""},{"location":"zh/v2/api/#client","title":"client","text":"<p>\u8bbf\u95ee <code>Engine</code> \u5b9e\u4f8b\u3002</p> <pre><code>@property\ndef client(self) -&gt; Engine\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a<code>Engine</code> \u5b9e\u4f8b</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>class UserService(AsMysql):\n    async def get_users(self):\n        result = await self.client.execute(\"SELECT * FROM users\")\n        return await result.fetch_all()\n</code></pre>"},{"location":"zh/v2/api/#result","title":"Result \u7c7b","text":"<p><code>Result</code> \u662f SQL \u6267\u884c\u7ed3\u679c\u7684\u5c01\u88c5\u7c7b\uff0c\u63d0\u4f9b\u6570\u636e\u83b7\u53d6\u548c\u9519\u8bef\u5904\u7406\u529f\u80fd\u3002</p>"},{"location":"zh/v2/api/#_11","title":"\u7c7b\u5b9a\u4e49","text":"<pre><code>class Result(Generic[T]):\n    \"\"\"SQL \u6267\u884c\u7ed3\u679c\u7c7b\"\"\"\n</code></pre>"},{"location":"zh/v2/api/#_12","title":"\u6784\u9020\u51fd\u6570","text":"<pre><code>def __init__(\n    self,\n    *,\n    pool: Pool,\n    query: str,\n    values: Union[Sequence, dict] = None,\n    execute_many: bool = False,\n    stream: bool = False,\n    commit: bool = True,\n    result_class: T = tuple,\n) -&gt; None\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff08\u5185\u90e8\u4f7f\u7528\uff0c\u901a\u5e38\u4e0d\u9700\u8981\u76f4\u63a5\u6784\u9020\uff09\uff1a</p> <ul> <li><code>pool</code> (Pool): \u8fde\u63a5\u6c60\u5bf9\u8c61</li> <li><code>query</code> (str): SQL \u8bed\u53e5</li> <li><code>values</code> (Union[Sequence, dict], optional): \u53c2\u6570</li> <li><code>execute_many</code> (bool): \u662f\u5426\u6279\u91cf\u6267\u884c</li> <li><code>stream</code> (bool): \u662f\u5426\u6d41\u5f0f\u8fd4\u56de</li> <li><code>commit</code> (bool): \u662f\u5426\u63d0\u4ea4\u4e8b\u52a1</li> <li><code>result_class</code> (type): \u7ed3\u679c\u7c7b\u578b</li> </ul>"},{"location":"zh/v2/api/#_13","title":"\u65b9\u6cd5","text":""},{"location":"zh/v2/api/#fetch_one","title":"fetch_one()","text":"<p>\u83b7\u53d6\u4e00\u6761\u8bb0\u5f55\u3002</p> <pre><code>async def fetch_one(self, close: bool = None) -&gt; Optional[T]\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li><code>close</code> (bool, optional): \u662f\u5426\u81ea\u52a8\u5173\u95ed\u6e38\u6807\u8fde\u63a5\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a <code>False</code>\uff0c\u5fc5\u987b\u624b\u52a8\u8c03\u7528 <code>Result.close()</code> \u91ca\u653e\u8fde\u63a5</li> </ul> <p>\u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u6ca1\u6709\u6570\u636e\u5219\u8fd4\u56de <code>None</code></p> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = await engine.execute(\"SELECT * FROM users WHERE id = %s\", (1,))\nuser = await result.fetch_one()\nif user:\n    print(user)\n</code></pre>"},{"location":"zh/v2/api/#fetch_many","title":"fetch_many()","text":"<p>\u83b7\u53d6\u591a\u6761\u8bb0\u5f55\u3002</p> <pre><code>async def fetch_many(self, size: int = None, close: bool = None) -&gt; list[T]\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li><code>size</code> (int, optional): \u83b7\u53d6\u8bb0\u5f55\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u83b7\u53d6\u6240\u6709\u53ef\u7528\u8bb0\u5f55</li> <li><code>close</code> (bool, optional): \u662f\u5426\u81ea\u52a8\u5173\u95ed\u6e38\u6807\u8fde\u63a5</li> </ul> <p>\u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u8bb0\u5f55\u5217\u8868</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\nusers = await result.fetch_many(10)  # \u83b7\u53d6 10 \u6761\u8bb0\u5f55\n</code></pre>"},{"location":"zh/v2/api/#fetch_all","title":"fetch_all()","text":"<p>\u83b7\u53d6\u6240\u6709\u8bb0\u5f55\u3002</p> <pre><code>async def fetch_all(self) -&gt; list[T]\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u6240\u6709\u8bb0\u5f55\u7684\u5217\u8868</p> <p>\u6ce8\u610f\uff1a\u6b64\u65b9\u6cd5\u4f1a\u81ea\u52a8\u5173\u95ed\u6e38\u6807\u8fde\u63a5</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\nall_users = await result.fetch_all()\n</code></pre>"},{"location":"zh/v2/api/#iterate","title":"iterate()","text":"<p>\u5f02\u6b65\u751f\u6210\u5668\uff0c\u904d\u5386\u6240\u6709\u8bb0\u5f55\u3002</p> <pre><code>async def iterate(self) -&gt; AsyncGenerator[T, None]\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a\u5f02\u6b65\u751f\u6210\u5668\uff0c\u9010\u884c\u8fd4\u56de\u8bb0\u5f55</p> <p>\u6ce8\u610f\uff1a\u6b64\u65b9\u6cd5\u4f1a\u81ea\u52a8\u5173\u95ed\u6e38\u6807\u8fde\u63a5</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\nasync for user in result.iterate():\n    print(user)\n</code></pre>"},{"location":"zh/v2/api/#close","title":"close()","text":"<p>\u5173\u95ed\u6e38\u6807\u5e76\u91ca\u653e\u8fde\u63a5\u3002</p> <pre><code>async def close(self) -&gt; None\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\ndata = await result.fetch_one(close=False)\n# ... \u5176\u4ed6\u64cd\u4f5c\nawait result.close()  # \u624b\u52a8\u5173\u95ed\n</code></pre>"},{"location":"zh/v2/api/#_14","title":"\u5c5e\u6027","text":""},{"location":"zh/v2/api/#error","title":"error","text":"<p>\u9519\u8bef\u5f02\u5e38\u5bf9\u8c61\u3002</p> <pre><code>@property\ndef error(self) -&gt; Optional[MySQLError]\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a<code>MySQLError</code> \u5f02\u5e38\u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u6709\u9519\u8bef\u5219\u8fd4\u56de <code>None</code></p> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = await engine.execute(\"SELECT * FROM invalid_table\")\nif result.error:\n    print(f\"\u9519\u8bef: {result.error}\")\n</code></pre>"},{"location":"zh/v2/api/#error_no","title":"error_no","text":"<p>\u9519\u8bef\u7801\u3002</p> <pre><code>@property\ndef error_no(self) -&gt; int\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a\u9519\u8bef\u7801\uff08\u6574\u6570\uff09\uff0c\u5982\u679c\u6ca1\u6709\u9519\u8bef\u5219\u8fd4\u56de <code>0</code></p> <p>\u793a\u4f8b\uff1a</p> <pre><code>if result.error:\n    print(f\"\u9519\u8bef\u7801: {result.error_no}\")\n</code></pre>"},{"location":"zh/v2/api/#error_msg","title":"error_msg","text":"<p>\u9519\u8bef\u4fe1\u606f\u3002</p> <pre><code>@property\ndef error_msg(self) -&gt; str\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a\u9519\u8bef\u4fe1\u606f\uff08\u5b57\u7b26\u4e32\uff09\uff0c\u5982\u679c\u6ca1\u6709\u9519\u8bef\u5219\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>if result.error:\n    print(f\"\u9519\u8bef\u4fe1\u606f: {result.error_msg}\")\n</code></pre>"},{"location":"zh/v2/api/#row_count","title":"row_count","text":"<p>\u53d7\u5f71\u54cd\u7684\u884c\u6570\u3002</p> <pre><code>@property\ndef row_count(self) -&gt; Optional[int]\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a - \u53d7\u5f71\u54cd\u7684\u884c\u6570\uff08\u6574\u6570\uff09 - \u5982\u679c\u53d1\u751f\u9519\u8bef\uff0c\u8fd4\u56de <code>None</code> - \u5982\u679c\u4f7f\u7528\u6d41\u5f0f\u67e5\u8be2\uff08<code>stream=True</code>\uff09\uff0c\u8fd4\u56de <code>None</code></p> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = await engine.execute(\"INSERT INTO users (name) VALUES (%s)\", (\"\u5f20\u4e09\",))\nprint(f\"\u63d2\u5165\u4e86 {result.row_count} \u6761\u8bb0\u5f55\")\n</code></pre>"},{"location":"zh/v2/api/#last_rowid","title":"last_rowid","text":"<p>\u6700\u8fd1\u63d2\u5165\u7684\u8bb0\u5f55\u7684 ID\u3002</p> <pre><code>@property\ndef last_rowid(self) -&gt; Optional[int]\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a - \u6700\u8fd1\u63d2\u5165\u7684\u8bb0\u5f55\u7684 ID\uff08\u6574\u6570\uff09 - \u5982\u679c\u6ca1\u6709\u63d2\u5165\u6570\u636e\u6216\u53d1\u751f\u9519\u8bef\uff0c\u8fd4\u56de <code>None</code></p> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = await engine.execute(\"INSERT INTO users (name) VALUES (%s)\", (\"\u5f20\u4e09\",))\nprint(f\"\u65b0\u63d2\u5165\u7684 ID: {result.last_rowid}\")\n</code></pre>"},{"location":"zh/v2/api/#row_number","title":"row_number","text":"<p>\u5f53\u524d\u6e38\u6807\u7684\u4f4d\u7f6e\u3002</p> <pre><code>@property\ndef row_number(self) -&gt; Optional[int]\n</code></pre> <p>\u8fd4\u56de\u503c\uff1a - \u5f53\u524d\u6e38\u6807\u5728\u7ed3\u679c\u96c6\u4e2d\u7684\u884c\u7d22\u5f15\uff08\u4ece 0 \u5f00\u59cb\uff09 - \u5982\u679c\u65e0\u6cd5\u786e\u5b9a\u7d22\u5f15\u6216\u53d1\u751f\u9519\u8bef\uff0c\u8fd4\u56de <code>None</code></p> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\nwhile True:\n    row = await result.fetch_one(close=False)\n    if not row:\n        break\n    print(f\"\u5f53\u524d\u4f4d\u7f6e: {result.row_number}\")\n</code></pre>"},{"location":"zh/v2/api/#_15","title":"\u7279\u6b8a\u65b9\u6cd5","text":""},{"location":"zh/v2/api/#aenter-aexit_1","title":"aenter() / aexit()","text":"<p>\u652f\u6301 <code>async with</code> \u8bed\u6cd5\u3002</p> <pre><code>async def __aenter__(self) -&gt; Result[T]\nasync def __aexit__(self, exc_type, exc_value, exc_tb) -&gt; None\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>async with engine.execute(\"SELECT * FROM users\") as result:\n    data = await result.fetch_all()\n</code></pre>"},{"location":"zh/v2/api/#aiter-anext","title":"aiter() / anext()","text":"<p>\u652f\u6301 <code>async for</code> \u8bed\u6cd5\u3002</p> <pre><code>def __aiter__(self) -&gt; Result[T]\nasync def __anext__(self) -&gt; T\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\nasync for user in result:\n    print(user)\n</code></pre>"},{"location":"zh/v2/api/#await_1","title":"await()","text":"<p>\u652f\u6301 <code>await result</code> \u8bed\u6cd5\u3002</p> <pre><code>def __await__(self) -&gt; Generator[Any, None, Result[T]]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = await engine.execute(\"SELECT * FROM users\")\n# \u7b49\u540c\u4e8e\u6267\u884c\u4e86 SQL \u67e5\u8be2\n</code></pre>"},{"location":"zh/v2/api/#call_1","title":"call()","text":"<p>\u652f\u6301 <code>await result()</code> \u8bed\u6cd5\u3002</p> <pre><code>async def __call__(self) -&gt; Result[T]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>result = engine.execute(\"SELECT * FROM users\")\nawait result()  # \u6267\u884c\u67e5\u8be2\ndata = await result.fetch_all()\n</code></pre>"},{"location":"zh/v2/api/#_16","title":"\u7c7b\u578b\u5b9a\u4e49","text":""},{"location":"zh/v2/api/#enginestatus","title":"EngineStatus","text":"<p>\u8fde\u63a5\u5f15\u64ce\u72b6\u6001\u7c7b\u578b\u3002</p> <pre><code>class EngineStatus(TypedDict):\n    address: str\n    connected: bool\n    pool_minsize: Optional[int]\n    pool_maxsize: Optional[int]\n    pool_size: Optional[int]\n    pool_free: Optional[int]\n    pool_used: Optional[int]\n</code></pre>"},{"location":"zh/v2/api/#_17","title":"\u7c7b\u578b\u522b\u540d","text":"<pre><code>AsyncEngine = Engine\nAsyncResult = Result\n</code></pre> <p>\u8fd9\u4e9b\u7c7b\u578b\u522b\u540d\u7528\u4e8e\u5411\u540e\u517c\u5bb9\u6216\u7c7b\u578b\u63d0\u793a\u3002</p>"},{"location":"zh/v2/api/#_18","title":"\u5bfc\u5165\u65b9\u5f0f","text":"<pre><code># \u65b9\u5f0f\u4e00\uff1a\u4ece\u4e3b\u6a21\u5757\u5bfc\u5165\nfrom asmysql import Engine, AsMysql, Result\n\n# \u65b9\u5f0f\u4e8c\uff1a\u4ece v2 \u5b50\u6a21\u5757\u5bfc\u5165\nfrom asmysql.v2 import Engine, AsMysql, Result\n\n# \u65b9\u5f0f\u4e09\uff1a\u4f7f\u7528\u7c7b\u578b\u522b\u540d\nfrom asmysql import AsyncEngine, AsyncResult\n</code></pre>"},{"location":"zh/v2/best-practices/","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"zh/v2/best-practices/#1-mysql","title":"1. \u5bf9\u4e8e\u7b80\u5355\u7684mysql\u8fde\u63a5\u573a\u666f\u4e0b\uff0c\u5efa\u8bae\u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406","text":""},{"location":"zh/v2/best-practices/#_2","title":"\u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668","text":"<pre><code># \u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u81ea\u52a8\u7ba1\u7406\u8fde\u63a5\nasync with engine:\n    # \u6267\u884c SQL \u8bed\u53e5 \u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u5904\u7406\n    async with engine.execute(\"select user,host from mysql.user\") as result:\n        async for item in result.iterate():\n            print(item)\n    # \u9000\u51fa\u65f6\u81ea\u52a8\u65ad\u5f00 MySQL \u8fde\u63a5\n</code></pre>"},{"location":"zh/v2/best-practices/#_3","title":"\u274c \u4e0d\u63a8\u8350\uff1a\u5fd8\u8bb0\u65ad\u5f00\u8fde\u63a5","text":"<pre><code>await engine.connect()\nresult = await engine.execute(\"SELECT * FROM users\")\n# \u5fd8\u8bb0 await engine.disconnect()\n</code></pre>"},{"location":"zh/v2/best-practices/#2-close","title":"2. \u5173\u4e8e <code>close</code> \u53c2\u6570","text":"<p><code>fetch_one()</code> \u548c <code>fetch_many()</code> \u65b9\u6cd5\u63d0\u4f9b\u4e86 <code>close</code> \u53c2\u6570\u6765\u63a7\u5236\u662f\u5426\u81ea\u52a8\u5173\u95ed\u6e38\u6807\u8fde\u63a5\uff1a</p>"},{"location":"zh/v2/best-practices/#_4","title":"\u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\uff08\u81ea\u52a8\u7ba1\u7406\u8fde\u63a5\uff09","text":"<p>\u4f7f\u7528 <code>async with</code> \u65f6\uff0c\u8fde\u63a5\u4f1a\u5728\u9000\u51fa\u4e0a\u4e0b\u6587\u65f6\u81ea\u52a8\u5173\u95ed\uff0c\u65e0\u9700\u624b\u52a8\u7ba1\u7406\uff1a</p> <pre><code>async with engine.execute(\"SELECT * FROM users\") as result:\n    data = await result.fetch_one()  # close \u53c2\u6570\u4f1a\u88ab\u5ffd\u7565\uff0c\u8fde\u63a5\u7531\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u7ba1\u7406\n    # \u9000\u51fa\u65f6\u81ea\u52a8\u5173\u95ed\u8fde\u63a5\n</code></pre>"},{"location":"zh/v2/best-practices/#async-for","title":"\u2705 \u63a8\u8350\uff1a\u4f7f\u7528 <code>async for</code>\uff08\u81ea\u52a8\u7ba1\u7406\u8fde\u63a5\uff09","text":"<p>\u4f7f\u7528 <code>async for</code> \u65f6\uff0c\u8fde\u63a5\u4f1a\u5728\u8fed\u4ee3\u5b8c\u6210\u540e\u81ea\u52a8\u5173\u95ed\uff1a</p> <pre><code>async for item in engine.execute(\"SELECT * FROM users\"):\n    print(item)\n    # \u8fed\u4ee3\u5b8c\u6210\u540e\u81ea\u52a8\u5173\u95ed\u8fde\u63a5\n</code></pre>"},{"location":"zh/v2/best-practices/#close","title":"\u26a0\ufe0f \u6ce8\u610f\uff1a\u624b\u52a8\u63a7\u5236 <code>close</code> \u53c2\u6570","text":"<p>\u5982\u679c\u9700\u8981\u5728 <code>fetch_one()</code> \u6216 <code>fetch_many()</code> \u4e2d\u624b\u52a8\u63a7\u5236\u8fde\u63a5\u5173\u95ed\uff0c\u9700\u8981\u6ce8\u610f\uff1a</p> <pre><code># \u9ed8\u8ba4\u884c\u4e3a\uff1a\u81ea\u52a8\u5173\u95ed\u8fde\u63a5\uff08\u63a8\u8350\uff09\nresult = await engine.execute(\"SELECT * FROM users\")\ndata = await result.fetch_one()  # \u9ed8\u8ba4 close=True\uff0c\u81ea\u52a8\u5173\u95ed\u8fde\u63a5\n\n# \u624b\u52a8\u63a7\u5236\uff1a\u4e0d\u81ea\u52a8\u5173\u95ed\uff08\u9700\u8981\u624b\u52a8\u91ca\u653e\uff09\nresult = await engine.execute(\"SELECT * FROM users\")\ndata1 = await result.fetch_one(close=False)  # \u4e0d\u5173\u95ed\u8fde\u63a5\ndata2 = await result.fetch_one(close=False)  # \u7ee7\u7eed\u4f7f\u7528\u540c\u4e00\u8fde\u63a5\nawait result.close()  # \u26a0\ufe0f \u5fc5\u987b\u624b\u52a8\u5173\u95ed\uff0c\u5426\u5219\u8fde\u63a5\u6c60\u53ef\u80fd\u6709\u95ee\u9898\n</code></pre> <p>\u91cd\u8981\u63d0\u793a\uff1a - \u5982\u679c\u8bbe\u7f6e <code>close=False</code>\uff0c\u5fc5\u987b\u5728\u5b8c\u6210\u540e\u8c03\u7528 <code>result.close()</code> \u91ca\u653e\u8fde\u63a5 - \u5426\u5219\u8fde\u63a5\u4e0d\u4f1a\u88ab\u5f52\u8fd8\u5230\u8fde\u63a5\u6c60\uff0c\u53ef\u80fd\u5bfc\u81f4\u8fde\u63a5\u6c60\u8017\u5c3d - \u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u6216 <code>async for</code> \u65f6\uff0c<code>close</code> \u53c2\u6570\u4f1a\u88ab\u5ffd\u7565\uff0c\u8fde\u63a5\u7531\u6846\u67b6\u81ea\u52a8\u7ba1\u7406</p>"},{"location":"zh/v2/best-practices/#3","title":"3. \u9519\u8bef\u5904\u7406","text":""},{"location":"zh/v2/best-practices/#_5","title":"\u2705 \u63a8\u8350\uff1a\u68c0\u67e5\u9519\u8bef","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users\")\nif result.error:\n    logger.error(f\"\u67e5\u8be2\u5931\u8d25: {result.error_msg}\")\n    return []\nreturn await result.fetch_all()\n</code></pre>"},{"location":"zh/v2/best-practices/#_6","title":"\u274c \u4e0d\u63a8\u8350\uff1a\u5ffd\u7565\u9519\u8bef","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users\")\ndata = await result.fetch_all()  # \u5982\u679c\u51fa\u9519\uff0cdata \u53ef\u80fd\u662f\u7a7a\u5217\u8868\n</code></pre>"},{"location":"zh/v2/best-practices/#4","title":"4. \u5927\u6570\u636e\u96c6\u5904\u7406","text":""},{"location":"zh/v2/best-practices/#_7","title":"\u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u6d41\u5f0f\u67e5\u8be2","text":"<pre><code>async for row in engine.execute(\"SELECT * FROM large_table\", stream=True):\n    process(row)\n</code></pre>"},{"location":"zh/v2/best-practices/#_8","title":"\u274c \u4e0d\u63a8\u8350\uff1a\u4e00\u6b21\u6027\u52a0\u8f7d\u6240\u6709\u6570\u636e","text":"<pre><code>data = await engine.execute(\"SELECT * FROM large_table\")\nall_data = await data.fetch_all()  # \u53ef\u80fd\u5185\u5b58\u6ea2\u51fa\n</code></pre>"},{"location":"zh/v2/best-practices/#5","title":"5. \u53c2\u6570\u5316\u67e5\u8be2","text":""},{"location":"zh/v2/best-practices/#sql","title":"\u2705 \u63a8\u8350\uff1a\u4f7f\u7528\u53c2\u6570\u5316\u67e5\u8be2\u9632\u6b62 SQL \u6ce8\u5165","text":"<pre><code>result = await engine.execute(\n    \"SELECT * FROM users WHERE name = %s\",\n    (user_name,)\n)\n</code></pre>"},{"location":"zh/v2/best-practices/#_9","title":"\u274c \u4e0d\u63a8\u8350\uff1a\u5b57\u7b26\u4e32\u62fc\u63a5","text":"<pre><code>result = await engine.execute(\n    f\"SELECT * FROM users WHERE name = '{user_name}'\"\n)\n</code></pre>"},{"location":"zh/v2/best-practices/#6","title":"6. \u8fde\u63a5\u6c60\u914d\u7f6e","text":""},{"location":"zh/v2/best-practices/#_10","title":"\u2705 \u63a8\u8350\uff1a\u6839\u636e\u5e94\u7528\u8d1f\u8f7d\u914d\u7f6e\u8fde\u63a5\u6c60","text":"<pre><code>engine = Engine(\n    url=\"mysql://root:pass@127.0.0.1:3306/\",\n    min_pool_size=5,   # \u4fdd\u6301\u6700\u5c0f\u8fde\u63a5\u6570\n    max_pool_size=50,  # \u6839\u636e\u5e76\u53d1\u91cf\u8bbe\u7f6e\u6700\u5927\u503c\n    pool_recycle=3600  # 1 \u5c0f\u65f6\u56de\u6536\u7a7a\u95f2\u8fde\u63a5\n)\n</code></pre>"},{"location":"zh/v2/best-practices/#_11","title":"\u274c \u4e0d\u63a8\u8350\uff1a\u4f7f\u7528\u9ed8\u8ba4\u503c\uff08\u53ef\u80fd\u4e0d\u9002\u5408\u751f\u4ea7\u73af\u5883\uff09","text":"<pre><code>engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n</code></pre>"},{"location":"zh/v2/best-practices/#_12","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>\u8fde\u63a5\u7ba1\u7406 - \u4e86\u89e3\u8fde\u63a5\u914d\u7f6e\u7684\u8be6\u7ec6\u4fe1\u606f</li> <li>\u67e5\u8be2\u64cd\u4f5c - \u4e86\u89e3\u67e5\u8be2\u7684\u6700\u4f73\u5b9e\u8df5</li> </ul>"},{"location":"zh/v2/business-logic/","title":"\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1","text":""},{"location":"zh/v2/business-logic/#asmysql","title":"\u7ee7\u627f AsMysql \u7c7b","text":"<p><code>AsMysql</code> \u7c7b\u63d0\u4f9b\u4e86\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1\u7684\u57fa\u7c7b\uff0c\u901a\u8fc7\u7ee7\u627f\u53ef\u4ee5\u65b9\u4fbf\u5730\u7ec4\u7ec7\u4ee3\u7801\uff1a</p> <pre><code>from asmysql import Engine, AsMysql\n\nclass UserService(AsMysql):\n    async def get_user_by_id(self, user_id: int):\n        result = await self.client.execute(\n            \"SELECT * FROM users WHERE id = %s\",\n            (user_id,),\n            result_class=dict\n        )\n        if result.error:\n            return None\n        return await result.fetch_one()\n\n    async def create_user(self, name: str, email: str):\n        result = await self.client.execute(\n            \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n            (name, email)\n        )\n        if result.error:\n            raise Exception(f\"\u521b\u5efa\u7528\u6237\u5931\u8d25: {result.error_msg}\")\n        return result.last_rowid\n\n    async def list_users(self):\n        result = await self.client.execute(\n            \"SELECT * FROM users\",\n            result_class=dict\n        )\n        if result.error:\n            return []\n        return await result.fetch_all()\n</code></pre>"},{"location":"zh/v2/business-logic/#_2","title":"\u4f7f\u7528\u4e1a\u52a1\u903b\u8f91\u7c7b","text":"<pre><code># \u521b\u5efa\u5f15\u64ce\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\n# \u521b\u5efa\u4e1a\u52a1\u903b\u8f91\u5b9e\u4f8b\nuser_service = UserService(engine)\n\n# \u4f7f\u7528\u4e1a\u52a1\u65b9\u6cd5\nuser = await user_service.get_user_by_id(1)\nusers = await user_service.list_users()\nnew_user_id = await user_service.create_user(\"\u5f20\u4e09\", \"zhangsan@example.com\")\n</code></pre>"},{"location":"zh/v2/business-logic/#_3","title":"\u4f18\u52bf","text":"<ul> <li>\u4ee3\u7801\u7ec4\u7ec7\uff1a\u5c06\u6570\u636e\u5e93\u64cd\u4f5c\u5c01\u88c5\u5728\u4e1a\u52a1\u7c7b\u4e2d\uff0c\u4fbf\u4e8e\u7ef4\u62a4</li> <li>\u590d\u7528\u6027\uff1a\u4e1a\u52a1\u65b9\u6cd5\u53ef\u4ee5\u5728\u591a\u4e2a\u5730\u65b9\u590d\u7528</li> <li>\u7c7b\u578b\u5b89\u5168\uff1a\u914d\u5408\u7c7b\u578b\u63d0\u793a\uff0c\u63d0\u5347\u4ee3\u7801\u8d28\u91cf</li> <li>\u6d4b\u8bd5\u53cb\u597d\uff1a\u53ef\u4ee5\u8f7b\u677e\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5</li> </ul>"},{"location":"zh/v2/business-logic/#_4","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>\u5feb\u901f\u5f00\u59cb - \u67e5\u770b\u57fa\u672c\u4f7f\u7528\u793a\u4f8b</li> <li>\u4f7f\u7528\u793a\u4f8b - \u67e5\u770b\u66f4\u591a\u4e1a\u52a1\u903b\u8f91\u793a\u4f8b</li> </ul>"},{"location":"zh/v2/changelog/","title":"asmysql v2 \u53d8\u66f4\u65e5\u5fd7","text":"<p>\u672c\u6587\u6863\u8bb0\u5f55 asmysql v2 \u7248\u672c\u7684\u6240\u6709\u53d8\u66f4\u3002</p>"},{"location":"zh/v2/changelog/#v200","title":"v2.0.0","text":""},{"location":"zh/v2/changelog/#breaking-changes","title":"\u91cd\u5927\u53d8\u66f4 (Breaking Changes)","text":"<p>v2.0.0 \u662f\u4e00\u4e2a\u5b8c\u5168\u91cd\u6784\u7684\u7248\u672c\uff0c\u4e0e v1 \u7248\u672c\u4e0d\u517c\u5bb9\u3002\u4e3b\u8981\u53d8\u66f4\u5305\u62ec\uff1a</p> <ul> <li>\u67b6\u6784\u91cd\u6784\uff1a\u5206\u79bb <code>Engine</code> \u548c <code>AsMysql</code> \u7c7b\uff0c\u65b0\u589e\u72ec\u7acb\u7684 <code>Engine</code> \u7c7b\u5904\u7406 MySQL \u8fde\u63a5\u548c\u6267\u884c\u8bed\u53e5</li> <li>Result \u7c7b\u53d8\u66f4\uff1a<code>Result.err</code> \u5c5e\u6027\u91cd\u547d\u540d\u4e3a <code>Result.error</code></li> <li>API \u53d8\u66f4\uff1a\u8fde\u63a5\u65b9\u5f0f\u4ece\u81ea\u52a8\u8fde\u63a5\u6539\u4e3a\u663e\u5f0f\u521b\u5efa <code>Engine</code> \u5e76\u8c03\u7528 <code>connect()</code></li> </ul>"},{"location":"zh/v2/changelog/#new-features","title":"\u65b0\u529f\u80fd (New Features)","text":"<ul> <li>Engine \u7c7b\uff1a\u5168\u65b0\u7684\u8fde\u63a5\u5f15\u64ce\u7c7b\uff0c\u652f\u6301 URL \u8fde\u63a5\u5b57\u7b26\u4e32\u3001\u8fde\u63a5\u72b6\u6001\u76d1\u63a7\u3001\u7075\u6d3b\u7684\u8fde\u63a5\u7ba1\u7406</li> <li>Result \u7c7b\u589e\u5f3a\uff1a\u652f\u6301\u9519\u8bef\u4fe1\u606f\u8bbf\u95ee\uff08<code>error_no</code>\u3001<code>error_msg</code>\uff09\u3001\u6d41\u5f0f\u67e5\u8be2\u3001\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u3001\u5f02\u6b65\u8fed\u4ee3\u5668\u3001\u81ea\u5b9a\u4e49\u7ed3\u679c\u7c7b\u578b</li> <li>\u6267\u884c\u65b9\u6cd5\u589e\u5f3a\uff1a<code>execute()</code> \u65b9\u6cd5\u652f\u6301 <code>stream</code>\u3001<code>result_class</code>\u3001<code>commit</code> \u7b49\u53c2\u6570\uff0c\u652f\u6301\u591a\u79cd\u8c03\u7528\u65b9\u5f0f</li> <li>\u7c7b\u578b\u63d0\u793a\uff1a\u5b8c\u6574\u7684\u7c7b\u578b\u63d0\u793a\u652f\u6301\uff0c\u652f\u6301\u6cdb\u578b\u7c7b\u578b\uff08<code>Result[T]</code>\uff09</li> <li>\u6d4b\u8bd5\uff1a\u65b0\u589e pytest \u6d4b\u8bd5\u5957\u4ef6\uff0c\u8986\u76d6\u4e3b\u8981\u529f\u80fd\u573a\u666f</li> </ul>"},{"location":"zh/v2/changelog/#updates","title":"\u66f4\u65b0 (Updates)","text":"<ul> <li>\u5305\u7ba1\u7406\u5de5\u5177\uff1a\u4f7f\u7528 <code>uv</code> \u4f5c\u4e3a\u5305\u7ba1\u7406\u5de5\u5177</li> <li>\u4ee3\u7801\u8d28\u91cf\uff1a\u6539\u8fdb\u4ee3\u7801\u7ed3\u6784\u3001\u9519\u8bef\u5904\u7406\u548c\u6587\u6863\u5b57\u7b26\u4e32</li> </ul>"},{"location":"zh/v2/changelog/#features","title":"\u6838\u5fc3\u7279\u6027 (Features)","text":"<p>v2 \u7248\u672c\u4fdd\u7559\u4e86 v1 \u7248\u672c\u7684\u6838\u5fc3\u7279\u6027\uff1a</p> <ol> <li>\u7b80\u6613\u4f7f\u7528\uff1aasmysql \u662f\u5bf9 aiomysql \u5c01\u88c5\u7684\u7b80\u6613\u4f7f\u7528\u5e93</li> <li>\u8fde\u63a5\u6c60\u7ba1\u7406\uff1a\u81ea\u52a8\u7ba1\u7406 MySQL \u8fde\u63a5\u6c60\uff0c\u652f\u6301\u91cd\u8fde\u673a\u5236</li> <li>\u9519\u8bef\u5904\u7406\uff1a\u5168\u5c40\u81ea\u52a8\u6355\u83b7 <code>MysqlError</code> \u9519\u8bef</li> <li>\u6267\u884c\u4e0e\u83b7\u53d6\u5206\u79bb\uff1a\u6267\u884c SQL \u8bed\u53e5\u548c\u83b7\u53d6\u7ed3\u679c\u5206\u79bb</li> <li>\u7c7b\u578b\u63d0\u793a\uff1a\u5b8c\u6574\u7684 Python \u7c7b\u578b\u63d0\u793a\u652f\u6301</li> <li>\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1\uff1a\u76f4\u63a5\u7ee7\u627f <code>AsMysql</code> \u7c7b\u8fdb\u884c\u903b\u8f91\u5f00\u53d1</li> </ol>"},{"location":"zh/v2/changelog/#_1","title":"\u8fc1\u79fb\u6307\u5357","text":"<p>\u8be6\u7ec6\u7684\u8fc1\u79fb\u6307\u5357\u8bf7\u53c2\u8003 \u8fc1\u79fb\u6307\u5357\u3002</p>"},{"location":"zh/v2/connection/","title":"\u8fde\u63a5\u7ba1\u7406","text":""},{"location":"zh/v2/connection/#_2","title":"\u8fde\u63a5\u914d\u7f6e","text":""},{"location":"zh/v2/connection/#url","title":"\u4f7f\u7528 URL \u8fde\u63a5\u5b57\u7b26\u4e32","text":"<pre><code>from asmysql import Engine\n\n# \u57fa\u672c URL\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/?charset=utf8mb4\")\n\n# \u5b8c\u6574 URL\uff08\u5305\u542b\u6240\u6709\u53c2\u6570\uff09\nengine = Engine(\n    url=\"mysql://root:pass@127.0.0.1:3306/\"\n    \"?charset=utf8mb4\"\n    \"&amp;min_pool_size=2\"\n    \"&amp;max_pool_size=20\"\n    \"&amp;pool_recycle=3600\"\n    \"&amp;connect_timeout=10\"\n    \"&amp;auto_commit=true\"\n    \"&amp;echo_sql_log=false\"\n)\n</code></pre>"},{"location":"zh/v2/connection/#_3","title":"\u4f7f\u7528\u5173\u952e\u5b57\u53c2\u6570","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(\n    host=\"127.0.0.1\",\n    port=3306,\n    user=\"root\",\n    password=\"pass\",\n    charset=\"utf8mb4\",\n    min_pool_size=1,\n    max_pool_size=10,\n    pool_recycle=-1,\n    connect_timeout=5,\n    auto_commit=True,\n    echo_sql_log=False,\n    stream=False,\n    result_class=tuple\n)\n</code></pre>"},{"location":"zh/v2/connection/#_4","title":"\u8fde\u63a5\u53c2\u6570\u8bf4\u660e","text":"\u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>host</code> str <code>\"127.0.0.1\"</code> MySQL \u670d\u52a1\u5668\u5730\u5740 <code>port</code> int <code>3306</code> MySQL \u670d\u52a1\u5668\u7aef\u53e3 <code>user</code> str <code>\"\"</code> \u7528\u6237\u540d <code>password</code> str <code>\"\"</code> \u5bc6\u7801 <code>charset</code> str <code>\"utf8mb4\"</code> \u5b57\u7b26\u96c6 <code>min_pool_size</code> int <code>1</code> \u8fde\u63a5\u6c60\u6700\u5c0f\u8fde\u63a5\u6570 <code>max_pool_size</code> int <code>10</code> \u8fde\u63a5\u6c60\u6700\u5927\u8fde\u63a5\u6570 <code>pool_recycle</code> float <code>-1</code> \u7a7a\u95f2\u8fde\u63a5\u56de\u6536\u65f6\u95f4\uff08\u79d2\uff09\uff0c-1 \u8868\u793a\u4e0d\u56de\u6536 <code>connect_timeout</code> int <code>5</code> \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff08\u79d2\uff09 <code>auto_commit</code> bool <code>True</code> \u662f\u5426\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1 <code>echo_sql_log</code> bool <code>False</code> \u662f\u5426\u6253\u5370 SQL \u65e5\u5fd7 <code>stream</code> bool <code>False</code> \u662f\u5426\u4f7f\u7528\u6d41\u5f0f\u8fd4\u56de\u7ed3\u679c <code>result_class</code> type <code>tuple</code> \u8fd4\u56de\u7ed3\u679c\u7c7b\u578b"},{"location":"zh/v2/connection/#_5","title":"\u8fde\u63a5\u548c\u65ad\u5f00","text":""},{"location":"zh/v2/connection/#_6","title":"\u65b9\u5f0f\u4e00\uff1a\u663e\u5f0f\u8fde\u63a5","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n\n# \u8fde\u63a5\nawait engine.connect()\n# ... \u4f7f\u7528 engine\nawait engine.disconnect()\n</code></pre>"},{"location":"zh/v2/connection/#_7","title":"\u65b9\u5f0f\u4e8c\uff1a\u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n\nasync with engine:\n    # ... \u4f7f\u7528 engine\n    pass  # \u81ea\u52a8\u65ad\u5f00\u8fde\u63a5\n</code></pre>"},{"location":"zh/v2/connection/#await","title":"\u65b9\u5f0f\u4e09\uff1a\u4f7f\u7528 await","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n\nawait engine()  # \u7b49\u540c\u4e8e await engine.connect()\n</code></pre>"},{"location":"zh/v2/connection/#_8","title":"\u68c0\u67e5\u8fde\u63a5\u72b6\u6001","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n\n# \u68c0\u67e5\u662f\u5426\u5df2\u8fde\u63a5\nif engine.is_connected:\n    print(\"\u5df2\u8fde\u63a5\")\n\n# \u83b7\u53d6\u8fde\u63a5\u72b6\u6001\u4fe1\u606f\nawait engine.connect()\nstatus = engine.status\nprint(f\"\u5730\u5740: {status['address']}\")\nprint(f\"\u5df2\u8fde\u63a5: {status['connected']}\")\nprint(f\"\u8fde\u63a5\u6c60\u5927\u5c0f: {status['pool_size']}\")\nprint(f\"\u7a7a\u95f2\u8fde\u63a5: {status['pool_free']}\")\nprint(f\"\u4f7f\u7528\u4e2d\u8fde\u63a5: {status['pool_used']}\")\n</code></pre>"},{"location":"zh/v2/connection/#_9","title":"\u91ca\u653e\u8fde\u63a5","text":"<pre><code># \u91ca\u653e\u8fde\u63a5\u6c60\u4e2d\u6240\u6709\u7a7a\u95f2\u8fde\u63a5\nawait engine.release_connections()\n</code></pre>"},{"location":"zh/v2/examples/","title":"asmysql v2 \u4f7f\u7528\u793a\u4f8b","text":"<p>\u672c\u6587\u6863\u63d0\u4f9b asmysql v2 \u7248\u672c\u7684\u8be6\u7ec6\u4f7f\u7528\u793a\u4f8b\u3002</p>"},{"location":"zh/v2/examples/#_1","title":"\u76ee\u5f55","text":"<ul> <li>\u57fa\u7840\u793a\u4f8b</li> <li>\u8fde\u63a5\u7ba1\u7406</li> <li>\u67e5\u8be2\u64cd\u4f5c</li> <li>\u63d2\u5165\u64cd\u4f5c</li> <li>\u66f4\u65b0\u64cd\u4f5c</li> <li>\u5220\u9664\u64cd\u4f5c</li> <li>\u4e8b\u52a1\u5904\u7406</li> <li>\u6d41\u5f0f\u67e5\u8be2</li> <li>\u6279\u91cf\u64cd\u4f5c</li> <li>\u81ea\u5b9a\u4e49\u6a21\u578b</li> <li>\u9519\u8bef\u5904\u7406</li> <li>\u4e1a\u52a1\u903b\u8f91\u5c01\u88c5</li> <li>\u5b8c\u6574\u5e94\u7528\u793a\u4f8b</li> </ul>"},{"location":"zh/v2/examples/#_2","title":"\u57fa\u7840\u793a\u4f8b","text":""},{"location":"zh/v2/examples/#_3","title":"\u6700\u7b80\u5355\u7684\u67e5\u8be2","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    # \u521b\u5efa\u5f15\u64ce\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n\n    # \u8fde\u63a5\n    await engine.connect()\n\n    # \u6267\u884c\u67e5\u8be2\n    result = await engine.execute(\"SELECT 1 as value\")\n    data = await result.fetch_one()\n    print(data)  # (1,)\n\n    # \u65ad\u5f00\u8fde\u63a5\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_4","title":"\u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n\n    async with engine:\n        result = await engine.execute(\"SELECT 1 as value\")\n        data = await result.fetch_one()\n        print(data)\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_5","title":"\u8fde\u63a5\u7ba1\u7406","text":""},{"location":"zh/v2/examples/#_6","title":"\u68c0\u67e5\u8fde\u63a5\u72b6\u6001","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n\n    print(f\"\u8fde\u63a5\u524d: {engine.is_connected}\")  # False\n\n    await engine.connect()\n    print(f\"\u8fde\u63a5\u540e: {engine.is_connected}\")  # True\n\n    # \u67e5\u770b\u8fde\u63a5\u6c60\u72b6\u6001\n    status = engine.status\n    print(f\"\u8fde\u63a5\u5730\u5740: {status['address']}\")\n    print(f\"\u8fde\u63a5\u6c60\u5927\u5c0f: {status['pool_size']}\")\n    print(f\"\u7a7a\u95f2\u8fde\u63a5: {status['pool_free']}\")\n    print(f\"\u4f7f\u7528\u4e2d\u8fde\u63a5: {status['pool_used']}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_7","title":"\u8fde\u63a5\u6c60\u914d\u7f6e","text":"<pre><code>from asmysql import Engine\n\n# \u914d\u7f6e\u8fde\u63a5\u6c60\nengine = Engine(\n    url=\"mysql://root:pass@127.0.0.1:3306/test_db\",\n    min_pool_size=5,      # \u6700\u5c0f\u8fde\u63a5\u6570\n    max_pool_size=50,     # \u6700\u5927\u8fde\u63a5\u6570\n    pool_recycle=3600,    # 1 \u5c0f\u65f6\u56de\u6536\u7a7a\u95f2\u8fde\u63a5\n    connect_timeout=10    # \u8fde\u63a5\u8d85\u65f6 10 \u79d2\n)\n</code></pre>"},{"location":"zh/v2/examples/#_8","title":"\u67e5\u8be2\u64cd\u4f5c","text":""},{"location":"zh/v2/examples/#_9","title":"\u5355\u6761\u8bb0\u5f55\u67e5\u8be2","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # \u4f7f\u7528 tuple \u7c7b\u578b\uff08\u9ed8\u8ba4\uff09\n    result = await engine.execute(\n        \"SELECT id, name, email FROM users WHERE id = %s\",\n        (1,)\n    )\n    user = await result.fetch_one()\n    if user:\n        print(f\"ID: {user[0]}, \u59d3\u540d: {user[1]}, \u90ae\u7bb1: {user[2]}\")\n\n    # \u4f7f\u7528 dict \u7c7b\u578b\n    result = await engine.execute(\n        \"SELECT id, name, email FROM users WHERE id = %s\",\n        (1,),\n        result_class=dict\n    )\n    user = await result.fetch_one()\n    if user:\n        print(f\"ID: {user['id']}, \u59d3\u540d: {user['name']}, \u90ae\u7bb1: {user['email']}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_10","title":"\u591a\u6761\u8bb0\u5f55\u67e5\u8be2","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # \u83b7\u53d6\u6240\u6709\u8bb0\u5f55\n    result = await engine.execute(\"SELECT * FROM users\")\n    all_users = await result.fetch_all()\n    print(f\"\u5171 {len(all_users)} \u6761\u8bb0\u5f55\")\n\n    # \u83b7\u53d6\u6307\u5b9a\u6570\u91cf\u7684\u8bb0\u5f55\n    result = await engine.execute(\"SELECT * FROM users\")\n    users = await result.fetch_many(10)  # \u83b7\u53d6 10 \u6761\n    print(f\"\u83b7\u53d6\u4e86 {len(users)} \u6761\u8bb0\u5f55\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_11","title":"\u4f7f\u7528\u5b57\u5178\u53c2\u6570","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # \u4f7f\u7528\u5b57\u5178\u53c2\u6570\n    result = await engine.execute(\n        \"SELECT * FROM users WHERE name = %(name)s AND age &gt; %(age)s\",\n        {\"name\": \"\u5f20\u4e09\", \"age\": 18}\n    )\n    users = await result.fetch_all()\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_12","title":"\u4f7f\u7528\u8fed\u4ee3\u5668","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # \u65b9\u5f0f\u4e00\uff1a\u4f7f\u7528 iterate() \u65b9\u6cd5\n    result = await engine.execute(\"SELECT * FROM users\")\n    async for user in result.iterate():\n        print(user)\n\n    # \u65b9\u5f0f\u4e8c\uff1a\u76f4\u63a5\u8fed\u4ee3 result\n    result = await engine.execute(\"SELECT * FROM users\")\n    async for user in result:\n        print(user)\n\n    # \u65b9\u5f0f\u4e09\uff1a\u76f4\u63a5\u8fed\u4ee3 execute \u8fd4\u56de\u7684\u7ed3\u679c\n    async for user in engine.execute(\"SELECT * FROM users\"):\n        print(user)\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_13","title":"\u63d2\u5165\u64cd\u4f5c","text":""},{"location":"zh/v2/examples/#_14","title":"\u5355\u6761\u63d2\u5165","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # \u63d2\u5165\u6570\u636e\n    result = await engine.execute(\n        \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n        (\"\u5f20\u4e09\", \"zhangsan@example.com\")\n    )\n\n    if result.error:\n        print(f\"\u63d2\u5165\u5931\u8d25: {result.error_msg}\")\n    else:\n        print(f\"\u63d2\u5165\u6210\u529f\uff0c\u53d7\u5f71\u54cd\u884c\u6570: {result.row_count}\")\n        print(f\"\u65b0\u63d2\u5165\u7684 ID: {result.last_rowid}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#id","title":"\u83b7\u53d6\u63d2\u5165\u7684 ID","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    result = await engine.execute(\n        \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n        (\"\u674e\u56db\", \"lisi@example.com\")\n    )\n\n    if not result.error:\n        new_id = result.last_rowid\n        print(f\"\u65b0\u7528\u6237\u7684 ID: {new_id}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_15","title":"\u66f4\u65b0\u64cd\u4f5c","text":""},{"location":"zh/v2/examples/#_16","title":"\u66f4\u65b0\u5355\u6761\u8bb0\u5f55","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    result = await engine.execute(\n        \"UPDATE users SET email = %s WHERE id = %s\",\n        (\"newemail@example.com\", 1)\n    )\n\n    if result.error:\n        print(f\"\u66f4\u65b0\u5931\u8d25: {result.error_msg}\")\n    else:\n        print(f\"\u66f4\u65b0\u6210\u529f\uff0c\u53d7\u5f71\u54cd\u884c\u6570: {result.row_count}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_17","title":"\u6279\u91cf\u66f4\u65b0","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # \u4f7f\u7528 execute_many \u6279\u91cf\u66f4\u65b0\n    updates = [\n        (\"email1@example.com\", 1),\n        (\"email2@example.com\", 2),\n        (\"email3@example.com\", 3)\n    ]\n\n    result = await engine.execute_many(\n        \"UPDATE users SET email = %s WHERE id = %s\",\n        updates\n    )\n\n    if not result.error:\n        print(f\"\u6279\u91cf\u66f4\u65b0\u6210\u529f\uff0c\u53d7\u5f71\u54cd\u884c\u6570: {result.row_count}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_18","title":"\u5220\u9664\u64cd\u4f5c","text":""},{"location":"zh/v2/examples/#_19","title":"\u5220\u9664\u8bb0\u5f55","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    result = await engine.execute(\n        \"DELETE FROM users WHERE id = %s\",\n        (1,)\n    )\n\n    if result.error:\n        print(f\"\u5220\u9664\u5931\u8d25: {result.error_msg}\")\n    else:\n        print(f\"\u5220\u9664\u6210\u529f\uff0c\u53d7\u5f71\u54cd\u884c\u6570: {result.row_count}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_20","title":"\u4e8b\u52a1\u5904\u7406","text":""},{"location":"zh/v2/examples/#_21","title":"\u57fa\u672c\u4e8b\u52a1","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    # \u5173\u95ed\u81ea\u52a8\u63d0\u4ea4\n    engine = Engine(\n        url=\"mysql://root:pass@127.0.0.1:3306/test_db\",\n        auto_commit=False\n    )\n    await engine.connect()\n\n    try:\n        # \u63d2\u5165\u7528\u6237\n        result1 = await engine.execute(\n            \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n            (\"\u5f20\u4e09\", \"zhangsan@example.com\"),\n            commit=False\n        )\n        if result1.error:\n            raise Exception(result1.error_msg)\n\n        user_id = result1.last_rowid\n\n        # \u63d2\u5165\u7528\u6237\u8be6\u60c5\n        result2 = await engine.execute(\n            \"INSERT INTO user_profiles (user_id, bio) VALUES (%s, %s)\",\n            (user_id, \"\u8fd9\u662f\u5f20\u4e09\u7684\u4e2a\u4eba\u7b80\u4ecb\"),\n            commit=False\n        )\n        if result2.error:\n            raise Exception(result2.error_msg)\n\n        # \u624b\u52a8\u63d0\u4ea4\uff08\u9700\u8981\u8bbf\u95ee\u8fde\u63a5\u5bf9\u8c61\uff09\n        # \u6ce8\u610f\uff1av2 \u7248\u672c\u7684\u4e8b\u52a1\u7ba1\u7406\u9700\u8981\u624b\u52a8\u63a7\u5236\n        # \u8fd9\u91cc\u7b80\u5316\u793a\u4f8b\uff0c\u5b9e\u9645\u4f7f\u7528\u65f6\u9700\u8981\u66f4\u7cbe\u7ec6\u7684\u63a7\u5236\n\n    except Exception as e:\n        print(f\"\u4e8b\u52a1\u5931\u8d25: {e}\")\n        # \u56de\u6eda\u64cd\u4f5c\u9700\u8981\u624b\u52a8\u5904\u7406\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_22","title":"\u6d41\u5f0f\u67e5\u8be2","text":""},{"location":"zh/v2/examples/#_23","title":"\u5904\u7406\u5927\u6570\u636e\u96c6","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # \u542f\u7528\u6d41\u5f0f\u67e5\u8be2\n    result = await engine.execute(\n        \"SELECT * FROM large_table\",\n        stream=True\n    )\n\n    count = 0\n    async for row in result:\n        count += 1\n        # \u5904\u7406\u6bcf\u4e00\u884c\u6570\u636e\uff0c\u4e0d\u5360\u7528\u5185\u5b58\n        process_row(row)\n\n        if count % 1000 == 0:\n            print(f\"\u5df2\u5904\u7406 {count} \u6761\u8bb0\u5f55\")\n\n    print(f\"\u603b\u5171\u5904\u7406\u4e86 {count} \u6761\u8bb0\u5f55\")\n\n    await engine.disconnect()\n\ndef process_row(row):\n    \"\"\"\u5904\u7406\u5355\u884c\u6570\u636e\"\"\"\n    pass\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_24","title":"\u6d41\u5f0f\u67e5\u8be2\u4e0e\u666e\u901a\u67e5\u8be2\u5bf9\u6bd4","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # \u666e\u901a\u67e5\u8be2\uff1a\u6240\u6709\u6570\u636e\u52a0\u8f7d\u5230\u5185\u5b58\n    result1 = await engine.execute(\"SELECT * FROM large_table\", stream=False)\n    all_data = await result1.fetch_all()  # \u53ef\u80fd\u5185\u5b58\u6ea2\u51fa\n    print(f\"\u666e\u901a\u67e5\u8be2\u83b7\u53d6 {len(all_data)} \u6761\u8bb0\u5f55\")\n\n    # \u6d41\u5f0f\u67e5\u8be2\uff1a\u9010\u884c\u5904\u7406\uff0c\u4e0d\u5360\u7528\u5185\u5b58\n    result2 = await engine.execute(\"SELECT * FROM large_table\", stream=True)\n    count = 0\n    async for row in result2:\n        count += 1\n    print(f\"\u6d41\u5f0f\u67e5\u8be2\u5904\u7406 {count} \u6761\u8bb0\u5f55\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_25","title":"\u6279\u91cf\u64cd\u4f5c","text":""},{"location":"zh/v2/examples/#_26","title":"\u6279\u91cf\u63d2\u5165","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # \u51c6\u5907\u6279\u91cf\u6570\u636e\n    users = [\n        (\"\u5f20\u4e09\", \"zhangsan@example.com\"),\n        (\"\u674e\u56db\", \"lisi@example.com\"),\n        (\"\u738b\u4e94\", \"wangwu@example.com\"),\n        (\"\u8d75\u516d\", \"zhaoliu@example.com\")\n    ]\n\n    # \u6279\u91cf\u63d2\u5165\n    result = await engine.execute_many(\n        \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n        users\n    )\n\n    if result.error:\n        print(f\"\u6279\u91cf\u63d2\u5165\u5931\u8d25: {result.error_msg}\")\n    else:\n        print(f\"\u6279\u91cf\u63d2\u5165\u6210\u529f\uff0c\u63d2\u5165\u4e86 {result.row_count} \u6761\u8bb0\u5f55\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_27","title":"\u4f7f\u7528\u5b57\u5178\u6279\u91cf\u63d2\u5165","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # \u4f7f\u7528\u5b57\u5178\u683c\u5f0f\u7684\u6279\u91cf\u6570\u636e\n    users = [\n        {\"name\": \"\u5f20\u4e09\", \"email\": \"zhangsan@example.com\"},\n        {\"name\": \"\u674e\u56db\", \"email\": \"lisi@example.com\"},\n        {\"name\": \"\u738b\u4e94\", \"email\": \"wangwu@example.com\"}\n    ]\n\n    result = await engine.execute_many(\n        \"INSERT INTO users (name, email) VALUES (%(name)s, %(email)s)\",\n        users\n    )\n\n    if not result.error:\n        print(f\"\u6279\u91cf\u63d2\u5165\u6210\u529f\uff0c\u63d2\u5165\u4e86 {result.row_count} \u6761\u8bb0\u5f55\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_28","title":"\u81ea\u5b9a\u4e49\u6a21\u578b","text":""},{"location":"zh/v2/examples/#pydantic","title":"\u4f7f\u7528 Pydantic \u6a21\u578b","text":"<pre><code>import asyncio\nfrom pydantic import BaseModel\nfrom asmysql import Engine\n\n# \u5b9a\u4e49\u7528\u6237\u6a21\u578b\nclass User(BaseModel):\n    id: int\n    name: str\n    email: str\n    age: int = 0\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    # \u67e5\u8be2\u5e76\u4f7f\u7528\u81ea\u5b9a\u4e49\u6a21\u578b\n    result = await engine.execute(\n        \"SELECT id, name, email, age FROM users WHERE id = %s\",\n        (1,),\n        result_class=User\n    )\n\n    user = await result.fetch_one()\n    if user:\n        print(f\"\u7528\u6237: {user.name}, \u90ae\u7bb1: {user.email}, \u5e74\u9f84: {user.age}\")\n        # \u53ef\u4ee5\u4f7f\u7528\u6a21\u578b\u7684\u6240\u6709\u529f\u80fd\n        print(user.model_dump())\n\n    # \u6279\u91cf\u67e5\u8be2\n    result = await engine.execute(\n        \"SELECT id, name, email, age FROM users\",\n        result_class=User\n    )\n\n    users = []\n    async for user in result.iterate():\n        users.append(user)\n        print(f\"{user.name}: {user.email}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_29","title":"\u4f7f\u7528\u666e\u901a\u7c7b","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\n# \u5b9a\u4e49\u666e\u901a\u7c7b\nclass User:\n    def __init__(self, id: int, name: str, email: str):\n        self.id = id\n        self.name = name\n        self.email = email\n\n    def __repr__(self):\n        return f\"User(id={self.id}, name={self.name}, email={self.email})\"\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    result = await engine.execute(\n        \"SELECT id, name, email FROM users\",\n        result_class=User\n    )\n\n    async for user in result:\n        print(user)  # \u81ea\u52a8\u8f6c\u6362\u4e3a User \u5b9e\u4f8b\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_30","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"zh/v2/examples/#_31","title":"\u57fa\u672c\u9519\u8bef\u5904\u7406","text":"<pre><code>import asyncio\nfrom asmysql import Engine\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    result = await engine.execute(\"SELECT * FROM non_existent_table\")\n\n    if result.error:\n        print(f\"\u9519\u8bef\u7801: {result.error_no}\")\n        print(f\"\u9519\u8bef\u4fe1\u606f: {result.error_msg}\")\n        print(f\"\u9519\u8bef\u5bf9\u8c61: {result.error}\")\n    else:\n        data = await result.fetch_all()\n        print(f\"\u67e5\u8be2\u6210\u529f\uff0c\u83b7\u53d6 {len(data)} \u6761\u8bb0\u5f55\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_32","title":"\u9519\u8bef\u5904\u7406\u88c5\u9970\u5668","text":"<pre><code>import asyncio\nfrom functools import wraps\nfrom asmysql import Engine\n\ndef handle_db_errors(func):\n    \"\"\"\u6570\u636e\u5e93\u9519\u8bef\u5904\u7406\u88c5\u9970\u5668\"\"\"\n    @wraps(func)\n    async def wrapper(*args, **kwargs):\n        try:\n            return await func(*args, **kwargs)\n        except Exception as e:\n            print(f\"\u6570\u636e\u5e93\u64cd\u4f5c\u5931\u8d25: {e}\")\n            return None\n    return wrapper\n\n@handle_db_errors\nasync def get_user(engine: Engine, user_id: int):\n    result = await engine.execute(\n        \"SELECT * FROM users WHERE id = %s\",\n        (user_id,),\n        result_class=dict\n    )\n    if result.error:\n        raise Exception(f\"\u67e5\u8be2\u5931\u8d25: {result.error_msg}\")\n    return await result.fetch_one()\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    user = await get_user(engine, 1)\n    if user:\n        print(f\"\u7528\u6237: {user['name']}\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_33","title":"\u4e1a\u52a1\u903b\u8f91\u5c01\u88c5","text":""},{"location":"zh/v2/examples/#_34","title":"\u7528\u6237\u670d\u52a1\u7c7b","text":"<pre><code>import asyncio\nfrom typing import Optional, List\nfrom pydantic import BaseModel\nfrom asmysql import Engine, AsMysql\n\nclass User(BaseModel):\n    id: int\n    name: str\n    email: str\n    age: int = 0\n\nclass UserService(AsMysql):\n    \"\"\"\u7528\u6237\u670d\u52a1\u7c7b\"\"\"\n\n    async def get_user_by_id(self, user_id: int) -&gt; Optional[User]:\n        \"\"\"\u6839\u636e ID \u83b7\u53d6\u7528\u6237\"\"\"\n        result = await self.client.execute(\n            \"SELECT id, name, email, age FROM users WHERE id = %s\",\n            (user_id,),\n            result_class=User\n        )\n        if result.error:\n            return None\n        return await result.fetch_one()\n\n    async def get_user_by_email(self, email: str) -&gt; Optional[User]:\n        \"\"\"\u6839\u636e\u90ae\u7bb1\u83b7\u53d6\u7528\u6237\"\"\"\n        result = await self.client.execute(\n            \"SELECT id, name, email, age FROM users WHERE email = %s\",\n            (email,),\n            result_class=User\n        )\n        if result.error:\n            return None\n        return await result.fetch_one()\n\n    async def list_users(self, limit: int = 100) -&gt; List[User]:\n        \"\"\"\u83b7\u53d6\u7528\u6237\u5217\u8868\"\"\"\n        result = await self.client.execute(\n            \"SELECT id, name, email, age FROM users LIMIT %s\",\n            (limit,),\n            result_class=User\n        )\n        if result.error:\n            return []\n        return await result.fetch_all()\n\n    async def create_user(self, name: str, email: str, age: int = 0) -&gt; Optional[int]:\n        \"\"\"\u521b\u5efa\u7528\u6237\"\"\"\n        result = await self.client.execute(\n            \"INSERT INTO users (name, email, age) VALUES (%s, %s, %s)\",\n            (name, email, age)\n        )\n        if result.error:\n            return None\n        return result.last_rowid\n\n    async def update_user(self, user_id: int, name: str = None, email: str = None, age: int = None) -&gt; bool:\n        \"\"\"\u66f4\u65b0\u7528\u6237\"\"\"\n        updates = []\n        values = []\n\n        if name is not None:\n            updates.append(\"name = %s\")\n            values.append(name)\n        if email is not None:\n            updates.append(\"email = %s\")\n            values.append(email)\n        if age is not None:\n            updates.append(\"age = %s\")\n            values.append(age)\n\n        if not updates:\n            return False\n\n        values.append(user_id)\n        query = f\"UPDATE users SET {', '.join(updates)} WHERE id = %s\"\n\n        result = await self.client.execute(query, tuple(values))\n        return result.error is None\n\n    async def delete_user(self, user_id: int) -&gt; bool:\n        \"\"\"\u5220\u9664\u7528\u6237\"\"\"\n        result = await self.client.execute(\n            \"DELETE FROM users WHERE id = %s\",\n            (user_id,)\n        )\n        return result.error is None\n\nasync def main():\n    engine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n    await engine.connect()\n\n    user_service = UserService(engine)\n\n    # \u521b\u5efa\u7528\u6237\n    user_id = await user_service.create_user(\"\u5f20\u4e09\", \"zhangsan@example.com\", 25)\n    print(f\"\u521b\u5efa\u7528\u6237\uff0cID: {user_id}\")\n\n    # \u83b7\u53d6\u7528\u6237\n    user = await user_service.get_user_by_id(user_id)\n    if user:\n        print(f\"\u7528\u6237: {user.name}, \u90ae\u7bb1: {user.email}, \u5e74\u9f84: {user.age}\")\n\n    # \u66f4\u65b0\u7528\u6237\n    success = await user_service.update_user(user_id, age=26)\n    print(f\"\u66f4\u65b0\u7528\u6237: {success}\")\n\n    # \u83b7\u53d6\u7528\u6237\u5217\u8868\n    users = await user_service.list_users(10)\n    print(f\"\u7528\u6237\u5217\u8868\uff0c\u5171 {len(users)} \u6761\")\n\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/examples/#_35","title":"\u5b8c\u6574\u5e94\u7528\u793a\u4f8b","text":""},{"location":"zh/v2/examples/#web-fastapi","title":"Web \u5e94\u7528\u793a\u4f8b\uff08FastAPI\uff09","text":"<pre><code>from fastapi import FastAPI, HTTPException\nfrom pydantic import BaseModel\nfrom asmysql import Engine, AsMysql\nfrom contextlib import asynccontextmanager\n\n# \u5168\u5c40\u5f15\u64ce\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/test_db\")\n\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    # \u542f\u52a8\u65f6\u8fde\u63a5\n    await engine.connect()\n    yield\n    # \u5173\u95ed\u65f6\u65ad\u5f00\n    await engine.disconnect()\n\napp = FastAPI(lifespan=lifespan)\n\n# \u6570\u636e\u6a21\u578b\nclass UserCreate(BaseModel):\n    name: str\n    email: str\n    age: int = 0\n\nclass UserResponse(BaseModel):\n    id: int\n    name: str\n    email: str\n    age: int\n\n# \u670d\u52a1\u7c7b\nclass UserService(AsMysql):\n    async def create_user(self, user_data: UserCreate) -&gt; int:\n        result = await self.client.execute(\n            \"INSERT INTO users (name, email, age) VALUES (%s, %s, %s)\",\n            (user_data.name, user_data.email, user_data.age)\n        )\n        if result.error:\n            raise HTTPException(status_code=500, detail=result.error_msg)\n        return result.last_rowid\n\n    async def get_user(self, user_id: int) -&gt; UserResponse:\n        result = await self.client.execute(\n            \"SELECT id, name, email, age FROM users WHERE id = %s\",\n            (user_id,),\n            result_class=UserResponse\n        )\n        if result.error:\n            raise HTTPException(status_code=500, detail=result.error_msg)\n        user = await result.fetch_one()\n        if not user:\n            raise HTTPException(status_code=404, detail=\"\u7528\u6237\u4e0d\u5b58\u5728\")\n        return user\n\n# API \u8def\u7531\n@app.post(\"/users\", response_model=UserResponse)\nasync def create_user(user_data: UserCreate):\n    service = UserService(engine)\n    user_id = await service.create_user(user_data)\n    return await service.get_user(user_id)\n\n@app.get(\"/users/{user_id}\", response_model=UserResponse)\nasync def get_user(user_id: int):\n    service = UserService(engine)\n    return await service.get_user(user_id)\n</code></pre>"},{"location":"zh/v2/examples/#_36","title":"\u547d\u4ee4\u884c\u5de5\u5177\u793a\u4f8b","text":"<pre><code>import asyncio\nimport argparse\nfrom asmysql import Engine, AsMysql\n\nclass UserCLI(AsMysql):\n    async def list_users(self):\n        \"\"\"\u5217\u51fa\u6240\u6709\u7528\u6237\"\"\"\n        result = await self.client.execute(\n            \"SELECT id, name, email FROM users\",\n            result_class=dict\n        )\n        if result.error:\n            print(f\"\u9519\u8bef: {result.error_msg}\")\n            return\n\n        users = await result.fetch_all()\n        print(f\"\u5171 {len(users)} \u4e2a\u7528\u6237:\")\n        for user in users:\n            print(f\"  ID: {user['id']}, \u59d3\u540d: {user['name']}, \u90ae\u7bb1: {user['email']}\")\n\n    async def add_user(self, name: str, email: str):\n        \"\"\"\u6dfb\u52a0\u7528\u6237\"\"\"\n        result = await self.client.execute(\n            \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n            (name, email)\n        )\n        if result.error:\n            print(f\"\u6dfb\u52a0\u5931\u8d25: {result.error_msg}\")\n        else:\n            print(f\"\u6dfb\u52a0\u6210\u529f\uff0cID: {result.last_rowid}\")\n\nasync def main():\n    parser = argparse.ArgumentParser(description=\"\u7528\u6237\u7ba1\u7406\u5de5\u5177\")\n    parser.add_argument(\"--host\", default=\"127.0.0.1\", help=\"MySQL \u4e3b\u673a\")\n    parser.add_argument(\"--port\", type=int, default=3306, help=\"MySQL \u7aef\u53e3\")\n    parser.add_argument(\"--user\", default=\"root\", help=\"MySQL \u7528\u6237\")\n    parser.add_argument(\"--password\", default=\"\", help=\"MySQL \u5bc6\u7801\")\n    parser.add_argument(\"--database\", required=True, help=\"\u6570\u636e\u5e93\u540d\")\n\n    subparsers = parser.add_subparsers(dest=\"command\", help=\"\u547d\u4ee4\")\n    subparsers.add_parser(\"list\", help=\"\u5217\u51fa\u7528\u6237\")\n    add_parser = subparsers.add_parser(\"add\", help=\"\u6dfb\u52a0\u7528\u6237\")\n    add_parser.add_argument(\"name\", help=\"\u7528\u6237\u540d\")\n    add_parser.add_argument(\"email\", help=\"\u90ae\u7bb1\")\n\n    args = parser.parse_args()\n\n    # \u521b\u5efa\u5f15\u64ce\n    engine = Engine(\n        host=args.host,\n        port=args.port,\n        user=args.user,\n        password=args.password\n    )\n\n    await engine.connect()\n\n    # \u9009\u62e9\u6570\u636e\u5e93\n    await engine.execute(f\"USE {args.database}\")\n\n    # \u521b\u5efa CLI \u5b9e\u4f8b\n    cli = UserCLI(engine)\n\n    # \u6267\u884c\u547d\u4ee4\n    if args.command == \"list\":\n        await cli.list_users()\n    elif args.command == \"add\":\n        await cli.add_user(args.name, args.email)\n\n    await engine.disconnect()\n\nif __name__ == \"__main__\":\n    asyncio.run(main())\n</code></pre> <p>\u8fd9\u4e9b\u793a\u4f8b\u6db5\u76d6\u4e86 asmysql v2 \u7248\u672c\u7684\u4e3b\u8981\u4f7f\u7528\u573a\u666f\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u9700\u6c42\u8fdb\u884c\u4fee\u6539\u548c\u6269\u5c55\u3002</p>"},{"location":"zh/v2/faq/","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"zh/v2/faq/#q","title":"Q: \u5982\u4f55\u67e5\u770b\u8fde\u63a5\u6c60\u72b6\u6001\uff1f","text":"<p>A: \u4f7f\u7528 <code>engine.status</code> \u5c5e\u6027\uff1a</p> <pre><code>status = engine.status\nprint(status)\n</code></pre>"},{"location":"zh/v2/faq/#q_1","title":"Q: \u6d41\u5f0f\u67e5\u8be2\u548c\u666e\u901a\u67e5\u8be2\u7684\u533a\u522b\uff1f","text":"<p>A: - \u666e\u901a\u67e5\u8be2\uff1a\u5c06\u6240\u6709\u7ed3\u679c\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u9002\u5408\u5c0f\u6570\u636e\u96c6 - \u6d41\u5f0f\u67e5\u8be2\uff1a\u9010\u884c\u8fd4\u56de\u7ed3\u679c\uff0c\u4e0d\u5360\u7528\u5185\u5b58\uff0c\u9002\u5408\u5927\u6570\u636e\u96c6</p>"},{"location":"zh/v2/faq/#q_2","title":"Q: \u5982\u4f55\u81ea\u5b9a\u4e49\u7ed3\u679c\u7c7b\u578b\uff1f","text":"<p>A: \u4f7f\u7528 <code>result_class</code> \u53c2\u6570\uff0c\u652f\u6301 <code>tuple</code>\u3001<code>dict</code> \u6216\u81ea\u5b9a\u4e49\u6a21\u578b\u7c7b\uff1a</p> <pre><code>result = await engine.execute(\n    \"SELECT * FROM users\",\n    result_class=dict  # \u6216\u81ea\u5b9a\u4e49\u6a21\u578b\u7c7b\n)\n</code></pre>"},{"location":"zh/v2/faq/#q_3","title":"Q: \u5982\u4f55\u5904\u7406\u4e8b\u52a1\uff1f","text":"<p>A: \u8bbe\u7f6e <code>auto_commit=False</code> \u5e76\u624b\u52a8\u7ba1\u7406\uff1a</p> <pre><code>engine = Engine(url=\"...\", auto_commit=False)\nawait engine.connect()\n\n# \u6ce8\u610f\uff1av2 \u7248\u672c\u7684\u4e8b\u52a1\u7ba1\u7406\u9700\u8981\u624b\u52a8\u63a7\u5236\u8fde\u63a5\n</code></pre>"},{"location":"zh/v2/faq/#q_4","title":"Q: \u9519\u8bef\u4fe1\u606f\u5982\u4f55\u83b7\u53d6\uff1f","text":"<p>A: \u901a\u8fc7 <code>result.error</code>\u3001<code>result.error_no</code> \u548c <code>result.error_msg</code> \u5c5e\u6027\uff1a</p> <pre><code>result = await engine.execute(\"SELECT * FROM invalid_table\")\nif result.error:\n    print(f\"\u9519\u8bef\u7801: {result.error_no}\")\n    print(f\"\u9519\u8bef\u4fe1\u606f: {result.error_msg}\")\n</code></pre>"},{"location":"zh/v2/faq/#q_5","title":"Q: \u5982\u4f55\u6279\u91cf\u63d2\u5165\u6570\u636e\uff1f","text":"<p>A: \u4f7f\u7528 <code>execute_many()</code> \u65b9\u6cd5\uff1a</p> <pre><code>data = [(\"\u5f20\u4e09\", \"zhangsan@example.com\"), (\"\u674e\u56db\", \"lisi@example.com\")]\nresult = await engine.execute_many(\n    \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n    data\n)\n</code></pre>"},{"location":"zh/v2/faq/#q-engine","title":"Q: \u5982\u4f55\u5728\u4e0d\u540c\u6a21\u5757\u95f4\u5171\u4eab Engine \u5b9e\u4f8b\uff1f","text":"<p>A: \u53ef\u4ee5\u5728\u5e94\u7528\u542f\u52a8\u65f6\u521b\u5efa Engine \u5b9e\u4f8b\uff0c\u7136\u540e\u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165\u6216\u5168\u5c40\u53d8\u91cf\u5171\u4eab\uff1a</p> <pre><code># app.py\nengine = Engine(url=\"mysql://...\")\nawait engine.connect()\n\n# service.py\nfrom app import engine\n\nclass UserService(AsMysql):\n    def __init__(self):\n        super().__init__(engine)\n</code></pre>"},{"location":"zh/v2/faq/#q_6","title":"Q: \u8fde\u63a5\u6c60\u5927\u5c0f\u5982\u4f55\u8bbe\u7f6e\uff1f","text":"<p>A: \u6839\u636e\u5e94\u7528\u7684\u5e76\u53d1\u91cf\u548c\u6570\u636e\u5e93\u670d\u52a1\u5668\u7684\u6027\u80fd\u6765\u8bbe\u7f6e\uff1a</p> <ul> <li>\u4f4e\u5e76\u53d1\u5e94\u7528\uff1a<code>min_pool_size=2, max_pool_size=10</code></li> <li>\u4e2d\u7b49\u5e76\u53d1\uff1a<code>min_pool_size=5, max_pool_size=50</code></li> <li>\u9ad8\u5e76\u53d1\u5e94\u7528\uff1a<code>min_pool_size=10, max_pool_size=100+</code></li> </ul>"},{"location":"zh/v2/faq/#q_7","title":"Q: \u5982\u4f55\u5904\u7406\u8fde\u63a5\u8d85\u65f6\uff1f","text":"<p>A: \u53ef\u4ee5\u901a\u8fc7 <code>connect_timeout</code> \u53c2\u6570\u8bbe\u7f6e\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff1a</p> <pre><code>engine = Engine(\n    url=\"mysql://...\",\n    connect_timeout=10  # 10 \u79d2\u8d85\u65f6\n)\n</code></pre>"},{"location":"zh/v2/faq/#_2","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>\u8fde\u63a5\u7ba1\u7406 - \u4e86\u89e3\u66f4\u591a\u8fde\u63a5\u914d\u7f6e</li> <li>\u6700\u4f73\u5b9e\u8df5 - \u67e5\u770b\u63a8\u8350\u7684\u4f7f\u7528\u65b9\u5f0f</li> </ul>"},{"location":"zh/v2/installation/","title":"\u5b89\u88c5\u6307\u5357","text":""},{"location":"zh/v2/installation/#pypi","title":"\u4ece PyPI \u5b89\u88c5","text":"<pre><code>pip install asmysql\n</code></pre>"},{"location":"zh/v2/installation/#_2","title":"\u4ece\u6e90\u7801\u5b89\u88c5","text":"<pre><code>git clone https://github.com/vastxiao/asmysql.git\ncd asmysql\npip install .\n</code></pre>"},{"location":"zh/v2/installation/#_3","title":"\u4f9d\u8d56\u8981\u6c42","text":"<ul> <li>Python &gt;= 3.9</li> <li>aiomysql[rsa] &gt;= 0.3.2</li> </ul>"},{"location":"zh/v2/installation/#_4","title":"\u9a8c\u8bc1\u5b89\u88c5","text":"<p>\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u901a\u5c1d\u8bd5\u5bfc\u5165\u4e3b\u8981\u7c7b\u9a8c\u8bc1\u5b89\u88c5\u6210\u529f\uff1a</p> <pre><code>from asmysql import Engine, AsMysql\nprint(\"\u5b89\u88c5\u6210\u529f\uff01\")\n</code></pre>"},{"location":"zh/v2/migration/","title":"\u8fc1\u79fb\u6307\u5357","text":""},{"location":"zh/v2/migration/#v1-v2","title":"\u4ece v1 \u8fc1\u79fb\u5230 v2","text":"<ol> <li> <p>\u66f4\u65b0\u5bfc\u5165 <pre><code># v1\nfrom asmysql import AsMysql\n\n# v2\nfrom asmysql import Engine, AsMysql\n</code></pre></p> </li> <li> <p>\u66f4\u65b0\u8fde\u63a5\u65b9\u5f0f <pre><code># v1\nclass MyService(AsMysql):\n    host = '127.0.0.1'\n    port = 3306\n    user = 'root'\n    password = 'pass'\n\nmysql = await MyService()\n\n# v2\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nclass MyService(AsMysql):\n    pass\n\nservice = MyService(engine)\n</code></pre></p> </li> <li> <p>\u66f4\u65b0\u9519\u8bef\u5c5e\u6027 <pre><code># v1\nif result.err:\n    print(result.err_msg)\n\n# v2\nif result.error:\n    print(result.error_msg)\n</code></pre></p> </li> <li> <p>\u4f7f\u7528\u65b0\u7684\u529f\u80fd <pre><code># v2 \u65b0\u589e\uff1aURL \u8fde\u63a5\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\n\n# v2 \u65b0\u589e\uff1a\u6d41\u5f0f\u67e5\u8be2\nasync for row in engine.execute(\"SELECT * FROM large_table\", stream=True):\n    process(row)\n\n# v2 \u65b0\u589e\uff1a\u81ea\u5b9a\u4e49\u7ed3\u679c\u7c7b\u578b\nresult = await engine.execute(\"SELECT * FROM users\", result_class=dict)\n</code></pre></p> </li> </ol>"},{"location":"zh/v2/query/","title":"\u67e5\u8be2\u64cd\u4f5c","text":""},{"location":"zh/v2/query/#_2","title":"\u57fa\u672c\u67e5\u8be2","text":""},{"location":"zh/v2/query/#await","title":"\u65b9\u5f0f\u4e00\uff1a\u4f7f\u7528 await","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nresult = await engine.execute(\"SELECT * FROM users WHERE id = %s\", (1,))\ndata = await result.fetch_one()\n</code></pre>"},{"location":"zh/v2/query/#_3","title":"\u65b9\u5f0f\u4e8c\uff1a\u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nasync with engine.execute(\"SELECT * FROM users\") as result:\n    data = await result.fetch_all()\n</code></pre>"},{"location":"zh/v2/query/#_4","title":"\u65b9\u5f0f\u4e09\uff1a\u76f4\u63a5\u8fed\u4ee3","text":"<pre><code>from asmysql import Engine\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nasync for row in engine.execute(\"SELECT * FROM users\"):\n    print(row)\n</code></pre>"},{"location":"zh/v2/query/#_5","title":"\u53c2\u6570\u5316\u67e5\u8be2","text":""},{"location":"zh/v2/query/#_6","title":"\u4f7f\u7528\u5143\u7ec4\u53c2\u6570","text":"<pre><code>result = await engine.execute(\n    \"SELECT * FROM users WHERE name = %s AND age &gt; %s\",\n    (\"\u5f20\u4e09\", 18)\n)\n</code></pre>"},{"location":"zh/v2/query/#_7","title":"\u4f7f\u7528\u5b57\u5178\u53c2\u6570","text":"<pre><code>result = await engine.execute(\n    \"SELECT * FROM users WHERE name = %(name)s AND age &gt; %(age)s\",\n    {\"name\": \"\u5f20\u4e09\", \"age\": 18}\n)\n</code></pre>"},{"location":"zh/v2/query/#_8","title":"\u6279\u91cf\u6267\u884c","text":"<pre><code># \u6279\u91cf\u63d2\u5165\nusers = [\n    (\"\u5f20\u4e09\", \"zhangsan@example.com\"),\n    (\"\u674e\u56db\", \"lisi@example.com\"),\n    (\"\u738b\u4e94\", \"wangwu@example.com\")\n]\nresult = await engine.execute_many(\n    \"INSERT INTO users (name, email) VALUES (%s, %s)\",\n    users\n)\nprint(f\"\u63d2\u5165\u4e86 {result.row_count} \u6761\u8bb0\u5f55\")\n</code></pre>"},{"location":"zh/v2/query/#_9","title":"\u6d41\u5f0f\u67e5\u8be2","text":"<p>\u6d41\u5f0f\u67e5\u8be2\u9002\u7528\u4e8e\u5927\u6570\u636e\u96c6\uff0c\u4e0d\u4f1a\u5c06\u6240\u6709\u6570\u636e\u52a0\u8f7d\u5230\u5185\u5b58\uff1a</p> <pre><code># \u542f\u7528\u6d41\u5f0f\u67e5\u8be2\nresult = await engine.execute(\n    \"SELECT * FROM large_table\",\n    stream=True\n)\n\n# \u6d41\u5f0f\u8fed\u4ee3\nasync for row in result:\n    process(row)  # \u9010\u884c\u5904\u7406\uff0c\u4e0d\u5360\u7528\u5185\u5b58\n</code></pre>"},{"location":"zh/v2/query/#_10","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>\u7ed3\u679c\u5904\u7406 - \u4e86\u89e3\u5982\u4f55\u83b7\u53d6\u548c\u5904\u7406\u67e5\u8be2\u7ed3\u679c</li> <li>\u4e8b\u52a1\u63a7\u5236 - \u4e86\u89e3\u4e8b\u52a1\u7ba1\u7406</li> </ul>"},{"location":"zh/v2/quickstart/","title":"\u5feb\u901f\u5f00\u59cb","text":"<p>\u672c\u6307\u5357\u5c06\u5e2e\u52a9\u4f60\u5feb\u901f\u4e0a\u624b asmysql v2\u3002</p>"},{"location":"zh/v2/quickstart/#engine","title":"\u65b9\u5f0f\u4e00\uff1a\u4f7f\u7528 Engine \u7c7b","text":"<p><code>Engine</code> \u7c7b\u662f\u72ec\u7acb\u7684 MySQL \u8fde\u63a5\u5f15\u64ce\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff1a</p> <pre><code>import asyncio\nfrom asmysql import Engine\n\n# \u521b\u5efa MySQL \u8fde\u63a5\u5f15\u64ce\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/?charset=utf8mb4\")\n\nasync def main():\n    # \u8fde\u63a5 MySQL\n    await engine.connect()\n\n    # \u6267\u884c SQL \u8bed\u53e5\n    async with engine.execute(\"SELECT user, host FROM mysql.user\") as result:\n        async for item in result.iterate():\n            print(item)\n\n    # \u65ad\u5f00 MySQL \u8fde\u63a5\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/quickstart/#asmysql","title":"\u65b9\u5f0f\u4e8c\uff1a\u4f7f\u7528 AsMysql \u7c7b","text":"<p><code>AsMysql</code> \u7c7b\u7528\u4e8e\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1\uff0c\u7ee7\u627f\u540e\u53ef\u76f4\u63a5\u4f7f\u7528\uff1a</p> <pre><code>import asyncio\nfrom asmysql import Engine, AsMysql\n\n# \u521b\u5efa MySQL \u8fde\u63a5\u5f15\u64ce\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/?charset=utf8mb4\")\n\n# \u7f16\u5199\u4e1a\u52a1\u903b\u8f91\u7c7b\nclass UserService(AsMysql):\n    async def get_all_users(self):\n        result = await self.client.execute(\"SELECT user, host FROM mysql.user\")\n        if result.error:\n            print(f\"\u9519\u8bef\u7801: {result.error_no}, \u9519\u8bef\u4fe1\u606f: {result.error_msg}\")\n        else:\n            async for item in result.iterate():\n                print(item)\n\nasync def main():\n    # \u8fde\u63a5 MySQL\n    await engine.connect()\n\n    # \u521b\u5efa\u4e1a\u52a1\u903b\u8f91\u5b9e\u4f8b\n    user_service = UserService(engine)\n\n    # \u6267\u884c\u4e1a\u52a1\u903b\u8f91\n    await user_service.get_all_users()\n\n    # \u65ad\u5f00 MySQL \u8fde\u63a5\n    await engine.disconnect()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/v2/quickstart/#_2","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>\u4e86\u89e3 \u8fde\u63a5\u7ba1\u7406 \u7684\u8be6\u7ec6\u914d\u7f6e</li> <li>\u5b66\u4e60 \u67e5\u8be2\u64cd\u4f5c \u7684\u5404\u79cd\u7528\u6cd5</li> <li>\u67e5\u770b \u4f7f\u7528\u793a\u4f8b \u83b7\u53d6\u66f4\u591a\u793a\u4f8b\u4ee3\u7801</li> </ul>"},{"location":"zh/v2/result/","title":"\u7ed3\u679c\u5904\u7406","text":""},{"location":"zh/v2/result/#_2","title":"\u83b7\u53d6\u7ed3\u679c\u6570\u636e","text":""},{"location":"zh/v2/result/#fetch_one-","title":"fetch_one() - \u83b7\u53d6\u5355\u6761\u8bb0\u5f55","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users WHERE id = %s\", (1,))\nuser = await result.fetch_one()\nif user:\n    print(user)\n</code></pre>"},{"location":"zh/v2/result/#fetch_many-","title":"fetch_many() - \u83b7\u53d6\u591a\u6761\u8bb0\u5f55","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users\")\nusers = await result.fetch_many(10)  # \u83b7\u53d6 10 \u6761\u8bb0\u5f55\nfor user in users:\n    print(user)\n</code></pre>"},{"location":"zh/v2/result/#fetch_all-","title":"fetch_all() - \u83b7\u53d6\u6240\u6709\u8bb0\u5f55","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users\")\nall_users = await result.fetch_all()\nprint(f\"\u5171 {len(all_users)} \u6761\u8bb0\u5f55\")\n</code></pre>"},{"location":"zh/v2/result/#iterate-","title":"iterate() - \u5f02\u6b65\u8fed\u4ee3\u5668","text":"<pre><code>result = await engine.execute(\"SELECT * FROM users\")\nasync for user in result.iterate():\n    print(user)\n</code></pre>"},{"location":"zh/v2/result/#result","title":"\u76f4\u63a5\u8fed\u4ee3 Result","text":"<pre><code># \u65b9\u5f0f\u4e00\uff1a\u76f4\u63a5\u8fed\u4ee3 execute \u8fd4\u56de\u7684\u7ed3\u679c\nasync for user in engine.execute(\"SELECT * FROM users\"):\n    print(user)\n\n# \u65b9\u5f0f\u4e8c\uff1a\u5148 await \u518d\u8fed\u4ee3\nresult = await engine.execute(\"SELECT * FROM users\")\nasync for user in result:\n    print(user)\n</code></pre>"},{"location":"zh/v2/result/#_3","title":"\u7ed3\u679c\u7c7b\u578b","text":""},{"location":"zh/v2/result/#tuple","title":"\u9ed8\u8ba4 tuple \u7c7b\u578b","text":"<pre><code>result = await engine.execute(\"SELECT id, name, email FROM users\")\nuser = await result.fetch_one()\n# user \u662f tuple: (1, \"\u5f20\u4e09\", \"zhangsan@example.com\")\n</code></pre>"},{"location":"zh/v2/result/#dict","title":"dict \u7c7b\u578b","text":"<pre><code>result = await engine.execute(\n    \"SELECT id, name, email FROM users\",\n    result_class=dict\n)\nuser = await result.fetch_one()\n# user \u662f dict: {\"id\": 1, \"name\": \"\u5f20\u4e09\", \"email\": \"zhangsan@example.com\"}\n</code></pre>"},{"location":"zh/v2/result/#_4","title":"\u81ea\u5b9a\u4e49\u6a21\u578b\u7c7b\u578b","text":"<pre><code>from pydantic import BaseModel\nfrom asmysql import Engine\n\nclass User(BaseModel):\n    id: int\n    name: str\n    email: str\n\nengine = Engine(url=\"mysql://root:pass@127.0.0.1:3306/\")\nawait engine.connect()\n\nresult = await engine.execute(\n    \"SELECT id, name, email FROM users\",\n    result_class=User\n)\nuser = await result.fetch_one()\n# user \u662f User \u5b9e\u4f8b\nprint(user.name)  # \u4f7f\u7528\u5c5e\u6027\u8bbf\u95ee\n</code></pre>"},{"location":"zh/v2/result/#_5","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"zh/v2/result/#_6","title":"\u68c0\u67e5\u9519\u8bef","text":"<pre><code>result = await engine.execute(\"SELECT * FROM non_existent_table\")\nif result.error:\n    print(f\"\u9519\u8bef\u7801: {result.error_no}\")\n    print(f\"\u9519\u8bef\u4fe1\u606f: {result.error_msg}\")\n    print(f\"\u9519\u8bef\u5bf9\u8c61: {result.error}\")\nelse:\n    data = await result.fetch_all()\n</code></pre>"},{"location":"zh/v2/result/#_7","title":"\u9519\u8bef\u5c5e\u6027","text":"<ul> <li><code>result.error</code>\uff1a\u9519\u8bef\u5f02\u5e38\u5bf9\u8c61\uff08<code>MySQLError</code> \u6216 <code>None</code>\uff09</li> <li><code>result.error_no</code>\uff1a\u9519\u8bef\u7801\uff08\u6574\u6570\uff0c\u65e0\u9519\u8bef\u65f6\u4e3a 0\uff09</li> <li><code>result.error_msg</code>\uff1a\u9519\u8bef\u4fe1\u606f\uff08\u5b57\u7b26\u4e32\uff0c\u65e0\u9519\u8bef\u65f6\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff09</li> </ul>"},{"location":"zh/v2/result/#_8","title":"\u6267\u884c\u7edf\u8ba1\u4fe1\u606f","text":"<pre><code>result = await engine.execute(\"INSERT INTO users (name) VALUES (%s)\", (\"\u5f20\u4e09\",))\n\n# \u53d7\u5f71\u54cd\u7684\u884c\u6570\nprint(f\"\u53d7\u5f71\u54cd\u884c\u6570: {result.row_count}\")\n\n# \u6700\u540e\u63d2\u5165\u7684 ID\uff08\u4ec5 INSERT \u8bed\u53e5\uff09\nprint(f\"\u6700\u540e\u63d2\u5165 ID: {result.last_rowid}\")\n\n# \u5f53\u524d\u6e38\u6807\u4f4d\u7f6e\nprint(f\"\u6e38\u6807\u4f4d\u7f6e: {result.row_number}\")\n</code></pre> <p>\u6ce8\u610f\uff1a - <code>row_count</code> \u5728\u6d41\u5f0f\u67e5\u8be2\uff08<code>stream=True</code>\uff09\u65f6\u8fd4\u56de <code>None</code> - <code>row_count</code> \u5728\u53d1\u751f\u9519\u8bef\u65f6\u8fd4\u56de <code>None</code> - <code>last_rowid</code> \u4ec5\u5728 INSERT \u8bed\u53e5\u65f6\u6709\u6548</p>"},{"location":"zh/v2/transaction/","title":"\u4e8b\u52a1\u63a7\u5236","text":""},{"location":"zh/v2/transaction/#_2","title":"\u81ea\u52a8\u63d0\u4ea4\uff08\u9ed8\u8ba4\uff09","text":"<pre><code>engine = Engine(\n    url=\"mysql://root:pass@127.0.0.1:3306/\",\n    auto_commit=True  # \u9ed8\u8ba4\u503c\n)\nawait engine.connect()\n\n# \u81ea\u52a8\u63d0\u4ea4\nresult = await engine.execute(\"INSERT INTO users (name) VALUES (%s)\", (\"\u5f20\u4e09\",))\n</code></pre>"},{"location":"zh/v2/transaction/#_3","title":"\u624b\u52a8\u63d0\u4ea4","text":"<pre><code>engine = Engine(\n    url=\"mysql://root:pass@127.0.0.1:3306/\",\n    auto_commit=False\n)\nawait engine.connect()\n\n# \u4e0d\u81ea\u52a8\u63d0\u4ea4\nresult = await engine.execute(\n    \"INSERT INTO users (name) VALUES (%s)\",\n    (\"\u5f20\u4e09\",),\n    commit=False\n)\n\n# \u624b\u52a8\u63d0\u4ea4\nawait result.close()  # \u9700\u8981\u624b\u52a8\u7ba1\u7406\u8fde\u63a5\n</code></pre>"},{"location":"zh/v2/transaction/#_4","title":"\u6ce8\u610f\u4e8b\u9879","text":"<p>v2 \u7248\u672c\u7684\u4e8b\u52a1\u7ba1\u7406\u9700\u8981\u624b\u52a8\u63a7\u5236\u8fde\u63a5\u3002\u5efa\u8bae\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6839\u636e\u5b9e\u9645\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u63d0\u4ea4\u7b56\u7565\u3002</p>"},{"location":"zh/v2/transaction/#_5","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>\u67e5\u8be2\u64cd\u4f5c - \u4e86\u89e3\u5982\u4f55\u6267\u884c SQL \u8bed\u53e5</li> <li>\u6700\u4f73\u5b9e\u8df5 - \u4e86\u89e3\u63a8\u8350\u7684\u4f7f\u7528\u65b9\u5f0f</li> </ul>"},{"location":"zh/v2/changelog/v2-0-0/","title":"V2 0 0","text":""},{"location":"zh/v2/changelog/v2-0-0/#breaking-changes","title":"\u91cd\u5927\u53d8\u66f4 (Breaking Changes)","text":"<p>v2.0.0 \u662f\u4e00\u4e2a\u5b8c\u5168\u91cd\u6784\u7684\u7248\u672c\uff0c\u4e0e v1 \u7248\u672c\u4e0d\u517c\u5bb9\u3002\u4e3b\u8981\u53d8\u66f4\u5305\u62ec\uff1a</p>"},{"location":"zh/v2/changelog/v2-0-0/#1","title":"1. \u67b6\u6784\u91cd\u6784","text":"<ul> <li>\u5206\u79bb Engine \u548c AsMysql \u7c7b</li> <li>\u65b0\u589e <code>Engine</code> \u7c7b\uff1a\u72ec\u7acb\u7684 MySQL \u8fde\u63a5\u5f15\u64ce\uff0c\u53ef\u5355\u72ec\u4f7f\u7528</li> <li><code>AsMysql</code> \u7c7b\uff1a\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1\u57fa\u7c7b\uff0c\u901a\u8fc7 <code>client</code> \u5c5e\u6027\u8bbf\u95ee <code>Engine</code></li> <li>\u8fd9\u79cd\u8bbe\u8ba1\u4f7f\u5f97\u8fde\u63a5\u7ba1\u7406\u548c\u4e1a\u52a1\u903b\u8f91\u5b8c\u5168\u5206\u79bb</li> </ul>"},{"location":"zh/v2/changelog/v2-0-0/#2-result","title":"2. Result \u7c7b\u53d8\u66f4","text":"<ul> <li>\u9519\u8bef\u5c5e\u6027\u91cd\u547d\u540d</li> <li><code>Result.err</code> \u2192 <code>Result.error</code></li> <li>\u66f4\u7b26\u5408 Python \u547d\u540d\u89c4\u8303</li> </ul>"},{"location":"zh/v2/changelog/v2-0-0/#3-api","title":"3. API \u53d8\u66f4","text":"<ul> <li>\u8fde\u63a5\u65b9\u5f0f\u53d8\u66f4</li> <li>v1: \u7ee7\u627f <code>AsMysql</code> \u540e\u81ea\u52a8\u8fde\u63a5</li> <li> <p>v2: \u9700\u8981\u663e\u5f0f\u521b\u5efa <code>Engine</code> \u5e76\u8c03\u7528 <code>connect()</code></p> </li> <li> <p>\u6267\u884c\u65b9\u5f0f\u53d8\u66f4</p> </li> <li>v1: AsMysql <code>self.client.execute(...)</code></li> <li>v2: AsMysql <code>self.client.execute(...)</code> (\u4fdd\u6301\u4e0d\u53d8\uff0c\u4f46 <code>client</code> \u73b0\u5728\u662f <code>Engine</code> \u5b9e\u4f8b)</li> </ul>"},{"location":"zh/v2/changelog/v2-0-0/#new-features","title":"\u65b0\u529f\u80fd (New Features)","text":""},{"location":"zh/v2/changelog/v2-0-0/#1-engine","title":"1. Engine \u7c7b","text":"<p>\u5168\u65b0\u7684\u8fde\u63a5\u5f15\u64ce\u7c7b\uff0c\u63d0\u4f9b\u4ee5\u4e0b\u529f\u80fd\uff1a</p> <ul> <li> <p>URL \u8fde\u63a5\u5b57\u7b26\u4e32\u652f\u6301 <pre><code>engine = Engine(url=\"mysql://user:password@host:port/?charset=utf8mb4\")\n</code></pre></p> </li> <li> <p>\u8fde\u63a5\u72b6\u6001\u76d1\u63a7 <pre><code>status = engine.status\n# \u8fd4\u56de\u8fde\u63a5\u6c60\u7684\u8be6\u7ec6\u72b6\u6001\u4fe1\u606f\n</code></pre></p> </li> <li> <p>\u7075\u6d3b\u7684\u8fde\u63a5\u7ba1\u7406</p> </li> <li>\u652f\u6301 <code>async with</code> \u4e0a\u4e0b\u6587\u7ba1\u7406\u5668</li> <li>\u652f\u6301 <code>await engine()</code> \u8bed\u6cd5</li> <li> <p>\u652f\u6301 <code>await engine</code> \u8bed\u6cd5</p> </li> <li> <p>\u8fde\u63a5\u6c60\u914d\u7f6e</p> </li> <li><code>min_pool_size</code>: \u6700\u5c0f\u8fde\u63a5\u6570</li> <li><code>max_pool_size</code>: \u6700\u5927\u8fde\u63a5\u6570</li> <li><code>pool_recycle</code>: \u7a7a\u95f2\u8fde\u63a5\u56de\u6536\u65f6\u95f4</li> <li><code>connect_timeout</code>: \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4</li> </ul>"},{"location":"zh/v2/changelog/v2-0-0/#2-result_1","title":"2. Result \u7c7b\u589e\u5f3a","text":"<ul> <li>\u9519\u8bef\u4fe1\u606f\u8bbf\u95ee</li> <li><code>error_no</code>: \u83b7\u53d6 MySQL \u9519\u8bef\u7801</li> <li><code>error_msg</code>: \u83b7\u53d6 MySQL \u9519\u8bef\u4fe1\u606f</li> <li> <p><code>error</code>: \u83b7\u53d6\u5b8c\u6574\u7684\u9519\u8bef\u5f02\u5e38\u5bf9\u8c61</p> </li> <li> <p>\u6d41\u5f0f\u67e5\u8be2\u652f\u6301 <pre><code>result = await engine.execute(\"SELECT * FROM large_table\", stream=True)\nasync for row in result:\n    process(row)  # \u9010\u884c\u5904\u7406\uff0c\u4e0d\u5360\u7528\u5185\u5b58\n</code></pre></p> </li> <li> <p>\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u652f\u6301 <pre><code>async with engine.execute(\"SELECT * FROM users\") as result:\n    data = await result.fetch_all()\n</code></pre></p> </li> <li> <p>\u5f02\u6b65\u8fed\u4ee3\u5668\u652f\u6301 <pre><code># \u65b9\u5f0f\u4e00\uff1a\u76f4\u63a5\u8fed\u4ee3\nasync for row in engine.execute(\"SELECT * FROM users\"):\n    print(row)\n\n# \u65b9\u5f0f\u4e8c\uff1a\u8fed\u4ee3 Result\nresult = await engine.execute(\"SELECT * FROM users\")\nasync for row in result:\n    print(row)\n</code></pre></p> </li> <li> <p>\u81ea\u5b9a\u4e49\u7ed3\u679c\u7c7b\u578b <pre><code># \u652f\u6301 tuple\uff08\u9ed8\u8ba4\uff09\u3001dict \u6216\u81ea\u5b9a\u4e49\u6a21\u578b\u7c7b\nresult = await engine.execute(\n    \"SELECT * FROM users\",\n    result_class=dict  # \u6216\u81ea\u5b9a\u4e49 Pydantic \u6a21\u578b\n)\n</code></pre></p> </li> </ul>"},{"location":"zh/v2/changelog/v2-0-0/#3","title":"3. \u6267\u884c\u65b9\u6cd5\u589e\u5f3a","text":"<ul> <li>execute() \u65b9\u6cd5</li> <li>\u652f\u6301 <code>stream</code> \u53c2\u6570\uff1a\u542f\u7528\u6d41\u5f0f\u67e5\u8be2</li> <li>\u652f\u6301 <code>result_class</code> \u53c2\u6570\uff1a\u6307\u5b9a\u8fd4\u56de\u7ed3\u679c\u7c7b\u578b</li> <li>\u652f\u6301 <code>commit</code> \u53c2\u6570\uff1a\u63a7\u5236\u4e8b\u52a1\u63d0\u4ea4</li> <li> <p>\u652f\u6301\u591a\u79cd\u8c03\u7528\u65b9\u5f0f\uff1a</p> <ul> <li><code>result = await engine.execute(...)</code></li> <li><code>async with engine.execute(...) as result:</code></li> <li><code>async for item in engine.execute(...):</code></li> </ul> </li> <li> <p>execute_many() \u65b9\u6cd5</p> </li> <li>\u6279\u91cf\u6267\u884c SQL \u8bed\u53e5</li> <li>\u652f\u6301\u76f8\u540c\u7684\u53c2\u6570\u9009\u9879</li> </ul>"},{"location":"zh/v2/changelog/v2-0-0/#4","title":"4. \u7c7b\u578b\u63d0\u793a","text":"<ul> <li>\u5b8c\u6574\u7684\u7c7b\u578b\u63d0\u793a\u652f\u6301</li> <li>\u652f\u6301\u6cdb\u578b\u7c7b\u578b\uff08<code>Result[T]</code>\uff09</li> <li>IDE \u53cb\u597d\u7684\u4ee3\u7801\u8865\u5168</li> </ul>"},{"location":"zh/v2/changelog/v2-0-0/#5","title":"5. \u6d4b\u8bd5","text":"<ul> <li>\u65b0\u589e pytest \u6d4b\u8bd5\u5957\u4ef6</li> <li>\u8986\u76d6\u4e3b\u8981\u529f\u80fd\u573a\u666f</li> <li>\u652f\u6301 Mock \u6d4b\u8bd5</li> </ul>"},{"location":"zh/v2/changelog/v2-0-0/#updates","title":"\u66f4\u65b0 (Updates)","text":""},{"location":"zh/v2/changelog/v2-0-0/#1_1","title":"1. \u5305\u7ba1\u7406\u5de5\u5177","text":"<ul> <li>\u4f7f\u7528 <code>uv</code> \u4f5c\u4e3a\u5305\u7ba1\u7406\u5de5\u5177</li> <li>\u66f4\u5feb\u7684\u4f9d\u8d56\u5b89\u88c5\u901f\u5ea6</li> <li>\u66f4\u597d\u7684\u4f9d\u8d56\u89e3\u6790</li> </ul>"},{"location":"zh/v2/changelog/v2-0-0/#2","title":"2. \u4ee3\u7801\u8d28\u91cf","text":"<ul> <li>\u6539\u8fdb\u4ee3\u7801\u7ed3\u6784</li> <li>\u66f4\u597d\u7684\u9519\u8bef\u5904\u7406</li> <li>\u66f4\u6e05\u6670\u7684\u6587\u6863\u5b57\u7b26\u4e32</li> </ul>"},{"location":"zh/v2/changelog/v2-0-0/#features","title":"\u6838\u5fc3\u7279\u6027 (Features)","text":"<p>v2 \u7248\u672c\u4fdd\u7559\u4e86 v1 \u7248\u672c\u7684\u6838\u5fc3\u7279\u6027\uff1a</p> <ol> <li>\u7b80\u6613\u4f7f\u7528</li> <li>asmysql \u662f\u5bf9 aiomysql \u5c01\u88c5\u7684\u7b80\u6613\u4f7f\u7528\u5e93</li> <li> <p>\u63d0\u4f9b\u66f4\u53cb\u597d\u7684 API</p> </li> <li> <p>\u8fde\u63a5\u6c60\u7ba1\u7406</p> </li> <li>\u81ea\u52a8\u7ba1\u7406 MySQL \u8fde\u63a5\u6c60</li> <li>\u652f\u6301\u91cd\u8fde\u673a\u5236</li> <li> <p>\u8fde\u63a5\u6c60\u72b6\u6001\u76d1\u63a7</p> </li> <li> <p>\u9519\u8bef\u5904\u7406</p> </li> <li>\u5168\u5c40\u81ea\u52a8\u6355\u83b7 <code>MysqlError</code> \u9519\u8bef</li> <li>\u63d0\u4f9b\u9519\u8bef\u7801\u548c\u9519\u8bef\u4fe1\u606f\u8bbf\u95ee</li> <li> <p>\u4f18\u96c5\u7684\u9519\u8bef\u5904\u7406\u673a\u5236</p> </li> <li> <p>\u6267\u884c\u4e0e\u83b7\u53d6\u5206\u79bb</p> </li> <li>\u6267\u884c SQL \u8bed\u53e5\u548c\u83b7\u53d6\u7ed3\u679c\u5206\u79bb</li> <li>\u652f\u6301\u591a\u79cd\u6570\u636e\u83b7\u53d6\u65b9\u5f0f</li> <li> <p>\u7075\u6d3b\u7684\u7ed3\u679c\u5904\u7406</p> </li> <li> <p>\u7c7b\u578b\u63d0\u793a</p> </li> <li>\u5b8c\u6574\u7684 Python \u7c7b\u578b\u63d0\u793a</li> <li>IDE \u53cb\u597d\u7684\u4ee3\u7801\u8865\u5168</li> <li> <p>\u7c7b\u578b\u5b89\u5168</p> </li> <li> <p>\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1</p> </li> <li>\u76f4\u63a5\u7ee7\u627f <code>AsMysql</code> \u7c7b\u8fdb\u884c\u903b\u8f91\u5f00\u53d1</li> <li>\u6e05\u6670\u7684\u4ee3\u7801\u7ec4\u7ec7</li> <li>\u6613\u4e8e\u6d4b\u8bd5\u548c\u7ef4\u62a4</li> </ol>"}]}